@page "/primitives/popover"
<PageTitle>Popover Primitive - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Popover Primitive</h1>
        <p class="text-xl text-muted-foreground">
            Headless, unstyled popover primitive with full positioning control.
        </p>
    </div>

    <div class="space-y-6">
        <!-- AsChild Pattern -->
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">AsChild Pattern</h2>
                <p class="text-muted-foreground">
                    Use AsChild to compose triggers with your own styled elements.
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Without AsChild -->
                <div class="space-y-3 p-4 border rounded-lg">
                    <h3 class="text-lg font-medium">Without AsChild</h3>
                    <p class="text-sm text-muted-foreground">
                        PopoverTrigger renders its own button element.
                    </p>
                    <BlazorBlueprint.Primitives.Popover.BbPopover>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger class="px-3 py-2 border rounded text-sm cursor-pointer hover:bg-accent">
                            Open Popover
                        </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverContent class="z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                            <p class="text-sm">Without AsChild content</p>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                    </BlazorBlueprint.Primitives.Popover.BbPopover>
                </div>

                <!-- With AsChild -->
                <div class="space-y-3 p-4 border rounded-lg">
                    <h3 class="text-lg font-medium">With AsChild</h3>
                    <p class="text-sm text-muted-foreground">
                        Button receives click behavior via TriggerContext.
                    </p>
                    <BlazorBlueprint.Primitives.Popover.BbPopover>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger AsChild>
                            <BbButton Variant="ButtonVariant.Outline">Open Popover</BbButton>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverContent class="z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                            <p class="text-sm">With AsChild content</p>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                    </BlazorBlueprint.Primitives.Popover.BbPopover>
                </div>
            </div>

            <CodeBlock Source="Primitives/Popover/as-child.txt" />
        </section>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Basic Headless Primitive</h2>
                <p class="text-muted-foreground">
                    The primitive provides behavior and accessibility without styling.
                </p>
            </div>

            <div class="rounded-lg border bg-card p-6 max-w-md">
                <BlazorBlueprint.Primitives.Popover.BbPopover>
                    <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger class="px-3 py-2 border rounded text-sm cursor-pointer hover:bg-accent">
                        Open Popover
                    </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                    <BlazorBlueprint.Primitives.Popover.BbPopoverContent class="z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                        <div class="space-y-2">
                            <h4 class="font-medium leading-none">Primitive Popover</h4>
                            <p class="text-sm text-muted-foreground">
                                This is a headless popover primitive with basic styling.
                            </p>
                        </div>
                    </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                </BlazorBlueprint.Primitives.Popover.BbPopover>
            </div>

            <CodeBlock Source="Primitives/Popover/basic.txt" />
        </section>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Controlled State</h2>
                <p class="text-muted-foreground">
                    Control the popover's open state from your component code.
                </p>
            </div>

            <div class="space-y-4">
                <div class="flex gap-2">
                    <button @onclick="() => isOpen = !isOpen"
                            class="px-3 py-2 border rounded text-sm">
                        Toggle Popover
                    </button>
                    <span class="text-sm text-muted-foreground self-center">
                        State: @(isOpen ? "Open" : "Closed")
                    </span>
                </div>

                <div class="rounded-lg border bg-card p-6 max-w-md">
                    <BlazorBlueprint.Primitives.Popover.BbPopover @bind-Open="isOpen">
                        <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger class="px-3 py-2 border rounded text-sm cursor-pointer hover:bg-accent">
                            @(isOpen ? "Close" : "Open") Controlled
                        </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverContent class="z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                            <p class="text-sm">Controlled by parent state: @isOpen</p>
                            <button @onclick="() => isOpen = false" class="mt-2 text-sm text-primary underline-offset-4 hover:underline">
                                Close from content
                            </button>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                    </BlazorBlueprint.Primitives.Popover.BbPopover>
                </div>

                <CodeBlock Source="Primitives/Popover/controlled.txt" />
            </div>
        </section>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Positioning Options</h2>
                <p class="text-muted-foreground">
                    Position the popover on different sides of the trigger.
                </p>
            </div>

            <div class="rounded-lg border bg-card p-6">
                <div class="flex gap-4">
                    <BlazorBlueprint.Primitives.Popover.BbPopover>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger class="inline-flex items-center justify-center px-3 py-2 border rounded text-sm cursor-pointer hover:bg-accent">
                            <LucideIcon Name="arrow-up" Size="16" />
                        </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverContent Side="@PopoverSide.Top" class="z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                            <p class="text-sm">Positioned on top</p>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                    </BlazorBlueprint.Primitives.Popover.BbPopover>

                    <BlazorBlueprint.Primitives.Popover.BbPopover>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger class="inline-flex items-center justify-center px-3 py-2 border rounded text-sm cursor-pointer hover:bg-accent">
                            <LucideIcon Name="arrow-right" Size="16" />
                        </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverContent Side="@PopoverSide.Right" class="z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                            <p class="text-sm">Positioned on right</p>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                    </BlazorBlueprint.Primitives.Popover.BbPopover>

                    <BlazorBlueprint.Primitives.Popover.BbPopover>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverTrigger class="inline-flex items-center justify-center px-3 py-2 border rounded text-sm cursor-pointer hover:bg-accent">
                            <LucideIcon Name="arrow-left" Size="16" />
                        </BlazorBlueprint.Primitives.Popover.BbPopoverTrigger>
                        <BlazorBlueprint.Primitives.Popover.BbPopoverContent Side="@PopoverSide.Left" class="z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md">
                            <p class="text-sm">Positioned on left</p>
                        </BlazorBlueprint.Primitives.Popover.BbPopoverContent>
                    </BlazorBlueprint.Primitives.Popover.BbPopover>
                </div>
            </div>

            <CodeBlock Source="Primitives/Popover/positioning.txt" />
        </section>

        <AccessibilityList>
            <AriaAttributes>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-haspopup="true"</code> on trigger button
                </AccessibilityItem>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-expanded</code> automatically applied to trigger reflecting open state
                </AccessibilityItem>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-controls</code> linking trigger to content
                </AccessibilityItem>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">role="group"</code> on content container
                </AccessibilityItem>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">data-state</code> attribute for CSS styling (open)
                </AccessibilityItem>
                <AccessibilityItem>
                    Click outside closes popover when enabled
                </AccessibilityItem>
                <AccessibilityItem>
                    Focus management with automatic focus handling
                </AccessibilityItem>
            </AriaAttributes>
            <KeyboardNavigation>
                <KeyboardShortcutItem Description="Navigate to trigger">
                    <BbKbd>Tab</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Open popover">
                    <BbKbd>Enter</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Close popover">
                    <BbKbd>Escape</BbKbd>
                </KeyboardShortcutItem>
            </KeyboardNavigation>
        </AccessibilityList>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">API Reference</h2>
                <p class="text-muted-foreground">Component properties and parameters.</p>
            </div>
            <div class="space-y-4">
                <ApiReference ComponentName="Popover">
                    <ApiParameter Name="Open" Type="bool?" Default="null">
                        Controls whether the popover is open (controlled mode). When null, the popover manages its own state (uncontrolled mode). Supports two-way binding with <code>@@bind-Open</code>.
                    </ApiParameter>
                    <ApiParameter Name="OpenChanged" Type="EventCallback&lt;bool&gt;">
                        Event callback invoked when the open state changes.
                    </ApiParameter>
                    <ApiParameter Name="DefaultOpen" Type="bool" Default="false">
                        Default open state when in uncontrolled mode.
                    </ApiParameter>
                    <ApiParameter Name="OnOpenChange" Type="EventCallback&lt;bool&gt;">
                        Event callback invoked when the popover open state changes. Receives the new open state as a parameter.
                    </ApiParameter>
                    <ApiParameter Name="Modal" Type="bool" Default="true">
                        Whether the popover can be dismissed by clicking outside or pressing Escape.
                    </ApiParameter>
                    <ApiParameter Name="ChildContent" Type="RenderFragment?">
                        The child content to render within the popover context. Typically includes PopoverTrigger and PopoverContent.
                    </ApiParameter>
                </ApiReference>

                <ApiReference ComponentName="PopoverTrigger">
                    <ApiParameter Name="AsChild" Type="bool" Default="false">
                        When true, does not render its own button element. Instead passes trigger behavior via <code>TriggerContext</code> to child components.
                    </ApiParameter>
                    <ApiParameter Name="OnClick" Type="EventCallback&lt;MouseEventArgs&gt;">
                        Custom click handler. If provided, this is called in addition to the default toggle behavior.
                    </ApiParameter>
                    <ApiParameter Name="CustomClickHandling" Type="bool" Default="false">
                        Whether to use custom click handling. When true, only OnClick is invoked and default open behavior is skipped.
                    </ApiParameter>
                    <ApiParameter Name="ChildContent" Type="RenderFragment?">
                        The content to display inside the trigger button.
                    </ApiParameter>
                    <ApiParameter Name="AdditionalAttributes" Type="Dictionary&lt;string, object&gt;?">
                        Additional HTML attributes applied to the trigger button element (e.g. <code>class</code>, <code>style</code>).
                    </ApiParameter>
                </ApiReference>

                <ApiReference ComponentName="PopoverContent">
                    <ApiParameter Name="Side" Type="PopoverSide" Default="PopoverSide.Bottom">
                        Preferred side for positioning relative to the trigger (Top, Right, Bottom, Left).
                    </ApiParameter>
                    <ApiParameter Name="Align" Type="PopoverAlign" Default="PopoverAlign.Center">
                        Alignment relative to the trigger (Start, Center, End).
                    </ApiParameter>
                    <ApiParameter Name="Offset" Type="int" Default="4">
                        Offset distance from the trigger element in pixels.
                    </ApiParameter>
                    <ApiParameter Name="MatchTriggerWidth" Type="bool" Default="false">
                        Whether to match the popover width to the trigger element width.
                    </ApiParameter>
                    <ApiParameter Name="Strategy" Type="PositioningStrategy" Default="PositioningStrategy.Fixed">
                        CSS positioning strategy. Use Fixed to escape stacking contexts, or Absolute to scroll with a container.
                    </ApiParameter>
                    <ApiParameter Name="ZIndex" Type="int" Default="9999">
                        CSS z-index value for the popover content.
                    </ApiParameter>
                    <ApiParameter Name="CloseOnEscape" Type="bool" Default="true">
                        Whether pressing Escape should close the popover.
                    </ApiParameter>
                    <ApiParameter Name="CloseOnClickOutside" Type="bool" Default="true">
                        Whether clicking outside should close the popover.
                    </ApiParameter>
                    <ApiParameter Name="OnEscapeKeyDown" Type="EventCallback&lt;KeyboardEventArgs&gt;">
                        Event callback invoked when Escape key is pressed.
                    </ApiParameter>
                    <ApiParameter Name="OnClickOutside" Type="EventCallback">
                        Event callback invoked when clicking outside the popover.
                    </ApiParameter>
                    <ApiParameter Name="OnContentReady" Type="EventCallback">
                        Event callback invoked when the popover content is fully ready (positioned and visible). Useful for focus management.
                    </ApiParameter>
                    <ApiParameter Name="ChildContent" Type="RenderFragment?">
                        The content to render inside the popover.
                    </ApiParameter>
                    <ApiParameter Name="AdditionalAttributes" Type="Dictionary&lt;string, object&gt;?">
                        Additional HTML attributes applied to the content container element (e.g. <code>class</code>, <code>style</code>).
                    </ApiParameter>
                </ApiReference>
            </div>
        </section>
    </div>
</div>

@code {
    private bool isOpen = false;
}
