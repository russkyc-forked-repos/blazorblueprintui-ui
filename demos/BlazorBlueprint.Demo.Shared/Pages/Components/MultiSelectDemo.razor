@page "/components/multiselect"
<PageTitle>Multi Select Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <div class="flex items-center gap-3">
                <h1 class="text-4xl font-bold tracking-tight">Multi Select Component</h1>
                <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary ring-1 ring-inset ring-primary/20">v3</span>
            </div>
            <p class="text-xl text-muted-foreground">
                A searchable multi-select component that allows selecting multiple options with checkbox indicators and tag display.
            </p>
        </div>
    </div>

    <!-- Basic MultiSelect -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Basic Multi Select</h2>
        <p class="text-sm text-muted-foreground">
            Select multiple programming languages. Selected items appear as tags.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="string"
                        Options="languages"
                        @bind-Values="selectedLanguages"
                        Placeholder="Select languages..."
                        SearchPlaceholder="Search languages..."
                        EmptyMessage="No language found."
                        PopoverWidth="w-[300px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(selectedLanguages?.Any() == true ? string.Join(", ", selectedLanguages) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(selectedLanguages?.Any() == true ? string.Join(", ", languages.GetTexts(selectedLanguages)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/basic.txt" />
    </section>

    <!-- Tech Stack Example -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Tech Stack Selector</h2>
        <p class="text-sm text-muted-foreground">
            Select your tech stack. Uses "Select All" functionality.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="string"
                        Options="technologies"
                        @bind-Values="selectedTechnologies"
                        Placeholder="Select technologies..."
                        SearchPlaceholder="Search..."
                        ShowSelectAll="true"
                        SelectAllLabel="Select All"
                        MaxDisplayTags="3"
                        PopoverWidth="w-[320px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(selectedTechnologies?.Any() == true ? string.Join(", ", selectedTechnologies) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(selectedTechnologies?.Any() == true ? string.Join(", ", technologies.GetTexts(selectedTechnologies)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/tech-stack.txt" />
    </section>

    <!-- Country Selector -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Country Selector</h2>
        <p class="text-sm text-muted-foreground">
            Select countries with overflow indicator (+N more).
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="string"
                        Options="countries"
                        @bind-Values="selectedCountries"
                        Placeholder="Select countries..."
                        SearchPlaceholder="Search country..."
                        MaxDisplayTags="2"
                        ShowSelectAll="true"
                        PopoverWidth="w-[280px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(selectedCountries?.Any() == true ? string.Join(", ", selectedCountries) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(selectedCountries?.Any() == true ? string.Join(", ", countries.GetTexts(selectedCountries)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/country.txt" />
    </section>

    <!-- Non-String Value Types -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Non-String Value Types</h2>
        <p class="text-sm text-muted-foreground">
            MultiSelect supports non-string value types. Here, <code class="bg-muted px-1 py-0.5 rounded text-sm">SelectOption&lt;int&gt;</code> is used with permission IDs.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="int"
                        Options="permissions"
                        @bind-Values="selectedPermissions"
                        Placeholder="Select permissions..."
                        SearchPlaceholder="Search permissions..."
                        ShowSelectAll="true"
                        PopoverWidth="w-[300px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(selectedPermissions?.Any() == true ? string.Join(", ", selectedPermissions) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(selectedPermissions?.Any() == true ? string.Join(", ", permissions.GetTexts(selectedPermissions)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/non-string-values.txt" />
    </section>

    <!-- Guid Values -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Guid Values</h2>
        <p class="text-sm text-muted-foreground">
            MultiSelect with <code class="bg-muted px-1 py-0.5 rounded text-sm">SelectOption&lt;Guid&gt;</code> for entity-based selections using unique identifiers.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="Guid"
                        Options="projects"
                        @bind-Values="selectedProjects"
                        Placeholder="Select projects..."
                        SearchPlaceholder="Search projects..."
                        PopoverWidth="w-[300px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(selectedProjects?.Any() == true ? string.Join(", ", selectedProjects) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(selectedProjects?.Any() == true ? string.Join(", ", projects.GetTexts(selectedProjects)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/guid-values.txt" />
    </section>

    <!-- Without Select All -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Without Select All</h2>
        <p class="text-sm text-muted-foreground">
            Multi Select without the "Select All" option.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="string"
                        Options="frameworks"
                        @bind-Values="selectedFrameworks"
                        Placeholder="Select frameworks..."
                        SearchPlaceholder="Search..."
                        ShowSelectAll="false"
                        PopoverWidth="w-[250px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(selectedFrameworks?.Any() == true ? string.Join(", ", selectedFrameworks) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(selectedFrameworks?.Any() == true ? string.Join(", ", frameworks.GetTexts(selectedFrameworks)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/without-select-all.txt" />
    </section>

    <!-- Prevent Auto Close -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Prevent Auto Close</h2>
        <p class="text-sm text-muted-foreground">
            With <code class="bg-muted px-1 py-0.5 rounded text-sm">AutoClose="false"</code>, the dropdown stays open when you click outside.
            Use the Close button or press Escape to close it.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="string"
                        Options="frameworks"
                        @bind-Values="autoCloseFrameworks"
                        Placeholder="Select frameworks..."
                        SearchPlaceholder="Search..."
                        AutoClose="false"
                        PopoverWidth="w-[280px]" />
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(autoCloseFrameworks?.Any() == true ? string.Join(", ", autoCloseFrameworks) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(autoCloseFrameworks?.Any() == true ? string.Join(", ", frameworks.GetTexts(autoCloseFrameworks)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/prevent-auto-close.txt" />
    </section>

    <!-- Match Trigger Width -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Match Trigger Width</h2>
        <p class="text-sm text-muted-foreground">
            With <code class="bg-muted px-1 py-0.5 rounded text-sm">MatchTriggerWidth="true"</code>,
            the dropdown automatically matches the width of the trigger element.
        </p>

        <div class="flex flex-col gap-4">
            <div class="w-72">
                <label class="text-sm font-medium mb-2 block">Fixed width container (w-72)</label>
                <BbMultiSelect TValue="string"
                            Options="languages"
                            @bind-Values="matchWidthLanguages"
                            Placeholder="Select languages..."
                            SearchPlaceholder="Search..."
                            MatchTriggerWidth="true"
                            Class="w-full" />
            </div>

            <div class="w-[500px]">
                <label class="text-sm font-medium mb-2 block">Wider container (500px)</label>
                <BbMultiSelect TValue="string"
                            Options="technologies"
                            @bind-Values="matchWidthTechnologies"
                            Placeholder="Select technologies..."
                            SearchPlaceholder="Search..."
                            ShowSelectAll="true"
                            MatchTriggerWidth="true"
                            Class="w-full" />
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/match-trigger-width.txt" />
    </section>

    <!-- Disabled State -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Disabled State</h2>
        <p class="text-sm text-muted-foreground">
            Multi Select in disabled state with pre-selected values.
        </p>

        <BbMultiSelect TValue="string"
                    Options="languages"
                    Values="@disabledValues"
                    Placeholder="Disabled multiselect"
                    Disabled="true"
                    PopoverWidth="w-[300px]" />

        <CodeBlock Source="Components/MultiSelect/disabled.txt" />
    </section>

    <!-- Form Example -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Form Integration</h2>
        <p class="text-sm text-muted-foreground">
            Example of Multi Select in a form layout.
        </p>

        <div class="space-y-4 max-w-md border rounded-lg p-6">
            <div class="space-y-2">
                <label class="text-sm font-medium">Skills</label>
                <BbMultiSelect TValue="string"
                            Options="languages"
                            @bind-Values="formSkills"
                            Placeholder="Select your skills..."
                            SearchPlaceholder="Search skills..."
                            ShowSelectAll="true"
                            MatchTriggerWidth="true" />
                <p class="text-xs text-muted-foreground">Select all programming languages you know.</p>
            </div>

            <div class="space-y-2">
                <label class="text-sm font-medium">Preferred Frameworks</label>
                <BbMultiSelect TValue="string"
                            Options="frameworks"
                            @bind-Values="formFrameworks"
                            Placeholder="Select frameworks..."
                            SearchPlaceholder="Search frameworks..."
                            MaxDisplayTags="2"
                            MatchTriggerWidth="true" />
                <p class="text-xs text-muted-foreground">Choose your preferred frameworks.</p>
            </div>

            <div class="pt-4 border-t">
                <BbButton Variant="ButtonVariant.Default" OnClick="HandleFormSubmit">
                    Submit
                </BbButton>
                @if (formSubmitted)
                {
                    <div class="text-sm text-green-600 mt-2 space-y-1">
                        <p>Form submitted!</p>
                        <p><span class="font-medium">Skills values:</span> <span class="font-mono">@(formSkills?.Any() == true ? string.Join(", ", formSkills) : "None")</span></p>
                        <p><span class="font-medium">Skills text:</span> @(formSkills?.Any() == true ? string.Join(", ", languages.GetTexts(formSkills)) : "None")</p>
                        <p><span class="font-medium">Frameworks values:</span> <span class="font-mono">@(formFrameworks?.Any() == true ? string.Join(", ", formFrameworks) : "None")</span></p>
                        <p><span class="font-medium">Frameworks text:</span> @(formFrameworks?.Any() == true ? string.Join(", ", frameworks.GetTexts(formFrameworks)) : "None")</p>
                    </div>
                }
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/form-integration.txt" />
    </section>

    <!-- Compositional Mode -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Compositional Mode</h2>
        <p class="text-sm text-muted-foreground">
            For full control over item rendering, use <code class="bg-muted px-1 py-0.5 rounded text-sm">MultiSelectItem</code> children
            instead of the <code class="bg-muted px-1 py-0.5 rounded text-sm">Options</code> parameter.
            Search, keyboard navigation, Select All, and checkbox indicators work identically.
        </p>

        <div class="flex flex-col gap-2">
            <BbMultiSelect TValue="string"
                        @bind-Values="compositionalValues"
                        Placeholder="Select permissions..."
                        SearchPlaceholder="Search..."
                        ShowSelectAll="true"
                        SelectAllLabel="Select All"
                        PopoverWidth="w-[300px]">
                <BbMultiSelectItem Value="@("read")" Text="Read">
                    <div class="flex items-center gap-2">
                        <span class="inline-block h-2 w-2 rounded-full bg-green-500"></span>
                        Read
                    </div>
                </BbMultiSelectItem>
                <BbMultiSelectItem Value="@("write")" Text="Write">
                    <div class="flex items-center gap-2">
                        <span class="inline-block h-2 w-2 rounded-full bg-yellow-500"></span>
                        Write
                    </div>
                </BbMultiSelectItem>
                <BbMultiSelectItem Value="@("delete")" Text="Delete">
                    <div class="flex items-center gap-2">
                        <span class="inline-block h-2 w-2 rounded-full bg-red-500"></span>
                        Delete
                    </div>
                </BbMultiSelectItem>
                <BbMultiSelectItem Value="@("admin")" Text="Admin">
                    <div class="flex items-center gap-2">
                        <span class="inline-block h-2 w-2 rounded-full bg-purple-500"></span>
                        Admin
                    </div>
                </BbMultiSelectItem>
            </BbMultiSelect>
            <div class="rounded-lg border p-4 bg-muted/50 space-y-1">
                <p class="text-sm"><span class="font-medium">Selected values:</span> <span class="font-mono">@(compositionalValues?.Any() == true ? string.Join(", ", compositionalValues) : "(none)")</span></p>
                <p class="text-sm"><span class="font-medium">Selected text:</span> @(compositionalValues?.Any() == true ? string.Join(", ", compositionalValues.Select(GetCompositionalLabel)) : "(none)")</p>
            </div>
        </div>

        <CodeBlock Source="Components/MultiSelect/compositional.txt" />
    </section>

    <!-- Accessibility -->
    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>
                role="listbox" with aria-multiselectable="true"
            </AccessibilityItem>
            <AccessibilityItem>
                aria-expanded indicates dropdown state
            </AccessibilityItem>
            <AccessibilityItem>
                Selected items shown as removable tags with clear buttons
            </AccessibilityItem>
            <AccessibilityItem>
                Search input filters options in real-time
            </AccessibilityItem>
        </AriaAttributes>
        <KeyboardNavigation>
            <KeyboardShortcutItem Description="Open dropdown">
                <BbKbd>Enter</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Navigate options">
                <BbKbd>Arrow Keys</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Toggle selection">
                <BbKbd>Enter</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Close dropdown">
                <BbKbd>Escape</BbKbd>
            </KeyboardShortcutItem>
        </KeyboardNavigation>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>

        <div class="space-y-4">
            <ApiReference ComponentName="MultiSelect&lt;TValue&gt;">
                <ApiParameter Name="Options" Type="IEnumerable&lt;SelectOption&lt;TValue&gt;&gt;?">
                    Collection of options for data-driven mode. When null, uses compositional mode with ChildContent.
                </ApiParameter>
                <ApiParameter Name="Values" Type="IEnumerable&lt;TValue&gt;?">
                    Currently selected values. Supports two-way binding with <code>@@bind-Values</code>.
                </ApiParameter>
                <ApiParameter Name="ValuesChanged" Type="EventCallback&lt;IEnumerable&lt;TValue&gt;?&gt;">
                    Callback invoked when the selected values change.
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string" Default="&quot;Select items...&quot;">
                    Placeholder text shown when no items are selected.
                </ApiParameter>
                <ApiParameter Name="SearchPlaceholder" Type="string" Default="&quot;Search...&quot;">
                    Placeholder text shown in the search input.
                </ApiParameter>
                <ApiParameter Name="EmptyMessage" Type="string" Default="&quot;No results found.&quot;">
                    Message displayed when no items match the search.
                </ApiParameter>
                <ApiParameter Name="ShowSelectAll" Type="bool" Default="true">
                    Whether to show the Select All option.
                </ApiParameter>
                <ApiParameter Name="SelectAllLabel" Type="string" Default="&quot;Select All&quot;">
                    Label for the Select All option.
                </ApiParameter>
                <ApiParameter Name="MaxDisplayTags" Type="int" Default="3">
                    Maximum number of tags to display before showing "+N more".
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the multiselect is disabled.
                </ApiParameter>
                <ApiParameter Name="MatchTriggerWidth" Type="bool" Default="false">
                    Whether to match dropdown width to the trigger element width.
                </ApiParameter>
                <ApiParameter Name="AutoClose" Type="bool" Default="true">
                    Whether clicking outside the dropdown should close it.
                </ApiParameter>
                <ApiParameter Name="ActiveClass" Type="string?" Default="&quot;bg-accent text-accent-foreground&quot;">
                    CSS classes applied to the trigger when the dropdown is open. Set to <code>null</code> or empty to disable.
                    Use to match the context (e.g., <code>"bg-sidebar-accent text-sidebar-accent-foreground"</code> in sidebars).
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    Content for compositional mode. Use MultiSelectItem components as children.
                </ApiParameter>
            </ApiReference>

            <ApiReference ComponentName="MultiSelectItem&lt;TValue&gt;">
                <ApiParameter Name="Value" Type="TValue">
                    The value of this item. Required.
                </ApiParameter>
                <ApiParameter Name="Text" Type="string">
                    Display text for filtering and badge display. Required.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether this item is disabled.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    Custom content to render. When null, renders Text as plain text.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    // Basic example
    private IEnumerable<string>? selectedLanguages;

    // Tech stack example
    private IEnumerable<string>? selectedTechnologies;

    // Country example
    private IEnumerable<string>? selectedCountries;

    // Framework example
    private IEnumerable<string>? selectedFrameworks;

    // Auto close example
    private IEnumerable<string>? autoCloseFrameworks;

    // Disabled example
    private IEnumerable<string> disabledValues = new[] { "csharp", "typescript" };

    // Match trigger width examples
    private IEnumerable<string>? matchWidthLanguages;
    private IEnumerable<string>? matchWidthTechnologies;

    // Compositional mode example
    private IEnumerable<string>? compositionalValues;

    private readonly Dictionary<string, string> compositionalLabels = new()
    {
        ["read"] = "Read",
        ["write"] = "Write",
        ["delete"] = "Delete",
        ["admin"] = "Admin"
    };

    // Form example
    private IEnumerable<string>? formSkills;
    private IEnumerable<string>? formFrameworks;
    private bool formSubmitted;

    // Non-string value type examples
    private IEnumerable<int>? selectedPermissions;
    private IEnumerable<Guid>? selectedProjects;

    private readonly SelectOption<string>[] languages =
    [
        new("csharp", "C#"),
        new("typescript", "TypeScript"),
        new("javascript", "JavaScript"),
        new("python", "Python"),
        new("java", "Java"),
        new("go", "Go"),
        new("rust", "Rust"),
        new("php", "PHP")
    ];

    private readonly SelectOption<string>[] technologies =
    [
        new("react", "React"),
        new("vue", "Vue.js"),
        new("angular", "Angular"),
        new("blazor", "Blazor"),
        new("nextjs", "Next.js"),
        new("nodejs", "Node.js"),
        new("dotnet", ".NET"),
        new("docker", "Docker"),
        new("kubernetes", "Kubernetes"),
        new("aws", "AWS")
    ];

    private readonly SelectOption<string>[] frameworks =
    [
        new("nextjs", "Next.js"),
        new("sveltekit", "SvelteKit"),
        new("nuxtjs", "Nuxt.js"),
        new("remix", "Remix"),
        new("astro", "Astro"),
        new("blazor", "Blazor")
    ];

    private readonly SelectOption<string>[] countries =
    [
        new("US", "United States"),
        new("GB", "United Kingdom"),
        new("CA", "Canada"),
        new("AU", "Australia"),
        new("DE", "Germany"),
        new("FR", "France"),
        new("JP", "Japan"),
        new("BR", "Brazil"),
        new("MX", "Mexico"),
        new("NL", "Netherlands")
    ];

    private readonly SelectOption<int>[] permissions =
    [
        new(1, "Read"),
        new(2, "Write"),
        new(3, "Delete"),
        new(4, "Admin")
    ];

    private readonly SelectOption<Guid>[] projects =
    [
        new(Guid.Parse("a1b2c3d4-e5f6-7890-abcd-ef1234567890"), "Project Alpha"),
        new(Guid.Parse("b2c3d4e5-f6a7-8901-bcde-f12345678901"), "Project Beta"),
        new(Guid.Parse("c3d4e5f6-a7b8-9012-cdef-123456789012"), "Project Gamma"),
        new(Guid.Parse("d4e5f6a7-b8c9-0123-defa-234567890123"), "Project Delta")
    ];

    private string GetCompositionalLabel(string value) =>
        compositionalLabels.GetValueOrDefault(value) ?? value;

    private void HandleFormSubmit()
    {
        formSubmitted = true;
        StateHasChanged();
    }
}
