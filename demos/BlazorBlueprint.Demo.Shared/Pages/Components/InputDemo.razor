@page "/components/input"
@using System.ComponentModel.DataAnnotations

<PageTitle>Input Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Input Component</h1>
        <p class="text-xl text-muted-foreground">
            Displays a form input field or a component that looks like an input field.
        </p>
        </div>
    </div>

    <!-- Which input component? -->
    <div class="rounded-lg border border-dashed bg-muted/30 p-6 space-y-3">
        <h2 class="text-lg font-semibold">Which input component?</h2>
        <div class="space-y-2 text-sm text-muted-foreground">
            <p><strong>Non-text control</strong> (checkbox, radio, switch, select)? &rarr; <a href="/components/field" class="text-primary underline underline-offset-4 hover:text-primary/80">Field</a></p>
            <p><strong>Simple string input</strong> with EditForm? &rarr; <strong>Input</strong> (this page)</p>
            <p><strong>Typed value</strong> with custom error UI or EditForm? &rarr; <a href="/components/input-field" class="text-primary underline underline-offset-4 hover:text-primary/80">InputField&lt;T&gt;</a></p>
            <p><strong>Typed value</strong> and you want it to work out of the box? &rarr; <a href="/components/form-field-input" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldInput&lt;T&gt;</a> (also supports EditForm)</p>
        </div>
    </div>

    <!-- Default Input -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Default</h2>
            <p class="text-sm text-muted-foreground">
                A simple text input with placeholder.
            </p>
        </div>
        <div class="max-w-md">
            <BbInput Type="InputType.Text" Placeholder="Enter your text..." />
        </div>
        <CodeBlock Source="Components/Input/default.txt" />
    </div>

    <!-- Input Types -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Input Types</h2>
            <p class="text-sm text-muted-foreground">
                Different HTML5 input types with optimized keyboards and validation.
            </p>
        </div>
        <div class="space-y-4 max-w-md">
            <div class="space-y-2">
                <label class="text-sm font-medium">Text</label>
                <BbInput Type="InputType.Text" Placeholder="Enter text" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Email</label>
                <BbInput Type="InputType.Email" Placeholder="Enter email" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Password</label>
                <BbInput Type="InputType.Password" Placeholder="Enter password" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Number</label>
                <BbInput Type="InputType.Number" Placeholder="Enter number" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Tel</label>
                <BbInput Type="InputType.Tel" Placeholder="Enter phone number" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">URL</label>
                <BbInput Type="InputType.Url" Placeholder="https://example.com" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Search</label>
                <BbInput Type="InputType.Search" Placeholder="Search..." />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Date</label>
                <BbInput Type="InputType.Date" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Time</label>
                <BbInput Type="InputType.Time" />
            </div>
        </div>
        <CodeBlock Source="Components/Input/types.txt" />
    </div>

    <!-- File Input -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">File</h2>
            <p class="text-sm text-muted-foreground">
                File upload input with enhanced pseudo-selector styling (file:border-0, file:bg-transparent, file:text-sm, file:font-medium).
            </p>
        </div>
        <div class="max-w-md">
            <div class="space-y-2">
                <label class="text-sm font-medium">Upload file</label>
                <BbInput Type="InputType.File" />
                <p class="text-xs text-muted-foreground">
                    File inputs now have improved styling using file: pseudo-selectors.
                </p>
            </div>
        </div>
        <CodeBlock Source="Components/Input/file.txt" />
    </div>

    <!-- Disabled State -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                Input with disabled state.
            </p>
        </div>
        <div class="max-w-md">
            <BbInput Type="InputType.Text" Placeholder="Disabled input" Disabled="true" Value="Cannot edit this" />
        </div>
        <CodeBlock Source="Components/Input/disabled.txt" />
    </div>

    <!-- Required State -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Required</h2>
            <p class="text-sm text-muted-foreground">
                Input with HTML5 required validation.
            </p>
        </div>
        <div class="max-w-md">
            <form class="space-y-4">
                <div class="space-y-2">
                    <label class="text-sm font-medium">Username (required)</label>
                    <BbInput Type="InputType.Text" Placeholder="Enter username" Required="true" />
                </div>
                <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90">
                    Submit
                </button>
            </form>
        </div>
        <CodeBlock Source="Components/Input/required.txt" />
    </div>

    <!-- With Label and Description -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Label</h2>
            <p class="text-sm text-muted-foreground">
                Inputs with labels and helper text.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <div class="space-y-2">
                <label for="email-input" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Email
                </label>
                <BbInput Type="InputType.Email" Placeholder="m@example.com" AriaLabel="Email address" />
                <p class="text-sm text-muted-foreground">
                    We'll never share your email with anyone else.
                </p>
            </div>

            <div class="space-y-2">
                <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Password
                </label>
                <BbInput Type="InputType.Password" Placeholder="Enter your password" AriaLabel="Password" />
                <p class="text-sm text-muted-foreground">
                    Must be at least 8 characters.
                </p>
            </div>
        </div>
        <CodeBlock Source="Components/Input/with-label.txt" />
    </div>

    <!-- Auto-Generated ID -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Auto-Generated ID</h2>
            <p class="text-sm text-muted-foreground">
                Input components always render with an <code class="text-xs bg-muted px-1 py-0.5 rounded">id</code> attribute.
                When no <code class="text-xs bg-muted px-1 py-0.5 rounded">Id</code> is provided, a stable ID is auto-generated
                (e.g., <code class="text-xs bg-muted px-1 py-0.5 rounded">input-a3f7c2d4</code>). User-provided IDs always take precedence.
                For label <code class="text-xs bg-muted px-1 py-0.5 rounded">for</code> wiring, provide an explicit
                <code class="text-xs bg-muted px-1 py-0.5 rounded">Id</code> or use a
                <code class="text-xs bg-muted px-1 py-0.5 rounded">BbFormFieldInput</code> wrapper which handles this automatically.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <div class="space-y-2">
                <label for="my-email" class="text-sm font-medium leading-none">
                    Email (explicit Id — click label to focus)
                </label>
                <BbInput Id="my-email" Type="InputType.Email" Placeholder="m@example.com" />
                <p class="text-xs text-muted-foreground">
                    Rendered with <code class="text-xs bg-muted px-1 py-0.5 rounded">id="my-email"</code> — the label's
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">for="my-email"</code> wires the click-to-focus behavior.
                </p>
            </div>
            <div class="space-y-2">
                <BbInput Type="InputType.Text" Placeholder="Enter username" />
                <p class="text-xs text-muted-foreground">
                    No <code class="text-xs bg-muted px-1 py-0.5 rounded">Id</code> provided — auto-generated id like
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">input-a3f7c2d4</code> is visible in DevTools.
                    Useful for programmatic access, accessibility tooling, and FormField wrappers.
                </p>
            </div>
        </div>
        <CodeBlock Source="Components/Input/auto-id.txt" />
    </div>

    <!-- Two-Way Binding Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Two-Way Binding</h2>
            <p class="text-sm text-muted-foreground">
                Demonstrating real-time value updates using Value and ValueChanged.
                Empty or whitespace-only input is automatically normalized to <code class="text-xs bg-muted px-1 py-0.5 rounded">null</code>,
                matching ASP.NET MVC model binding conventions.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <div class="space-y-2">
                <label class="text-sm font-medium">Type something</label>
                <BbInput Type="InputType.Text" Value="@boundValue" ValueChanged="@((value) => boundValue = value)" Placeholder="Start typing..." />
                <p class="text-xs text-muted-foreground">
                    Try typing text, then clearing it. The value returns to <code class="text-xs bg-muted px-1 py-0.5 rounded">null</code> instead of becoming an empty string.
                </p>
            </div>
            <div class="rounded-lg border p-4 bg-muted/50">
                <p class="text-sm font-medium mb-1">Current value:</p>
                @if (boundValue is null)
                {
                    <p class="text-sm font-mono text-muted-foreground italic">null</p>
                }
                else
                {
                    <p class="text-sm font-mono">"@boundValue"</p>
                }
            </div>
        </div>
        <CodeBlock Source="Components/Input/two-way-binding.txt" />
    </div>

    <!-- Custom Styling -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Styling</h2>
            <p class="text-sm text-muted-foreground">
                Override styles with the Class parameter.
            </p>
        </div>
        <div class="space-y-4 max-w-md">
            <div class="space-y-2">
                <label class="text-sm font-medium">Custom border color</label>
                <BbInput Type="InputType.Text" Placeholder="Blue border" Class="border-blue-500 focus-visible:ring-blue-500" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Rounded full</label>
                <BbInput Type="InputType.Search" Placeholder="Search..." Class="rounded-full" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Success state</label>
                <BbInput Type="InputType.Text" Value="Valid input" Class="border-green-500 focus-visible:ring-green-500" />
            </div>
        </div>
        <CodeBlock Source="Components/Input/custom-styling.txt" />
    </div>

    <!-- Update Timing -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Update Timing</h2>
            <p class="text-sm text-muted-foreground">
                Control when <code class="text-xs bg-muted px-1 py-0.5 rounded">ValueChanged</code> fires using the
                <code class="text-xs bg-muted px-1 py-0.5 rounded">UpdateTiming</code> parameter.
            </p>
        </div>
        <div class="grid gap-6 md:grid-cols-3 max-w-4xl">
            <div class="space-y-2">
                <label class="text-sm font-medium">Immediate (default)</label>
                <BbInput Type="InputType.Text"
                       UpdateTiming="UpdateTiming.Immediate"
                       Value="@_immediateValue"
                       ValueChanged="@((v) => _immediateValue = v)"
                       Placeholder="Fires on every keystroke" />
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_immediateValue) ? "(empty)" : _immediateValue)</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">OnChange (blur / Enter)</label>
                <BbInput Type="InputType.Text"
                       UpdateTiming="UpdateTiming.OnChange"
                       Value="@_onChangeValue"
                       ValueChanged="@((v) => _onChangeValue = v)"
                       Placeholder="Fires on blur or Enter" />
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_onChangeValue) ? "(empty)" : _onChangeValue)</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Debounced (500ms)</label>
                <BbInput Type="InputType.Text"
                       UpdateTiming="UpdateTiming.Debounced"
                       DebounceInterval="500"
                       Value="@_debouncedValue"
                       ValueChanged="@((v) => _debouncedValue = v)"
                       Placeholder="Fires after typing pauses" />
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_debouncedValue) ? "(empty)" : _debouncedValue)</p>
                </div>
            </div>
        </div>
        <CodeBlock Source="Components/Input/update-timing.txt" />
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                Input components integrate with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Name</label>
                <BbInput Type="InputType.Text" @bind-Value="formModel.Name" Placeholder="Enter your name" />
                <ValidationMessage For="@(() => formModel.Name)" class="text-sm text-destructive" />
            </div>

            <div class="space-y-2">
                <label class="text-sm font-medium">Email</label>
                <BbInput Type="InputType.Email" @bind-Value="formModel.Email" Placeholder="Enter your email" />
                <ValidationMessage For="@(() => formModel.Email)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(formMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@formMessage</p>
                </div>
            }
        </EditForm>
        <CodeBlock Source="Components/Input/form-validation.txt" />
    </div>

    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>Renders a native <code>&lt;input&gt;</code> element with the correct <code>type</code> attribute</AccessibilityItem>
            <AccessibilityItem><code>aria-label</code> provides an accessible name when no visible label is present</AccessibilityItem>
            <AccessibilityItem><code>aria-describedby</code> links helper or error text to the input for screen readers</AccessibilityItem>
            <AccessibilityItem><code>aria-invalid="true"</code> is set automatically when validation fails or manually via the AriaInvalid parameter</AccessibilityItem>
            <AccessibilityItem><code>disabled</code> attribute prevents interaction and is announced by assistive technologies</AccessibilityItem>
            <AccessibilityItem><code>required</code> attribute signals mandatory fields to screen readers and enables native validation</AccessibilityItem>
        </AriaAttributes>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="Input">
                <ApiParameter Name="Type" Type="InputType" Default="Text">
                    The HTML input type. Supports Text, Email, Password, Number, Tel, Url, Search, Date, Time, and File.
                </ApiParameter>
                <ApiParameter Name="Value" Type="string?" Default="null">
                    The current value of the input. Supports two-way binding with @@bind-Value. Empty or whitespace-only input is normalized to null.
                </ApiParameter>
                <ApiParameter Name="ValueChanged" Type="EventCallback&lt;string?&gt;" Default="">
                    Callback invoked when the input value changes. Used with Value for two-way binding.
                </ApiParameter>
                <ApiParameter Name="ValueExpression" Type="Expression&lt;Func&lt;string?&gt;&gt;?" Default="null">
                    Expression identifying the bound value. Used for EditForm validation integration.
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string?" Default="null">
                    Placeholder text displayed when the input is empty.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the input is disabled. Prevents interaction and reduces opacity.
                </ApiParameter>
                <ApiParameter Name="Required" Type="bool" Default="false">
                    Whether the input is required for form validation. Sets the HTML5 required attribute.
                </ApiParameter>
                <ApiParameter Name="UpdateTiming" Type="UpdateTiming" Default="Immediate">
                    Controls when ValueChanged fires. Immediate (every keystroke), OnChange (blur or Enter), or Debounced (after typing pauses).
                </ApiParameter>
                <ApiParameter Name="DebounceInterval" Type="int" Default="500">
                    Debounce delay in milliseconds when UpdateTiming is Debounced. Ignored for other timing modes.
                </ApiParameter>
                <ApiParameter Name="Id" Type="string?" Default="auto-generated">
                    The HTML id attribute. Used to associate the input with a label element. Auto-generated if not specified (e.g., <code>input-a3f7c2d4</code>).
                </ApiParameter>
                <ApiParameter Name="Name" Type="string?" Default="null">
                    The HTML name attribute. Auto-derived from ValueExpression inside an EditForm when not set.
                </ApiParameter>
                <ApiParameter Name="Class" Type="string?" Default="null">
                    Additional CSS classes appended to the input element for style overrides.
                </ApiParameter>
                <ApiParameter Name="AriaLabel" Type="string?" Default="null">
                    Accessible name for the input when no visible label is present.
                </ApiParameter>
                <ApiParameter Name="AriaDescribedBy" Type="string?" Default="null">
                    ID of the element containing help text or error messages for screen readers.
                </ApiParameter>
                <ApiParameter Name="AriaInvalid" Type="bool?" Default="null">
                    Manually sets aria-invalid. When null, automatically determined from EditContext validation state.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private string? boundValue;
    private string? _immediateValue;
    private string? _onChangeValue;
    private string? _debouncedValue;
    private InputFormModel formModel = new();
    private string? formMessage;

    private void HandleValidSubmit()
    {
        formMessage = $"Form submitted! Name: {formModel.Name}, Email: {formModel.Email}";
    }

    private void ResetForm()
    {
        formModel = new();
        formMessage = null;
    }

    private class InputFormModel
    {
        [Required(ErrorMessage = "Name is required.")]
        [StringLength(50, MinimumLength = 2, ErrorMessage = "Name must be between 2 and 50 characters.")]
        public string? Name { get; set; }

        [Required(ErrorMessage = "Email is required.")]
        [EmailAddress(ErrorMessage = "Please enter a valid email address.")]
        public string? Email { get; set; }
    }
}
