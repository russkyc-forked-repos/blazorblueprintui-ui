@page "/components/form-field-input"
@using System.ComponentModel.DataAnnotations

<PageTitle>FormFieldInput Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">FormFieldInput Component</h1>
            <p class="text-xl text-muted-foreground">
                An opinionated form field with built-in label, helper text, and automatic error messages.
            </p>
        </div>
    </div>

    <!-- Which form component? -->
    <div class="rounded-lg border border-dashed bg-muted/30 p-6 space-y-3">
        <h2 class="text-lg font-semibold">Which form component?</h2>
        <div class="space-y-2 text-sm text-muted-foreground">
            <p><strong>Text input</strong> (string, int, date, etc.)? &rarr; <strong>FormFieldInput&lt;T&gt;</strong> (this page)</p>
            <p><strong>Checkbox</strong>? &rarr; <a href="/components/form-field-checkbox" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldCheckbox</a></p>
            <p><strong>Switch</strong>? &rarr; <a href="/components/form-field-switch" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldSwitch</a></p>
            <p><strong>Radio group</strong>? &rarr; <a href="/components/form-field-radio-group" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldRadioGroup</a></p>
            <p><strong>Select dropdown</strong>? &rarr; <a href="/components/form-field-select" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldSelect</a></p>
            <p><strong>Searchable select</strong>? &rarr; <a href="/components/form-field-combobox" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldCombobox</a></p>
            <p><strong>Multi-select</strong>? &rarr; <a href="/components/form-field-multi-select" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldMultiSelect</a></p>
        </div>
    </div>

    <!-- Basic Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Usage</h2>
            <p class="text-sm text-muted-foreground">
                A simple form field with label and helper text. The label is automatically associated
                with the input via <code class="text-xs bg-muted px-1 py-0.5 rounded">for</code>/<code class="text-xs bg-muted px-1 py-0.5 rounded">id</code> attributes.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="string"
                       @bind-Value="_name"
                       Label="Full Name"
                       HelperText="Enter your first and last name."
                       Placeholder="John Doe" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Current value:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_name) ? "(empty)" : _name)</p>
        </div>
        <CodeBlock Source="Components/FormFieldInput/basic.txt" />
    </div>

    <!-- Auto Error Messages -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Automatic Error Messages</h2>
            <p class="text-sm text-muted-foreground">
                FormFieldInput automatically generates contextual error messages based on the error kind.
                Try entering a non-numeric value to see a parse error, or a number outside 1-100 to see a validation error.
                The helper text is replaced by the error message during the error state.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="int"
                       @bind-Value="_age"
                       Label="Age"
                       HelperText="Must be between 1 and 100."
                       Validation="v => v >= 1 && v <= 100"
                       Placeholder="Enter your age" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Current value:</p>
            <p class="text-sm font-mono">@_age</p>
        </div>
        <CodeBlock Source="Components/FormFieldInput/auto-errors.txt" />
    </div>

    <!-- Custom Error Text -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Error Text</h2>
            <p class="text-sm text-muted-foreground">
                Use the <code class="text-xs bg-muted px-1 py-0.5 rounded">ErrorText</code> parameter to override
                the auto-generated error message with a domain-specific one.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="decimal"
                       @bind-Value="_price"
                       Label="Price"
                       HelperText="Enter the product price in USD."
                       ErrorText="Please enter a valid dollar amount."
                       Format="N2"
                       Placeholder="0.00" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Current value:</p>
            <p class="text-sm font-mono">@_price</p>
        </div>
        <CodeBlock Source="Components/FormFieldInput/custom-error.txt" />
    </div>

    <!-- Email with Pattern Validation -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Pattern Validation</h2>
            <p class="text-sm text-muted-foreground">
                Combine <code class="text-xs bg-muted px-1 py-0.5 rounded">ValidationPattern</code> with FormFieldInput
                for regex-based validation with automatic error display.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="string"
                       @bind-Value="_email"
                       Label="Email Address"
                       HelperText="We'll never share your email with anyone else."
                       Type="InputType.Email"
                       ValidationPattern="@("^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$")"
                       Placeholder="you@example.com" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Current value:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_email) ? "(empty)" : _email)</p>
        </div>
        <CodeBlock Source="Components/FormFieldInput/pattern.txt" />
    </div>

    <!-- Nullable DateTime -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Nullable DateTime</h2>
            <p class="text-sm text-muted-foreground">
                All InputField features work through FormFieldInput, including nullable types and format strings.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="DateTime?"
                       @bind-Value="_birthDate"
                       Label="Date of Birth"
                       HelperText="Optional. Used for age verification."
                       Format="yyyy-MM-dd"
                       Type="InputType.Date" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Current value:</p>
            <p class="text-sm font-mono">@(_birthDate?.ToString("yyyy-MM-dd") ?? "(null)")</p>
        </div>
        <CodeBlock Source="Components/FormFieldInput/nullable-datetime.txt" />
    </div>

    <!-- Required Field -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Required Field</h2>
            <p class="text-sm text-muted-foreground">
                The <code class="text-xs bg-muted px-1 py-0.5 rounded">Required</code> parameter sets the HTML required attribute
                on the underlying input.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="string"
                       @bind-Value="_username"
                       Label="Username"
                       HelperText="Required. Choose a unique username."
                       Required="true"
                       Placeholder="johndoe" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Current value:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_username) ? "(empty)" : _username)</p>
        </div>
        <CodeBlock Source="Components/FormFieldInput/required.txt" />
    </div>

    <!-- Disabled Field -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                A disabled FormFieldInput. The label and helper text remain visible.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldInput TValue="string"
                       Value="@("readonly@example.com")"
                       Label="Email (locked)"
                       HelperText="Contact support to change your email."
                       Disabled="true" />
        </div>
        <CodeBlock Source="Components/FormFieldInput/disabled.txt" />
    </div>

    <!-- Multiple Fields (Form Example) -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Example</h2>
            <p class="text-sm text-muted-foreground">
                Multiple FormFieldInputs composed together as a simple form.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <BbFormFieldInput TValue="string"
                       @bind-Value="_formName"
                       Label="Name"
                       Required="true"
                       Placeholder="Jane Smith" />
            <BbFormFieldInput TValue="string"
                       @bind-Value="_formEmail"
                       Label="Email"
                       Type="InputType.Email"
                       Required="true"
                       Placeholder="jane@example.com" />
            <BbFormFieldInput TValue="int"
                       @bind-Value="_formAge"
                       Label="Age"
                       HelperText="Must be 18 or older."
                       Validation="v => v >= 18"
                       Placeholder="25" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-2">Form values:</p>
            <div class="space-y-1 text-sm font-mono">
                <p>Name: @(string.IsNullOrEmpty(_formName) ? "(empty)" : _formName)</p>
                <p>Email: @(string.IsNullOrEmpty(_formEmail) ? "(empty)" : _formEmail)</p>
                <p>Age: @_formAge</p>
            </div>
        </div>
        <CodeBlock Source="Components/FormFieldInput/form.txt" />
    </div>

    <!-- EditForm Integration -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">EditForm Integration</h2>
            <p class="text-sm text-muted-foreground">
                FormFieldInput works inside Blazor's <code class="text-xs bg-muted px-1 py-0.5 rounded">EditForm</code>
                with <code class="text-xs bg-muted px-1 py-0.5 rounded">DataAnnotationsValidator</code>.
                DataAnnotations validation messages are displayed automatically &mdash; no
                <code class="text-xs bg-muted px-1 py-0.5 rounded">ValidationMessage</code> component needed.
                Parse errors from InputField take visual priority over DataAnnotations errors.
            </p>
        </div>
        <div class="max-w-md">
            <EditForm Model="_editFormModel" OnValidSubmit="HandleEditFormSubmit" class="space-y-4">
                <DataAnnotationsValidator />
                <BbFormFieldInput TValue="string"
                           @bind-Value="_editFormModel.FullName"
                           Label="Full Name"
                           HelperText="Required. Enter your first and last name."
                           Placeholder="Jane Smith" />
                <BbFormFieldInput TValue="int"
                           @bind-Value="_editFormModel.Age"
                           Label="Age"
                           HelperText="Must be between 1 and 120."
                           Placeholder="25" />
                <BbFormFieldInput TValue="string"
                           @bind-Value="_editFormModel.Email"
                           Label="Email"
                           HelperText="We'll use this to contact you."
                           Type="InputType.Email"
                           Placeholder="jane@example.com" />
                <div class="flex gap-2">
                    <BbButton Type="ButtonType.Submit">Submit</BbButton>
                    <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetEditForm">Reset</BbButton>
                </div>
            </EditForm>
        </div>
        @if (_editFormSubmitted)
        {
            <div class="rounded-lg border p-4 bg-muted/50">
                <p class="text-sm font-medium mb-1">Submitted values:</p>
                <div class="space-y-1 text-sm font-mono">
                    <p>Name: @_editFormModel.FullName</p>
                    <p>Age: @_editFormModel.Age</p>
                    <p>Email: @_editFormModel.Email</p>
                </div>
            </div>
        }
        <CodeBlock Source="Components/FormFieldInput/edit-form.txt" />
    </div>

    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>Automatically associates label with input via generated ID</AccessibilityItem>
            <AccessibilityItem>Description linked via aria-describedby</AccessibilityItem>
            <AccessibilityItem>Validation errors displayed with aria-invalid</AccessibilityItem>
        </AriaAttributes>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="FormFieldInput&lt;TValue&gt;">
                <ApiParameter Name="Label" Type="string?" Default="null">
                    The label text displayed above the input.
                </ApiParameter>
                <ApiParameter Name="HelperText" Type="string?" Default="null">
                    Helper text displayed below the input. Hidden during error state.
                </ApiParameter>
                <ApiParameter Name="ErrorText" Type="string?" Default="null">
                    Manual error text override. When the field is invalid and this is set, replaces auto-generated messages.
                </ApiParameter>
                <ApiParameter Name="Orientation" Type="FieldOrientation" Default="Vertical">
                    Layout orientation of the field.
                </ApiParameter>
                <ApiParameter Name="Value" Type="TValue?" Default="null">
                    The current typed value. Use @@bind-Value for two-way binding.
                </ApiParameter>
                <ApiParameter Name="ValueChanged" Type="EventCallback&lt;TValue?&gt;">
                    Callback invoked when the typed value changes.
                </ApiParameter>
                <ApiParameter Name="Type" Type="InputType" Default="Text">
                    The type of input (Text, Email, Password, Date, etc.).
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string?" Default="null">
                    Placeholder text displayed when the input is empty.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the input is disabled.
                </ApiParameter>
                <ApiParameter Name="Required" Type="bool" Default="false">
                    Whether the input is required (sets the HTML required attribute).
                </ApiParameter>
                <ApiParameter Name="Validation" Type="Func&lt;TValue, bool&gt;?" Default="null">
                    Post-parse validation function. Returns true if the value is valid.
                </ApiParameter>
                <ApiParameter Name="ValidationPattern" Type="string?" Default="null">
                    Regex pattern for pre-parse validation.
                </ApiParameter>
                <ApiParameter Name="Format" Type="string?" Default="null">
                    Display format string (e.g., "N2", "yyyy-MM-dd").
                </ApiParameter>
                <ApiParameter Name="Converter" Type="InputConverter&lt;TValue&gt;?" Default="null">
                    Optional custom converter for value parsing and formatting.
                </ApiParameter>
                <ApiParameter Name="UpdateTiming" Type="UpdateTiming" Default="Immediate">
                    When ValueChanged fires (Immediate or Debounced).
                </ApiParameter>
                <ApiParameter Name="DebounceInterval" Type="int" Default="500">
                    Debounce delay in milliseconds when using Debounced update timing.
                </ApiParameter>
                <ApiParameter Name="InputClass" Type="string?" Default="null">
                    Additional CSS classes applied to the inner InputField element.
                </ApiParameter>
                <ApiParameter Name="Class" Type="string?" Default="null">
                    Additional CSS classes applied to the outer Field container.
                </ApiParameter>
                <ApiParameter Name="AriaLabel" Type="string?" Default="null">
                    ARIA label for the control.
                </ApiParameter>
                <ApiParameter Name="Name" Type="string?" Default="null">
                    HTML name attribute passed through to the inner InputField.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private string? _name;
    private int _age;
    private decimal _price = 19.99m;
    private string? _email;
    private DateTime? _birthDate;
    private string? _username;
    private string? _formName;
    private string? _formEmail;
    private int _formAge;

    // EditForm integration
    private EditFormModel _editFormModel = new();
    private bool _editFormSubmitted;

    private void HandleEditFormSubmit()
    {
        _editFormSubmitted = true;
    }

    private void ResetEditForm()
    {
        _editFormModel = new();
        _editFormSubmitted = false;
    }

    private sealed class EditFormModel
    {
        [Required(ErrorMessage = "Name is required.")]
        [StringLength(100, ErrorMessage = "Name must be 100 characters or fewer.")]
        public string? FullName { get; set; }

        [Range(1, 120, ErrorMessage = "Age must be between 1 and 120.")]
        public int Age { get; set; }

        [Required(ErrorMessage = "Email is required.")]
        [EmailAddress(ErrorMessage = "Please enter a valid email address.")]
        public string? Email { get; set; }
    }
}
