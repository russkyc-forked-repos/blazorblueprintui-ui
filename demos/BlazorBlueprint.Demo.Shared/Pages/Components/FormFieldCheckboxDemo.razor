@page "/components/form-field-checkbox"
@using System.ComponentModel.DataAnnotations

<PageTitle>FormFieldCheckbox Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">FormFieldCheckbox</h1>
            <p class="text-xl text-muted-foreground">
                A form field wrapper for Checkbox with built-in label, helper text, and error messages.
            </p>
        </div>
    </div>

    <!-- Which form component? -->
    <div class="rounded-lg border border-dashed bg-muted/30 p-6 space-y-3">
        <h2 class="text-lg font-semibold">Which form component?</h2>
        <div class="space-y-2 text-sm text-muted-foreground">
            <p><strong>Text input</strong> (string, int, date, etc.)? &rarr; <a href="/components/form-field-input" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldInput&lt;T&gt;</a></p>
            <p><strong>Checkbox</strong>? &rarr; <strong>FormFieldCheckbox</strong> (this page)</p>
            <p><strong>Switch</strong>? &rarr; <a href="/components/form-field-switch" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldSwitch</a></p>
            <p><strong>Radio group</strong>? &rarr; <a href="/components/form-field-radio-group" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldRadioGroup</a></p>
            <p><strong>Select dropdown</strong>? &rarr; <a href="/components/form-field-select" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldSelect</a></p>
            <p><strong>Searchable select</strong>? &rarr; <a href="/components/form-field-combobox" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldCombobox</a></p>
            <p><strong>Multi-select</strong>? &rarr; <a href="/components/form-field-multi-select" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldMultiSelect</a></p>
        </div>
    </div>

    <!-- Basic Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Usage</h2>
            <p class="text-sm text-muted-foreground">
                A checkbox with an auto-associated label and helper text.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldCheckbox @bind-Checked="_acceptTerms"
                               Label="Accept terms and conditions"
                               HelperText="You must accept before continuing." />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Checked:</p>
            <p class="text-sm font-mono">@_acceptTerms</p>
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/basic.txt" />
    </div>

    <!-- Horizontal Layout -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Horizontal Layout</h2>
            <p class="text-sm text-muted-foreground">
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">Orientation="FieldOrientation.Horizontal"</code> to place the label beside the checkbox.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldCheckbox @bind-Checked="_newsletter"
                               Label="Subscribe to newsletter"
                               HelperText="Get weekly updates."
                               Orientation="FieldOrientation.Horizontal" />
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/horizontal.txt" />
    </div>

    <!-- Label on Right -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Label on Right (Default)</h2>
            <p class="text-sm text-muted-foreground">
                The default orientation is <code class="text-xs bg-muted px-1 py-0.5 rounded">FieldOrientation.HorizontalEnd</code>, which places the label after the checkbox. This is the most common pattern for inline checkboxes.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldCheckbox @bind-Checked="_rightLabel"
                               Label="I agree to the terms and conditions"
                               HelperText="Required to continue." />
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/label-right.txt" />
    </div>

    <!-- Label on Bottom -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Label on Bottom</h2>
            <p class="text-sm text-muted-foreground">
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">Orientation="FieldOrientation.VerticalEnd"</code> to place the label below the checkbox.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldCheckbox @bind-Checked="_bottomLabel"
                               Label="Enable feature"
                               HelperText="This can be changed later."
                               Orientation="FieldOrientation.VerticalEnd" />
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/label-bottom.txt" />
    </div>

    <!-- Indeterminate (Select All) -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Indeterminate</h2>
            <p class="text-sm text-muted-foreground">
                A parent checkbox that reflects the aggregate state of its children.
                When some (but not all) items are selected, the parent shows an indeterminate dash.
            </p>
        </div>
        <div class="max-w-md space-y-3">
            <BbFormFieldCheckbox Checked="@_selectAllChecked"
                               CheckedChanged="HandleSelectAllChanged"
                               Indeterminate="@_selectAllIndeterminate"
                               Label="Select all permissions" />
            <div class="ml-6 space-y-1">
                <BbFormFieldCheckbox Checked="@_permRead"
                                   CheckedChanged="@(v => { _permRead = v; UpdatePermSelectAll(); })"
                                   Label="Read" />
                <BbFormFieldCheckbox Checked="@_permWrite"
                                   CheckedChanged="@(v => { _permWrite = v; UpdatePermSelectAll(); })"
                                   Label="Write" />
                <BbFormFieldCheckbox Checked="@_permDelete"
                                   CheckedChanged="@(v => { _permDelete = v; UpdatePermSelectAll(); })"
                                   Label="Delete" />
            </div>
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/indeterminate.txt" />
    </div>

    <!-- Error Text -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Error Text Override</h2>
            <p class="text-sm text-muted-foreground">
                Provide a static error message via <code class="text-xs bg-muted px-1 py-0.5 rounded">ErrorText</code>.
                When used inside an EditForm, validation errors display automatically.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldCheckbox @bind-Checked="_errorDemo"
                               Label="Required checkbox"
                               ErrorText="@(_errorDemoError)" />
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/error-text.txt" />
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                A disabled checkbox form field.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldCheckbox Checked="true"
                               Label="Locked preference"
                               HelperText="Contact support to change."
                               Disabled="true" />
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/disabled.txt" />
    </div>

    <!-- EditForm Integration -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">EditForm Integration</h2>
            <p class="text-sm text-muted-foreground">
                Inside an <code class="text-xs bg-muted px-1 py-0.5 rounded">EditForm</code>,
                validation errors are displayed automatically. Try submitting without checking the box.
            </p>
        </div>
        <div class="max-w-md">
            <EditForm Model="_formModel" OnValidSubmit="HandleFormSubmit">
                <DataAnnotationsValidator />
                <div class="space-y-4">
                    <BbFormFieldCheckbox @bind-Checked="_formModel.AgreeToTerms"
                                       Label="I agree to the terms of service" />
                    <BbButton Type="ButtonType.Submit">Submit</BbButton>
                </div>
            </EditForm>
            @if (_formSubmitted)
            {
                <div class="mt-4 rounded-lg border border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800 p-4">
                    <p class="text-sm font-medium text-green-800 dark:text-green-200">Form submitted successfully!</p>
                </div>
            }
        </div>
        <CodeBlock Source="Components/FormFieldCheckbox/edit-form.txt" />
    </div>

    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>Automatically associates label with input via generated ID</AccessibilityItem>
            <AccessibilityItem>Description linked via aria-describedby</AccessibilityItem>
            <AccessibilityItem>Validation errors displayed with aria-invalid</AccessibilityItem>
        </AriaAttributes>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="FormFieldCheckbox">
                <ApiParameter Name="Label" Type="string?" Default="null">
                    The label text displayed above or beside the checkbox.
                </ApiParameter>
                <ApiParameter Name="HelperText" Type="string?" Default="null">
                    Helper text displayed below the checkbox. Hidden during error state.
                </ApiParameter>
                <ApiParameter Name="ErrorText" Type="string?" Default="null">
                    Manual error text override. When the field is invalid and this is set, replaces auto-generated messages.
                </ApiParameter>
                <ApiParameter Name="Orientation" Type="FieldOrientation" Default="HorizontalEnd">
                    Layout orientation. Default places the label after the checkbox.
                </ApiParameter>
                <ApiParameter Name="Checked" Type="bool" Default="false">
                    Whether the checkbox is checked. Use @@bind-Checked for two-way binding.
                </ApiParameter>
                <ApiParameter Name="CheckedChanged" Type="EventCallback&lt;bool&gt;">
                    Callback invoked when the checked state changes.
                </ApiParameter>
                <ApiParameter Name="Indeterminate" Type="bool" Default="false">
                    Whether the checkbox is in an indeterminate state.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the checkbox is disabled.
                </ApiParameter>
                <ApiParameter Name="InputClass" Type="string?" Default="null">
                    Additional CSS classes applied to the inner Checkbox element.
                </ApiParameter>
                <ApiParameter Name="Class" Type="string?" Default="null">
                    Additional CSS classes applied to the outer Field container.
                </ApiParameter>
                <ApiParameter Name="AriaLabel" Type="string?" Default="null">
                    ARIA label for the control.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private bool _acceptTerms;
    private bool _newsletter;
    private bool _rightLabel;
    private bool _bottomLabel;
    private bool _errorDemo;
    private bool _formSubmitted;

    // Indeterminate (Select All)
    private bool _selectAllChecked;
    private bool _selectAllIndeterminate;
    private bool _permRead = true;
    private bool _permWrite;
    private bool _permDelete;

    protected override void OnInitialized() => UpdatePermSelectAll();

    private void HandleSelectAllChanged(bool value)
    {
        _selectAllChecked = value;
        _selectAllIndeterminate = false;
        _permRead = value;
        _permWrite = value;
        _permDelete = value;
    }

    private void UpdatePermSelectAll()
    {
        var all = _permRead && _permWrite && _permDelete;
        var none = !_permRead && !_permWrite && !_permDelete;
        _selectAllChecked = all;
        _selectAllIndeterminate = !all && !none;
    }
    private CheckboxFormModel _formModel = new();

    private string? _errorDemoError => !_errorDemo ? "This field is required." : null;

    private void HandleFormSubmit()
    {
        _formSubmitted = true;
    }

    private class CheckboxFormModel
    {
        [Range(typeof(bool), "true", "true", ErrorMessage = "You must agree to the terms.")]
        public bool AgreeToTerms { get; set; }
    }
}
