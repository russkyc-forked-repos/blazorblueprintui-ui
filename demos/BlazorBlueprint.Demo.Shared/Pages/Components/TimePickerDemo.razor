@page "/components/time-picker"
@using System.ComponentModel.DataAnnotations

<PageTitle>TimePicker Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">TimePicker Component</h1>
            <p class="text-xl text-muted-foreground">
                A time selection component with 12/24-hour format support, minute stepping, and time constraints.
            </p>
        </div>
    </div>

    <!-- Basic 12-Hour -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">12-Hour Format (Default)</h2>
            <p class="text-sm text-muted-foreground">
                Standard 12-hour format with AM/PM toggle.
            </p>
        </div>
        <BbTimePicker @bind-Value="_time12" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_time12.HasValue ? FormatTime12(_time12.Value) : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/12-hour.txt" />
    </div>

    <!-- 24-Hour Format -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">24-Hour Format</h2>
            <p class="text-sm text-muted-foreground">
                Military/international time format.
            </p>
        </div>
        <BbTimePicker @bind-Value="_time24" Format="TimeFormat.Hour24" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_time24.HasValue ? _time24.Value.ToString(@"hh\:mm") : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/24-hour.txt" />
    </div>

    <!-- With Seconds -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Seconds</h2>
            <p class="text-sm text-muted-foreground">
                Shows seconds selector for precise time selection.
            </p>
        </div>
        <BbTimePicker @bind-Value="_timeSeconds" ShowSeconds="true" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_timeSeconds.HasValue ? FormatTime12WithSeconds(_timeSeconds.Value) : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/with-seconds.txt" />
    </div>

    <!-- 24-Hour with Seconds -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">24-Hour with Seconds</h2>
        </div>
        <BbTimePicker @bind-Value="_time24Seconds" Format="TimeFormat.Hour24" ShowSeconds="true" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_time24Seconds.HasValue ? _time24Seconds.Value.ToString(@"hh\:mm\:ss") : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/24-hour-with-seconds.txt" />
    </div>

    <!-- Minute Step -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">15-Minute Intervals</h2>
            <p class="text-sm text-muted-foreground">
                Minutes increment by 15 (0, 15, 30, 45).
            </p>
        </div>
        <BbTimePicker @bind-Value="_timeStep15" MinuteStep="15" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_timeStep15.HasValue ? FormatTime12(_timeStep15.Value) : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/15-minute-intervals.txt" />
    </div>

    <!-- 5-Minute Step -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">5-Minute Intervals</h2>
        </div>
        <BbTimePicker @bind-Value="_timeStep5" MinuteStep="5" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_timeStep5.HasValue ? FormatTime12(_timeStep5.Value) : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/5-minute-intervals.txt" />
    </div>

    <!-- With Time Constraints -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Business Hours (9 AM - 5 PM)</h2>
            <p class="text-sm text-muted-foreground">
                Time is constrained to business hours.
            </p>
        </div>
        <BbTimePicker @bind-Value="_timeConstrained"
                    MinTime="@(new TimeSpan(9, 0, 0))"
                    MaxTime="@(new TimeSpan(17, 0, 0))" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_timeConstrained.HasValue ? FormatTime12(_timeConstrained.Value) : "None") (9:00 AM - 5:00 PM)
        </p>
        <CodeBlock Source="Components/TimePicker/business-hours.txt" />
    </div>

    <!-- Pre-selected Value -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Pre-selected Value</h2>
            <p class="text-sm text-muted-foreground">
                Initialized with 2:30 PM.
            </p>
        </div>
        <BbTimePicker @bind-Value="_timePreset" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_timePreset.HasValue ? FormatTime12(_timePreset.Value) : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/pre-selected.txt" />
    </div>

    <!-- Custom Placeholder -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Placeholder</h2>
        </div>
        <BbTimePicker @bind-Value="_timePlaceholder" Placeholder="Choose meeting time" />
        <p class="text-sm text-muted-foreground">
            Selected: @(_timePlaceholder.HasValue ? FormatTime12(_timePlaceholder.Value) : "None")
        </p>
        <CodeBlock Source="Components/TimePicker/custom-placeholder.txt" />
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
        </div>
        <BbTimePicker Value="@(new TimeSpan(10, 30, 0))" Disabled="true" />
        <CodeBlock Source="Components/TimePicker/disabled.txt" />
    </div>

    <!-- Multiple Pickers -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Start and End Time</h2>
            <p class="text-sm text-muted-foreground">
                Common pattern for scheduling.
            </p>
        </div>
        <div class="flex items-center gap-4">
            <div>
                <label class="text-sm font-medium mb-1 block">Start</label>
                <BbTimePicker @bind-Value="_startTime" />
            </div>
            <span class="mt-6">to</span>
            <div>
                <label class="text-sm font-medium mb-1 block">End</label>
                <BbTimePicker @bind-Value="_endTime" />
            </div>
        </div>
        <p class="text-sm text-muted-foreground">
            @if (_startTime.HasValue && _endTime.HasValue)
            {
                var duration = _endTime.Value - _startTime.Value;
                if (duration < TimeSpan.Zero) duration += TimeSpan.FromHours(24);
                @($"Duration: {duration.Hours}h {duration.Minutes}m")
            }
            else
            {
                @("Select both times to see duration")
            }
        </p>
        <CodeBlock Source="Components/TimePicker/start-end-time.txt" />
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                TimePicker integrates with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="timeFormModel" OnValidSubmit="HandleTimeFormSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Meeting Time</label>
                <BbTimePicker @bind-Value="timeFormModel.MeetingTime" />
                <ValidationMessage For="@(() => timeFormModel.MeetingTime)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetTimeForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(timeFormMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@timeFormMessage</p>
                </div>
            }
        </EditForm>
    </div>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>

        <div class="space-y-4">
            <ApiReference ComponentName="TimePicker">
                <ApiParameter Name="Value" Type="TimeSpan?">
                    Selected time value.
                </ApiParameter>
                <ApiParameter Name="Format" Type="TimeFormat" Default="Hour12">
                    Time format. Options: Hour12 or Hour24.
                </ApiParameter>
                <ApiParameter Name="ShowSeconds" Type="bool" Default="false">
                    Show seconds selector for precise time selection.
                </ApiParameter>
                <ApiParameter Name="MinuteStep" Type="int" Default="1">
                    Minute increment value. Valid values: 1, 5, 10, 15, 30.
                </ApiParameter>
                <ApiParameter Name="MinTime" Type="TimeSpan?">
                    Minimum allowed time constraint.
                </ApiParameter>
                <ApiParameter Name="MaxTime" Type="TimeSpan?">
                    Maximum allowed time constraint.
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string" Default="Select time">
                    Placeholder text displayed when no time is selected.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Disables the picker and prevents interaction.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private TimeSpan? _time12;
    private TimeSpan? _time24;
    private TimeSpan? _timeSeconds;
    private TimeSpan? _time24Seconds;
    private TimeSpan? _timeStep15;
    private TimeSpan? _timeStep5;
    private TimeSpan? _timeConstrained;
    private TimeSpan? _timePreset = new TimeSpan(14, 30, 0);
    private TimeSpan? _timePlaceholder;
    private TimeSpan? _startTime = new TimeSpan(9, 0, 0);
    private TimeSpan? _endTime = new TimeSpan(17, 0, 0);

    private string FormatTime12(TimeSpan time)
    {
        var hour = time.Hours % 12;
        if (hour == 0) hour = 12;
        var amPm = time.Hours < 12 ? "AM" : "PM";
        return $"{hour:D2}:{time.Minutes:D2} {amPm}";
    }

    private string FormatTime12WithSeconds(TimeSpan time)
    {
        var hour = time.Hours % 12;
        if (hour == 0) hour = 12;
        var amPm = time.Hours < 12 ? "AM" : "PM";
        return $"{hour:D2}:{time.Minutes:D2}:{time.Seconds:D2} {amPm}";
    }

    private TimeFormModel timeFormModel = new();
    private string? timeFormMessage;

    private void HandleTimeFormSubmit()
    {
        timeFormMessage = $"Form submitted! Meeting Time: {(timeFormModel.MeetingTime.HasValue ? FormatTime12(timeFormModel.MeetingTime.Value) : "None")}";
    }

    private void ResetTimeForm()
    {
        timeFormModel = new();
        timeFormMessage = null;
    }

    private class TimeFormModel
    {
        [Required(ErrorMessage = "Please select a meeting time.")]
        public TimeSpan? MeetingTime { get; set; }
    }
}
