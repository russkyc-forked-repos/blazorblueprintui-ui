@page "/components/textarea"
@using System.ComponentModel.DataAnnotations

<PageTitle>Textarea Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Textarea Component</h1>
        <p class="text-xl text-muted-foreground">
            Displays a multi-line text input field that follows the shadcn/ui design system.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <!-- Default Textarea -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Default</h2>
            <p class="text-sm text-muted-foreground">
                A simple textarea with placeholder and automatic content sizing.
            </p>
        </div>
        <div class="max-w-md">
            <BbTextarea Placeholder="Type your message here." />
        </div>
        <CodeBlock Source="Components/Textarea/default.txt" />
    </div>

    <!-- Disabled State -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                Textarea with disabled state.
            </p>
        </div>
        <div class="max-w-md">
            <BbTextarea Placeholder="Disabled textarea" Disabled="true" Value="Cannot edit this text." />
        </div>
        <CodeBlock Source="Components/Textarea/disabled.txt" />
    </div>

    <!-- Required State -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Required</h2>
            <p class="text-sm text-muted-foreground">
                Textarea with HTML5 required validation.
            </p>
        </div>
        <div class="max-w-md">
            <form class="space-y-4">
                <div class="space-y-2">
                    <label class="text-sm font-medium">Message (required)</label>
                    <BbTextarea Placeholder="Enter your message" Required="true" />
                </div>
                <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90">
                    Submit
                </button>
            </form>
        </div>
        <CodeBlock Source="Components/Textarea/required.txt" />
    </div>

    <!-- With Label and Description -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Label</h2>
            <p class="text-sm text-muted-foreground">
                Textarea with labels and helper text.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <div class="space-y-2">
                <label for="bio-textarea" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Bio
                </label>
                <BbTextarea Placeholder="Tell us about yourself..." AriaLabel="Biography" />
                <p class="text-sm text-muted-foreground">
                    Your bio will be displayed on your public profile.
                </p>
            </div>

            <div class="space-y-2">
                <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Comments
                </label>
                <BbTextarea Placeholder="Leave a comment..." AriaLabel="Comments" />
                <p class="text-sm text-muted-foreground">
                    Share your thoughts with the community.
                </p>
            </div>
        </div>
        <CodeBlock Source="Components/Textarea/with-label.txt" />
    </div>

    <!-- MaxLength -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Character Limit</h2>
            <p class="text-sm text-muted-foreground">
                Textarea with maximum character limit using MaxLength parameter.
            </p>
        </div>
        <div class="max-w-md">
            <div class="space-y-2">
                <label class="text-sm font-medium">Tweet (max 280 characters)</label>
                <BbTextarea MaxLength="280" Placeholder="What's happening?" Value="@tweetValue" ValueChanged="@((value) => tweetValue = value)" />
                <p class="text-xs text-muted-foreground">
                    @(tweetValue?.Length ?? 0) / 280 characters
                </p>
            </div>
        </div>
        <CodeBlock Source="Components/Textarea/character-limit.txt" />
    </div>

    <!-- Built-in Character Count -->
    <div class="space-y-4">
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <h2 class="text-2xl font-semibold">Built-in Character Count</h2>
                <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary ring-1 ring-inset ring-primary/20">v3</span>
            </div>
            <p class="text-sm text-muted-foreground">
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">ShowCharacterCount="true"</code> to display a built-in character counter below the textarea. When <code class="text-xs bg-muted px-1 py-0.5 rounded">MaxLength</code> is set, it shows the count in a <code class="text-xs bg-muted px-1 py-0.5 rounded">current/max</code> format.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <div class="space-y-2">
                <label class="text-sm font-medium">With MaxLength</label>
                <BbTextarea ShowCharacterCount="true" MaxLength="280" Placeholder="What's happening?" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Without MaxLength</label>
                <BbTextarea ShowCharacterCount="true" Placeholder="Free-form text..." />
            </div>
        </div>
        <CodeBlock Source="Components/Textarea/character-count.txt" />
    </div>

    <!-- Two-Way Binding Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Two-Way Binding</h2>
            <p class="text-sm text-muted-foreground">
                Demonstrating real-time value updates using Value and ValueChanged.
                Empty or whitespace-only input is automatically normalized to <code class="text-xs bg-muted px-1 py-0.5 rounded">null</code>,
                matching ASP.NET MVC model binding conventions.
            </p>
        </div>
        <div class="max-w-md space-y-4">
            <div class="space-y-2">
                <label class="text-sm font-medium">Type something</label>
                <BbTextarea Value="@boundValue" ValueChanged="@((value) => boundValue = value)" Placeholder="Start typing..." />
                <p class="text-xs text-muted-foreground">
                    Try typing text, then clearing it. The value returns to <code class="text-xs bg-muted px-1 py-0.5 rounded">null</code> instead of becoming an empty string.
                </p>
            </div>
            <div class="rounded-lg border p-4 bg-muted/50">
                <p class="text-sm font-medium mb-1">Current value:</p>
                @if (boundValue is null)
                {
                    <p class="text-sm font-mono text-muted-foreground italic">null</p>
                }
                else
                {
                    <p class="text-sm font-mono whitespace-pre-wrap break-words">"@boundValue"</p>
                }
                <p class="text-xs text-muted-foreground mt-2">
                    Character count: @(boundValue?.Length ?? 0)
                </p>
            </div>
        </div>
        <CodeBlock Source="Components/Textarea/two-way-binding.txt" />
    </div>

    <!-- Update Timing -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Update Timing</h2>
            <p class="text-sm text-muted-foreground">
                Control when <code class="text-xs bg-muted px-1 py-0.5 rounded">ValueChanged</code> fires using the
                <code class="text-xs bg-muted px-1 py-0.5 rounded">UpdateTiming</code> parameter.
            </p>
        </div>
        <div class="grid gap-6 md:grid-cols-3 max-w-4xl">
            <div class="space-y-2">
                <label class="text-sm font-medium">Immediate (default)</label>
                <BbTextarea UpdateTiming="UpdateTiming.Immediate"
                          Value="@_immediateValue"
                          ValueChanged="@((v) => _immediateValue = v)"
                          Placeholder="Fires on every keystroke" />
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_immediateValue) ? "(empty)" : _immediateValue)</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">OnChange (blur / Enter)</label>
                <BbTextarea UpdateTiming="UpdateTiming.OnChange"
                          Value="@_onChangeValue"
                          ValueChanged="@((v) => _onChangeValue = v)"
                          Placeholder="Fires on blur or Enter" />
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_onChangeValue) ? "(empty)" : _onChangeValue)</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Debounced (500ms)</label>
                <BbTextarea UpdateTiming="UpdateTiming.Debounced"
                          DebounceInterval="500"
                          Value="@_debouncedValue"
                          ValueChanged="@((v) => _debouncedValue = v)"
                          Placeholder="Fires after typing pauses" />
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_debouncedValue) ? "(empty)" : _debouncedValue)</p>
                </div>
            </div>
        </div>
        <CodeBlock Source="Components/Textarea/update-timing.txt" />
    </div>

    <!-- Custom Styling -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Styling</h2>
            <p class="text-sm text-muted-foreground">
                Override styles with the Class parameter.
            </p>
        </div>
        <div class="space-y-4 max-w-md">
            <div class="space-y-2">
                <label class="text-sm font-medium">Custom border color</label>
                <BbTextarea Placeholder="Blue border" Class="border-blue-500 focus-visible:ring-blue-500" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Custom height</label>
                <BbTextarea Placeholder="Taller textarea" Class="min-h-32" />
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Success state</label>
                <BbTextarea Value="Valid message" Class="border-green-500 focus-visible:ring-green-500" />
            </div>
        </div>
        <CodeBlock Source="Components/Textarea/custom-styling.txt" />
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                Textarea integrates with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Bio</label>
                <BbTextarea @bind-Value="formModel.Bio" Placeholder="Tell us about yourself..." />
                <ValidationMessage For="@(() => formModel.Bio)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(formMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@formMessage</p>
                </div>
            }
        </EditForm>
        <CodeBlock Source="Components/Textarea/form-validation.txt" />
    </div>

    <!-- API Reference -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
        </div>
        <div class="border rounded-lg p-6 space-y-4">
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Value</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">string?</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    The current value of the textarea. Supports two-way binding with @("@")bind-Value.
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Placeholder</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">string?</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Placeholder text shown when textarea is empty.
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">MaxLength</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">int?</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Maximum number of characters allowed. Browser will prevent exceeding this limit.
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Disabled</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">bool</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Whether the textarea is disabled. Default: false
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Required</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">bool</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Whether the textarea is required for form validation. Default: false
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">ARIA Attributes</h3>
                <p class="text-sm text-muted-foreground">
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">AriaLabel</code>,
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">AriaDescribedBy</code>,
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">AriaInvalid</code> for accessibility.
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">UpdateTiming</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">UpdateTiming</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Controls when ValueChanged fires. Options: Immediate (default), OnChange, Debounced.
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">DebounceInterval</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">int</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Debounce delay in milliseconds when UpdateTiming is Debounced. Default: 500
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">ShowCharacterCount</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">bool</code> â€” Default: <code class="text-xs bg-muted px-1 py-0.5 rounded">false</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    When true, displays a character counter below the textarea. Shows current/max format when MaxLength is set.
                </p>
            </div>
            <BbSeparator />
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Class</h3>
                <p class="text-sm text-muted-foreground mb-2">
                    Type: <code class="text-xs bg-muted px-1 py-0.5 rounded">string?</code>
                </p>
                <p class="text-sm text-muted-foreground">
                    Additional CSS classes to apply. Custom classes override default styles.
                </p>
            </div>
        </div>
    </div>
</div>

@code {
    private string? boundValue;
    private string? tweetValue;
    private string? _immediateValue;
    private string? _onChangeValue;
    private string? _debouncedValue;
    private TextareaFormModel formModel = new();
    private string? formMessage;

    private void HandleValidSubmit()
    {
        formMessage = $"Form submitted! Bio: {formModel.Bio}";
    }

    private void ResetForm()
    {
        formModel = new();
        formMessage = null;
    }

    private class TextareaFormModel
    {
        [Required(ErrorMessage = "Bio is required.")]
        [StringLength(500, MinimumLength = 10, ErrorMessage = "Bio must be between 10 and 500 characters.")]
        public string? Bio { get; set; }
    }
}
