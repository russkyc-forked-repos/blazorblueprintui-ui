@page "/components/popover"
@using BlazorBlueprint.Primitives.Services
<PageTitle>Popover Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Popover Component</h1>
        <p class="text-xl text-muted-foreground">
            Styled Popover component with shadcn/ui design.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <!-- AsChild Pattern -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">AsChild Pattern</h2>
        <p class="text-sm text-muted-foreground">
            Use AsChild to compose triggers with your own styled Button components.
        </p>

        <div class="grid md:grid-cols-2 gap-6">
            <!-- Without AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">Without AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    PopoverTrigger renders its own button with inline classes.
                </p>
                <BbPopover>
                    <BbPopoverTrigger AsChild="false" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Open Popover
                    </BbPopoverTrigger>
                    <BbPopoverContent>
                        <p class="text-sm">Basic popover content</p>
                    </BbPopoverContent>
                </BbPopover>
            </div>

            <!-- With AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">With AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    Button receives trigger behavior via TriggerContext.
                </p>
                <BbPopover>
                    <BbPopoverTrigger>
                        <BbButton Variant="ButtonVariant.Outline">
                            <LucideIcon Name="settings" Size="16" />
                            Settings
                        </BbButton>
                    </BbPopoverTrigger>
                    <BbPopoverContent>
                        <div class="space-y-2">
                            <h4 class="font-medium">Settings</h4>
                            <p class="text-sm text-muted-foreground">Configure your preferences</p>
                        </div>
                    </BbPopoverContent>
                </BbPopover>
            </div>
        </div>

        <CodeBlock Source="Components/Popover/as-child.txt" />
    </section>

    <section class="space-y-4">
        <h2 class="text-2xl font-semibold mb-4">Basic Popover</h2>
        <BbPopover>
            <BbPopoverTrigger>
                <BbButton Variant="ButtonVariant.Outline">Open Popover</BbButton>
            </BbPopoverTrigger>
            <BbPopoverContent>
                <div class="grid gap-4">
                    <div class="space-y-2">
                        <h4 class="font-medium leading-none">Dimensions</h4>
                        <p class="text-sm text-muted-foreground">
                            Set the dimensions for the layer.
                        </p>
                    </div>
                    <div class="grid gap-2">
                        <div class="grid grid-cols-3 items-center gap-4">
                            <label class="text-sm font-medium">Width</label>
                            <input class="col-span-2 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm" type="number" value="100" />
                        </div>
                        <div class="grid grid-cols-3 items-center gap-4">
                            <label class="text-sm font-medium">Height</label>
                            <input class="col-span-2 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm" type="number" value="100" />
                        </div>
                    </div>
                </div>
            </BbPopoverContent>
        </BbPopover>

        <CodeBlock Source="Components/Popover/basic.txt" />
    </section>

    <section>
        <h2 class="text-2xl font-semibold mb-4">Positioning</h2>
        <div class="flex flex-wrap gap-4">
            <BbPopover>
                <BbPopoverTrigger>
                    <BbButton Variant="ButtonVariant.Secondary">Top</BbButton>
                </BbPopoverTrigger>
                <BbPopoverContent Side="@PopoverSide.Top">
                    <p class="text-sm">Positioned on top</p>
                </BbPopoverContent>
            </BbPopover>

            <BbPopover>
                <BbPopoverTrigger>
                    <BbButton Variant="ButtonVariant.Secondary">Bottom</BbButton>
                </BbPopoverTrigger>
                <BbPopoverContent Side="@PopoverSide.Bottom">
                    <p class="text-sm">Positioned on bottom</p>
                </BbPopoverContent>
            </BbPopover>

            <BbPopover>
                <BbPopoverTrigger>
                    <BbButton Variant="ButtonVariant.Secondary">Left</BbButton>
                </BbPopoverTrigger>
                <BbPopoverContent Side="@PopoverSide.Left">
                    <p class="text-sm">Positioned on left</p>
                </BbPopoverContent>
            </BbPopover>

            <BbPopover>
                <BbPopoverTrigger>
                    <BbButton Variant="ButtonVariant.Secondary">Right</BbButton>
                </BbPopoverTrigger>
                <BbPopoverContent Side="@PopoverSide.Right">
                    <p class="text-sm">Positioned on right</p>
                </BbPopoverContent>
            </BbPopover>
        </div>

        <CodeBlock Source="Components/Popover/positioning.txt" />
    </section>

    <section>
        <h2 class="text-2xl font-semibold mb-4">Controlled Popover</h2>
        <div class="flex items-center gap-4">
            <BbPopover @bind-Open="_isControlledOpen">
                <BbPopoverTrigger>
                    <BbButton>@(_isControlledOpen ? "Close" : "Open") Controlled</BbButton>
                </BbPopoverTrigger>
                <BbPopoverContent>
                    <div class="space-y-2">
                        <p class="text-sm">This popover is controlled externally.</p>
                        <p class="text-sm font-medium">State: @(_isControlledOpen ? "Open" : "Closed")</p>
                    </div>
                </BbPopoverContent>
            </BbPopover>
            <BbButton Variant="ButtonVariant.Outline" OnClick="() => _isControlledOpen = !_isControlledOpen">
                Toggle from Outside
            </BbButton>
        </div>

        <CodeBlock Source="Components/Popover/controlled.txt" />
    </section>

    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>
                Trigger renders <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-haspopup="true"</code> to indicate a popup is available
            </AccessibilityItem>
            <AccessibilityItem>
                Trigger renders <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-expanded</code> reflecting the current open state
            </AccessibilityItem>
            <AccessibilityItem>
                Trigger renders <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-controls</code> linking to the popover content element
            </AccessibilityItem>
            <AccessibilityItem>
                Content container uses <code class="text-xs bg-muted px-1 py-0.5 rounded">role="group"</code> and receives focus with <code class="text-xs bg-muted px-1 py-0.5 rounded">tabindex="-1"</code>
            </AccessibilityItem>
            <AccessibilityItem>
                Content includes <code class="text-xs bg-muted px-1 py-0.5 rounded">data-state</code> attribute for open/closed styling hooks
            </AccessibilityItem>
        </AriaAttributes>
        <KeyboardNavigation>
            <KeyboardShortcutItem Description="Close the popover">
                <BbKbd>Escape</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Move focus into or within the popover">
                <BbKbd>Tab</BbKbd>
            </KeyboardShortcutItem>
        </KeyboardNavigation>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="Popover">
                <ApiParameter Name="Open" Type="bool?" Default="null">
                    Controls whether the popover is open (controlled mode). When null, the popover manages its own state.
                </ApiParameter>
                <ApiParameter Name="OpenChanged" Type="EventCallback&lt;bool&gt;">
                    Event callback invoked when the open state changes. Use with @@bind-Open for two-way binding.
                </ApiParameter>
                <ApiParameter Name="DefaultOpen" Type="bool" Default="false">
                    Default open state when in uncontrolled mode.
                </ApiParameter>
                <ApiParameter Name="OnOpenChange" Type="EventCallback&lt;bool&gt;">
                    Event callback invoked when the popover open state changes.
                </ApiParameter>
                <ApiParameter Name="Modal" Type="bool" Default="true">
                    Whether the popover can be dismissed by clicking outside or pressing Escape.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    The child content. Should include PopoverTrigger and PopoverContent components.
                </ApiParameter>
            </ApiReference>
            <ApiReference ComponentName="PopoverTrigger">
                <ApiParameter Name="AsChild" Type="bool" Default="true">
                    When true, the trigger does not render its own button element. Instead, it passes trigger behavior via TriggerContext to child components.
                </ApiParameter>
                <ApiParameter Name="OnClick" Type="EventCallback&lt;MouseEventArgs&gt;">
                    Custom click handler invoked in addition to the default toggle behavior.
                </ApiParameter>
                <ApiParameter Name="CustomClickHandling" Type="bool" Default="false">
                    When true, only OnClick is invoked and the default popover toggle behavior is skipped.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    The child content to render within the trigger.
                </ApiParameter>
            </ApiReference>
            <ApiReference ComponentName="PopoverContent">
                <ApiParameter Name="Side" Type="PopoverSide" Default="Bottom">
                    Preferred side for positioning the content relative to the trigger. Options: Top, Right, Bottom, Left.
                </ApiParameter>
                <ApiParameter Name="Align" Type="PopoverAlign" Default="Center">
                    Alignment of the content relative to the trigger. Options: Start, Center, End.
                </ApiParameter>
                <ApiParameter Name="Offset" Type="int" Default="4">
                    Offset distance from the trigger element in pixels.
                </ApiParameter>
                <ApiParameter Name="MatchTriggerWidth" Type="bool" Default="false">
                    Whether to match the popover width to the trigger element width.
                </ApiParameter>
                <ApiParameter Name="CloseOnEscape" Type="bool" Default="true">
                    Whether pressing Escape should close the popover.
                </ApiParameter>
                <ApiParameter Name="CloseOnClickOutside" Type="bool" Default="true">
                    Whether clicking outside should close the popover.
                </ApiParameter>
                <ApiParameter Name="Strategy" Type="PositioningStrategy" Default="Fixed">
                    CSS positioning strategy. Use Fixed to escape stacking contexts, or Absolute to scroll with a container.
                </ApiParameter>
                <ApiParameter Name="ZIndex" Type="int" Default="9999">
                    CSS z-index value for the popover content.
                </ApiParameter>
                <ApiParameter Name="OnEscapeKeyDown" Type="EventCallback&lt;KeyboardEventArgs&gt;">
                    Event callback invoked when Escape key is pressed.
                </ApiParameter>
                <ApiParameter Name="OnClickOutside" Type="EventCallback">
                    Event callback invoked when clicking outside the popover.
                </ApiParameter>
                <ApiParameter Name="OnContentReady" Type="EventCallback">
                    Event callback invoked when the popover content is fully positioned and visible. Useful for focus management.
                </ApiParameter>
                <ApiParameter Name="Class" Type="string?">
                    Additional CSS classes to apply to the content container.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    The content to render inside the popover.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private bool _isControlledOpen = false;
}
