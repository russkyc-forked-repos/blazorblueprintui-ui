@page "/components/color-picker"
@using System.ComponentModel.DataAnnotations

<PageTitle>ColorPicker Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">ColorPicker Component</h1>
            <p class="text-xl text-muted-foreground">
                A visual color selection component with hex/RGB input, preset colors, and optional alpha channel.
            </p>
        </div>
    </div>

    <!-- Basic Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Example</h2>
            <p class="text-sm text-muted-foreground">
                Select a color using the visual picker or enter a hex value.
            </p>
        </div>
        <BbColorPicker @bind-Value="_basicColor" />
        <p class="text-sm text-muted-foreground">Selected: @_basicColor</p>
        <div class="h-16 w-32 rounded-md border border-input"
             style="background-color: @_basicColor;">
        </div>
        <CodeBlock Source="Components/ColorPicker/basic.txt" />
    </div>

    <!-- With Alpha Channel -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Alpha Channel</h2>
            <p class="text-sm text-muted-foreground">
                Enable transparency selection with the alpha slider.
            </p>
        </div>
        <BbColorPicker @bind-Value="_alphaColor" ShowAlpha="true" />
        <p class="text-sm text-muted-foreground">Selected: @_alphaColor</p>
        <div class="h-16 w-32 rounded-md border border-input"
             style="background: linear-gradient(@_alphaColor, @_alphaColor), url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2216%22 height=%2216%22 fill-opacity=%22.1%22><rect x=%220%22 y=%220%22 width=%228%22 height=%228%22 fill=%22%23000%22/><rect x=%228%22 y=%228%22 width=%228%22 height=%228%22 fill=%22%23000%22/></svg>');">
        </div>
        <CodeBlock Source="Components/ColorPicker/alpha.txt" />
    </div>

    <!-- Without Presets -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Without Presets</h2>
            <p class="text-sm text-muted-foreground">
                Preset color swatches are hidden.
            </p>
        </div>
        <BbColorPicker @bind-Value="_noPresetsColor" ShowPresets="false" />
        <p class="text-sm text-muted-foreground">Selected: @_noPresetsColor</p>
        <CodeBlock Source="Components/ColorPicker/no-presets.txt" />
    </div>

    <!-- Custom Presets -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Presets</h2>
            <p class="text-sm text-muted-foreground">
                Brand colors as presets.
            </p>
        </div>
        <BbColorPicker @bind-Value="_customPresetsColor"
                     PresetColors="@_brandColors" />
        <p class="text-sm text-muted-foreground">Selected: @_customPresetsColor</p>
        <CodeBlock Source="Components/ColorPicker/custom-presets.txt" />
    </div>

    <!-- Without Inputs -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Without Inputs</h2>
            <p class="text-sm text-muted-foreground">
                Visual picker only, no hex/RGB inputs.
            </p>
        </div>
        <BbColorPicker @bind-Value="_noInputsColor" ShowInputs="false" />
        <p class="text-sm text-muted-foreground">Selected: @_noInputsColor</p>
        <CodeBlock Source="Components/ColorPicker/no-inputs.txt" />
    </div>

    <!-- Pre-selected Color -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Pre-selected Color</h2>
            <p class="text-sm text-muted-foreground">
                Initialized with a specific color.
            </p>
        </div>
        <BbColorPicker @bind-Value="_preselectedColor" />
        <p class="text-sm text-muted-foreground">Selected: @_preselectedColor</p>
        <CodeBlock Source="Components/ColorPicker/preselected.txt" />
    </div>

    <!-- Default Value (Uncontrolled) -->
    <div class="space-y-4">
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <h2 class="text-2xl font-semibold">Default Value</h2>
                <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary ring-1 ring-inset ring-primary/20">v3</span>
            </div>
            <p class="text-sm text-muted-foreground">
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">DefaultValue</code> to set an initial color without external binding. The picker starts at the specified color.
            </p>
        </div>
        <BbColorPicker DefaultValue="#8B5CF6" />
        <CodeBlock Source="Components/ColorPicker/default-value.txt" />
    </div>

    <!-- Multiple Pickers -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Foreground & Background</h2>
            <p class="text-sm text-muted-foreground">
                Common pattern for selecting text and background colors.
            </p>
        </div>
        <div class="flex items-center gap-4">
            <div>
                <label class="text-sm font-medium mb-1 block">Foreground</label>
                <BbColorPicker @bind-Value="_fgColor" />
            </div>
            <div>
                <label class="text-sm font-medium mb-1 block">Background</label>
                <BbColorPicker @bind-Value="_bgColor" />
            </div>
        </div>
        <div class="p-4 rounded-md border border-input"
             style="background-color: @_bgColor; color: @_fgColor;">
            <p class="text-lg font-medium">Sample Text</p>
            <p class="text-sm">This text uses the selected colors.</p>
        </div>
        <CodeBlock Source="Components/ColorPicker/foreground-background.txt" />
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
        </div>
        <BbColorPicker Value="#3B82F6" Disabled="true" />
        <CodeBlock Source="Components/ColorPicker/disabled.txt" />
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                ColorPicker integrates with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="colorFormModel" OnValidSubmit="HandleColorFormSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Brand Color</label>
                <BbColorPicker @bind-Value="colorFormModel.BrandColor" />
                <ValidationMessage For="@(() => colorFormModel.BrandColor)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetColorForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(colorFormMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@colorFormMessage</p>
                </div>
            }
        </EditForm>
        <CodeBlock Source="Components/ColorPicker/form-validation.txt" />
    </div>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>

        <div class="space-y-4">
            <ApiReference ComponentName="ColorPicker">
                <ApiParameter Name="Value" Type="string">
                    Color value in hex format (#RRGGBB).
                </ApiParameter>
                <ApiParameter Name="Format" Type="ColorFormat" Default="Hex">
                    Output format (Hex, RGB, HSL).
                </ApiParameter>
                <ApiParameter Name="ShowAlpha" Type="bool" Default="false">
                    Show alpha slider.
                </ApiParameter>
                <ApiParameter Name="ShowPresets" Type="bool" Default="true">
                    Show preset colors.
                </ApiParameter>
                <ApiParameter Name="PresetColors" Type="string[]?">
                    Custom preset colors.
                </ApiParameter>
                <ApiParameter Name="ShowInputs" Type="bool" Default="true">
                    Show hex/RGB inputs.
                </ApiParameter>
                <ApiParameter Name="DefaultValue" Type="string?">
                    Initial color when not externally bound.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool">
                    Disables the picker.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private string _basicColor = "#3B82F6";
    private string _alphaColor = "#3B82F680";
    private string _noPresetsColor = "#10B981";
    private string _customPresetsColor = "#6366F1";
    private string _noInputsColor = "#F59E0B";
    private string _preselectedColor = "#EC4899";
    private string _fgColor = "#FFFFFF";
    private string _bgColor = "#1E293B";

    private string[] _brandColors = {
        "#6366F1", "#8B5CF6", "#A855F7", "#D946EF",
        "#EC4899", "#F43F5E", "#EF4444", "#F97316",
        "#F59E0B", "#EAB308", "#84CC16", "#22C55E"
    };

    private ColorFormModel colorFormModel = new();
    private string? colorFormMessage;

    private void HandleColorFormSubmit()
    {
        colorFormMessage = $"Form submitted! Brand Color: {colorFormModel.BrandColor}";
    }

    private void ResetColorForm()
    {
        colorFormModel = new();
        colorFormMessage = null;
    }

    private class ColorFormModel
    {
        [Required(ErrorMessage = "Please select a brand color.")]
        public string? BrandColor { get; set; }
    }
}
