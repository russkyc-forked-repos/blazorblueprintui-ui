@page "/components/select"
@using System.ComponentModel.DataAnnotations
<PageTitle>Select Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Select Component</h1>
        <p class="text-xl text-muted-foreground">
            Displays a list of options for the user to pick fromâ€”triggered by a button.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <!-- Data-Binding Mode -->
    <section class="space-y-4">
        <div class="flex items-center gap-2">
            <h2 class="text-2xl font-semibold">Data-Binding Mode</h2>
            <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary ring-1 ring-inset ring-primary/20">v3</span>
        </div>
        <p class="text-sm text-muted-foreground">
            Pass an <code class="text-xs bg-muted px-1 py-0.5 rounded">Options</code> collection of
            <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption&lt;TValue&gt;</code> pairs and
            the component auto-generates the trigger, value display, and dropdown content.
            Use <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption.FromValue</code> when value and label are the same.
        </p>

        <div class="flex items-center gap-4">
            <BbSelect TValue="string"
                    @bind-Value="selectedFruit"
                    Options="@fruitOptions"
                    Placeholder="Select a fruit"
                    Class="w-[280px]" />

            @if (!string.IsNullOrEmpty(selectedFruit))
            {
                <p class="text-sm">Selected: <strong>@selectedFruit</strong></p>
            }
        </div>

        <div class="flex items-center gap-4">
            <BbSelect TValue="int?"
                    @bind-Value="selectedNumber"
                    Options="@numberOptions"
                    Placeholder="Select a number"
                    Class="w-[280px]" />

            @if (selectedNumber is not null)
            {
                <p class="text-sm">Selected: <strong>@selectedNumber</strong></p>
            }
        </div>

        <CodeBlock Source="Components/Select/data-binding.txt" />
    </section>

    <!-- Value/Label Pairs -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Value/Label Pairs</h2>
        <p class="text-sm text-muted-foreground">
            When the bound value differs from the display text (e.g. binding to an ID while showing a name),
            each <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption</code> maps a value to its label.
            The trigger automatically shows the label for the selected value.
        </p>

        <div class="flex items-center gap-4">
            <BbSelect TValue="string"
                    @bind-Value="selectedUserId"
                    Options="@userOptions"
                    Placeholder="Select a team member"
                    Class="w-[280px]" />

            @if (!string.IsNullOrEmpty(selectedUserId))
            {
                <p class="text-sm">Bound value: <strong>@selectedUserId</strong></p>
            }
        </div>

        <div class="flex items-center gap-4">
            <BbSelect TValue="Guid?"
                    @bind-Value="selectedProjectId"
                    Options="@projectOptions"
                    Placeholder="Select a project"
                    Class="w-[280px]" />

            @if (selectedProjectId is not null)
            {
                <p class="text-sm">Bound value: <strong>@selectedProjectId</strong></p>
            }
        </div>

        <div class="flex items-center gap-4">
            <BbSelect TValue="string"
                    @bind-Value="selectedPreselectedUserId"
                    Options="@userOptions"
                    Placeholder="Select a team member"
                    Class="w-[280px]" />

            @if (!string.IsNullOrEmpty(selectedPreselectedUserId))
            {
                <p class="text-sm">Bound value: <strong>@selectedPreselectedUserId</strong></p>
            }
        </div>
        <p class="text-xs text-muted-foreground italic">
            The third select above is pre-selected to "Bob Chen" via <code class="text-xs bg-muted px-1 py-0.5 rounded">selectedUserId = "u002"</code>.
        </p>

        <CodeBlock Source="Components/Select/value-label-pairs.txt" />
    </section>

    <!-- Compositional Mode (Basic) -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Compositional Mode</h2>
        <p class="text-sm text-muted-foreground">
            For full control over the trigger, content, and item rendering, use SelectTrigger, SelectContent,
            and SelectItem child components directly.
        </p>

        <div class="flex items-center gap-4">
            <BbSelect @bind-Value="selectedFruitComposed" TValue="string" Class="w-[280px]">
                <BbSelectTrigger>
                    <BbSelectValue Placeholder="Select a fruit" />
                </BbSelectTrigger>
                <BbSelectContent>
                    <BbSelectItem Value="@("apple")" Text="ðŸŽ Apple" />
                    <BbSelectItem Value="@("banana")" Text="ðŸŒ Banana" />
                    <BbSelectItem Value="@("blueberry")" Text="ðŸ« Blueberry" />
                    <BbSelectItem Value="@("grapes")" Text="ðŸ‡ Grapes" />
                    <BbSelectItem Value="@("pineapple")" Text="ðŸ Pineapple" />
                </BbSelectContent>
            </BbSelect>

            @if (!string.IsNullOrEmpty(selectedFruitComposed))
            {
                <p class="text-sm">Selected: <strong>@selectedFruitComposed</strong></p>
            }
        </div>

        <CodeBlock Source="Components/Select/compositional.txt" />
    </section>

    <!-- Grouped Select -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Grouped Options</h2>
        <p class="text-sm text-muted-foreground">
            Organize related items into labeled groups.
        </p>

        <div class="flex items-center gap-4">
            <BbSelect @bind-Value="selectedAnimal" TValue="string" Class="w-[280px]">
                <BbSelectTrigger>
                    <BbSelectValue Placeholder="Select an animal" />
                </BbSelectTrigger>
                <BbSelectContent>
                    <BbSelectGroup>
                        <BbSelectLabel>Mammals</BbSelectLabel>
                        <BbSelectItem Value="@("cat")" Text="Cat" />
                        <BbSelectItem Value="@("dog")" Text="Dog" />
                        <BbSelectItem Value="@("elephant")" Text="Elephant" />
                    </BbSelectGroup>
                    <BbSelectGroup>
                        <BbSelectLabel>Birds</BbSelectLabel>
                        <BbSelectItem Value="@("eagle")" Text="Eagle" />
                        <BbSelectItem Value="@("parrot")" Text="Parrot" />
                        <BbSelectItem Value="@("penguin")" Text="Penguin" />
                    </BbSelectGroup>
                    <BbSelectGroup>
                        <BbSelectLabel>Reptiles</BbSelectLabel>
                        <BbSelectItem Value="@("crocodile")" Text="Crocodile" />
                        <BbSelectItem Value="@("snake")" Text="Snake" />
                        <BbSelectItem Value="@("turtle")" Text="Turtle" />
                    </BbSelectGroup>
                </BbSelectContent>
            </BbSelect>

            @if (!string.IsNullOrEmpty(selectedAnimal))
            {
                <p class="text-sm">Selected: <strong>@selectedAnimal</strong></p>
            }
        </div>

        <CodeBlock Source="Components/Select/grouped.txt" />
    </section>

    <!-- Scrollable Long List -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Scrollable Long List</h2>
        <p class="text-sm text-muted-foreground">
            Handle many options with automatic scrolling (max-h-60).
        </p>

        <div class="flex items-center gap-4">
            <BbSelect @bind-Value="selectedCountry" TValue="string" Class="w-[280px]">
                <BbSelectTrigger>
                    <BbSelectValue Placeholder="Select a country" />
                </BbSelectTrigger>
                <BbSelectContent>
                    @foreach (var country in Countries)
                    {
                        <BbSelectItem Value="@country" Text="@country" />
                    }
                </BbSelectContent>
            </BbSelect>

            @if (!string.IsNullOrEmpty(selectedCountry))
            {
                <p class="text-sm">Selected: <strong>@selectedCountry</strong></p>
            }
        </div>

        <CodeBlock Source="Components/Select/scrollable.txt" />
    </section>

    <!-- Scrollable Data-Binding -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Scrollable Data-Binding</h2>
        <p class="text-sm text-muted-foreground">
            Data-binding mode handles large collections with automatic scrolling, just like the compositional mode.
        </p>

        <div class="flex items-center gap-4">
            <BbSelect TValue="string"
                    @bind-Value="selectedCountryDataBound"
                    Options="@countryOptions"
                    Placeholder="Select a country"
                    Class="w-[280px]" />

            @if (!string.IsNullOrEmpty(selectedCountryDataBound))
            {
                <p class="text-sm">Selected: <strong>@selectedCountryDataBound</strong></p>
            }
        </div>

        <CodeBlock Source="Components/Select/scrollable-data-binding.txt" />
    </section>

    <!-- Form Validation with EditForm -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Form Validation</h2>
        <p class="text-sm text-muted-foreground">
            Select integrates with Blazor's EditForm and EditContext for model validation.
            Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
            validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
        </p>

        <EditForm Model="selectFormModel" OnValidSubmit="HandleSelectFormSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Favorite Fruit</label>
                <BbSelect @bind-Value="selectFormModel.Fruit"
                        TValue="string"
                        Options="fruitOptions"
                        Placeholder="Select a fruit"
                        Class="w-[280px]" />
                <ValidationMessage For="@(() => selectFormModel.Fruit)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetSelectForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(selectFormMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@selectFormMessage</p>
                </div>
            }
        </EditForm>

        <CodeBlock Source="Components/Select/form-validation.txt" />
    </section>

    <AccessibilityList>
            <AriaAttributes>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">role="listbox"</code> on the dropdown content
                </AccessibilityItem>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-expanded</code> indicates dropdown state
                </AccessibilityItem>
                <AccessibilityItem>
                    <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-selected</code> on selected item
                </AccessibilityItem>
                <AccessibilityItem>
                    Focus management with keyboard navigation support
                </AccessibilityItem>
            </AriaAttributes>
            <KeyboardNavigation>
                <KeyboardShortcutItem Description="Open dropdown">
                    <BbKbd>Enter</BbKbd> / <BbKbd>Space</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Navigate options">
                    <BbKbd>Arrow Keys</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Select option">
                    <BbKbd>Enter</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Close dropdown">
                    <BbKbd>Escape</BbKbd>
                </KeyboardShortcutItem>
            </KeyboardNavigation>
        </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>

        <div class="space-y-4">
            <ApiReference ComponentName="Select&lt;TValue&gt;">
                <ApiParameter Name="Options" Type="IEnumerable&lt;SelectOption&lt;TValue&gt;&gt;?">
                    Collection of options for data-driven mode. When provided, auto-generates trigger, value display, and dropdown content.
                </ApiParameter>
                <ApiParameter Name="Value" Type="TValue?">
                    Currently selected value. Supports two-way binding with <code>@@bind-Value</code>.
                </ApiParameter>
                <ApiParameter Name="ValueChanged" Type="EventCallback&lt;TValue?&gt;">
                    Callback invoked when the selected value changes.
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string?">
                    Placeholder text when no value is selected (data-driven mode).
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the select is disabled.
                </ApiParameter>
                <ApiParameter Name="Open" Type="bool?">
                    Whether the dropdown is open. Supports two-way binding with <code>@@bind-Open</code>.
                </ApiParameter>
                <ApiParameter Name="DisplayTextSelector" Type="Func&lt;TValue, string&gt;?">
                    Function to derive display text from a value in compositional mode. Falls back to ToString().
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    Content for compositional mode. Should contain SelectTrigger and SelectContent.
                </ApiParameter>
            </ApiReference>

            <ApiReference ComponentName="SelectTrigger&lt;TValue&gt;">
                <ApiParameter Name="Class" Type="string?">
                    Additional CSS classes to apply to the trigger button.
                </ApiParameter>
                <ApiParameter Name="ActiveClass" Type="string?" Default="&quot;bg-accent text-accent-foreground&quot;">
                    CSS classes applied when the dropdown is open. Set to <code>null</code> or empty to disable.
                    Use to match the context (e.g., <code>"bg-sidebar-accent text-sidebar-accent-foreground"</code> in sidebars).
                </ApiParameter>
            </ApiReference>

            <ApiReference ComponentName="SelectItem&lt;TValue&gt;">
                <ApiParameter Name="Value" Type="TValue">
                    The value of this item. Required.
                </ApiParameter>
                <ApiParameter Name="Text" Type="string?">
                    Display text. If not provided, uses ChildContent text or Value.ToString().
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether this item is disabled.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    Custom content rendered as the item's display.
                </ApiParameter>
            </ApiReference>

            <ApiReference ComponentName="SelectValue">
                <ApiParameter Name="Placeholder" Type="string?">
                    Placeholder text when no value is selected.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment&lt;string&gt;?">
                    Custom template for selected value display. Receives display text as context.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private string? selectedFruit;
    private string? selectedFruitComposed;
    private string? selectedAnimal;
    private string? selectedCountry;
    private string? selectedCountryDataBound;
    private int? selectedNumber;
    private string? selectedUserId;
    private Guid? selectedProjectId;
    private string? selectedPreselectedUserId = "u002";

    private static readonly string[] Fruits = ["Apple", "Banana", "Blueberry", "Grapes", "Pineapple"];
    private readonly SelectOption<string>[] fruitOptions = Fruits.Select(SelectOption.FromValue).ToArray();

    private readonly SelectOption<int?>[] numberOptions =
    [
        new(1, "One"), new(2, "Two"), new(3, "Three"), new(4, "Four"), new(5, "Five")
    ];

    private static readonly Guid Project1Id = Guid.Parse("6163de1b-65e2-4c98-b8a8-403efa27a7c2");
    private static readonly Guid Project2Id = Guid.Parse("a4b8c3d1-2e5f-4a6b-9c8d-7e1f2a3b4c5d");
    private static readonly Guid Project3Id = Guid.Parse("d9e8f7a6-5b4c-3d2e-1f0a-9b8c7d6e5f4a");

    private readonly SelectOption<string>[] userOptions =
    [
        new("u001", "Alice Martin"),
        new("u002", "Bob Chen"),
        new("u003", "Carol Davis"),
        new("u004", "Dan Wilson")
    ];

    private readonly SelectOption<Guid?>[] projectOptions =
    [
        new(Project1Id, "Website Redesign"),
        new(Project2Id, "Mobile App"),
        new(Project3Id, "API Migration")
    ];

    private static readonly string[] Countries =
    [
        "Afghanistan", "Albania", "Algeria", "Andorra", "Angola",
        "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
        "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus",
        "Belgium", "Belize", "Benin", "Bhutan", "Bolivia",
        "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria",
        "Burkina Faso", "Burundi", "Cambodia", "Cameroon", "Canada",
        "Cape Verde", "Central African Republic", "Chad", "Chile", "China",
        "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia",
        "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti",
        "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt"
    ];
    private readonly SelectOption<string>[] countryOptions = Countries.Select(SelectOption.FromValue).ToArray();

    private SelectFormModel selectFormModel = new();
    private string? selectFormMessage;

    private void HandleSelectFormSubmit()
    {
        selectFormMessage = $"Form submitted! Fruit: {selectFormModel.Fruit}";
    }

    private void ResetSelectForm()
    {
        selectFormModel = new();
        selectFormMessage = null;
    }

    private class SelectFormModel
    {
        [Required(ErrorMessage = "Please select a fruit.")]
        public string? Fruit { get; set; }
    }
}
