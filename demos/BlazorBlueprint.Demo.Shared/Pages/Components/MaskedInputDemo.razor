@page "/components/masked-input"
@using System.ComponentModel.DataAnnotations

<PageTitle>MaskedInput Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">MaskedInput Component</h1>
            <p class="text-xl text-muted-foreground">
                Input with structured formats using preset masks or custom patterns.
            </p>
        </div>
    </div>

    <!-- Phone Number -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Phone Number</h2>
            <p class="text-sm text-muted-foreground">
                US phone format: (999) 999-9999
            </p>
        </div>
        <div class="w-64">
            <BbMaskedInput @ref="_phoneRef" @bind-Value="_phone" Preset="MaskPreset.Phone" />
        </div>
        <p class="text-sm text-muted-foreground">
            Unmasked: @_phone | Masked: @(_phoneRef?.MaskedValue ?? "")
        </p>
        <CodeBlock Source="Components/MaskedInput/phone.txt" />
    </div>

    <!-- Social Security Number -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Social Security Number</h2>
            <p class="text-sm text-muted-foreground">
                SSN format: 999-99-9999
            </p>
        </div>
        <div class="w-48">
            <BbMaskedInput @bind-Value="_ssn" Preset="MaskPreset.SSN" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_ssn</p>
    </div>

    <!-- Credit Card -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Credit Card</h2>
            <p class="text-sm text-muted-foreground">
                Card number format: 9999 9999 9999 9999
            </p>
        </div>
        <div class="w-72">
            <BbMaskedInput @bind-Value="_creditCard" Preset="MaskPreset.CreditCard" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_creditCard</p>
    </div>

    <!-- Date -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Date</h2>
            <p class="text-sm text-muted-foreground">
                Date format: MM/DD/YYYY
            </p>
        </div>
        <div class="w-40">
            <BbMaskedInput @bind-Value="_date" Preset="MaskPreset.Date" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_date</p>
    </div>

    <!-- Time -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Time</h2>
            <p class="text-sm text-muted-foreground">
                Time format: HH:MM
            </p>
        </div>
        <div class="w-32">
            <BbMaskedInput @bind-Value="_time" Preset="MaskPreset.Time" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_time</p>
    </div>

    <!-- Time with Seconds -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Time (24-hour with seconds)</h2>
            <p class="text-sm text-muted-foreground">
                Time format: HH:MM:SS
            </p>
        </div>
        <div class="w-36">
            <BbMaskedInput @bind-Value="_time24" Preset="MaskPreset.Time24" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_time24</p>
    </div>

    <!-- ZIP Code -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">ZIP Code</h2>
            <p class="text-sm text-muted-foreground">
                US ZIP+4 format: 99999-9999
            </p>
        </div>
        <div class="w-40">
            <BbMaskedInput @bind-Value="_zipCode" Preset="MaskPreset.ZipCode" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_zipCode</p>
    </div>

    <!-- EIN -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Employer ID (EIN)</h2>
            <p class="text-sm text-muted-foreground">
                EIN format: 99-9999999
            </p>
        </div>
        <div class="w-40">
            <BbMaskedInput @bind-Value="_ein" Preset="MaskPreset.EIN" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_ein</p>
    </div>

    <!-- Custom Mask -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Mask</h2>
            <p class="text-sm text-muted-foreground">
                Product code: AAA-9999 (3 letters, dash, 4 digits)
            </p>
        </div>
        <div class="w-40">
            <BbMaskedInput @bind-Value="_custom" Preset="MaskPreset.Custom" Mask="AAA-9999" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_custom</p>
        <CodeBlock Source="Components/MaskedInput/custom-mask.txt" />
    </div>

    <!-- License Plate -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">License Plate</h2>
            <p class="text-sm text-muted-foreground">
                Format: AAA-9999 or 999-AAA (alphanumeric with *)
            </p>
        </div>
        <div class="w-40">
            <BbMaskedInput @bind-Value="_plate" Preset="MaskPreset.Custom" Mask="***-****" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_plate</p>
    </div>

    <!-- Without Mask Display -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Without Mask Display</h2>
            <p class="text-sm text-muted-foreground">
                Mask placeholders are hidden when empty (shown on focus).
            </p>
        </div>
        <div class="w-64">
            <BbMaskedInput @bind-Value="_hiddenMask" Preset="MaskPreset.Phone" ShowMask="false" Placeholder="Enter phone number" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_hiddenMask</p>
        <CodeBlock Source="Components/MaskedInput/without-mask-display.txt" />
    </div>

    <!-- Custom Placeholder Char -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Placeholder Character</h2>
            <p class="text-sm text-muted-foreground">
                Using '#' instead of '_' for unfilled positions.
            </p>
        </div>
        <div class="w-64">
            <BbMaskedInput @bind-Value="_customPlaceholder" Preset="MaskPreset.Phone" PlaceholderChar="@('#')" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_customPlaceholder</p>
    </div>

    <!-- Pre-filled Value -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Pre-filled Value</h2>
            <p class="text-sm text-muted-foreground">
                Initialized with a value.
            </p>
        </div>
        <div class="w-64">
            <BbMaskedInput @bind-Value="_prefilled" Preset="MaskPreset.Phone" />
        </div>
        <p class="text-sm text-muted-foreground">Unmasked: @_prefilled</p>
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
        </div>
        <div class="w-64">
            <BbMaskedInput Value="5551234567" Preset="MaskPreset.Phone" Disabled="true" />
        </div>
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                MaskedInput integrates with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="maskedFormModel" OnValidSubmit="HandleMaskedFormSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Phone Number</label>
                <BbMaskedInput @bind-Value="maskedFormModel.Phone" Preset="MaskPreset.Phone" />
                <ValidationMessage For="@(() => maskedFormModel.Phone)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetMaskedForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(maskedFormMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@maskedFormMessage</p>
                </div>
            }
        </EditForm>
        <CodeBlock Source="Components/MaskedInput/form-validation.txt" />
    </div>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>

        <div class="space-y-4">
            <ApiReference ComponentName="MaskedInput">
                <ApiParameter Name="Value" Type="string">
                    Unmasked value (raw input).
                </ApiParameter>
                <ApiParameter Name="Preset" Type="MaskPreset">
                    Predefined mask (Phone, SSN, CreditCard, Date, Time, Time24, ZipCode, EIN, Custom).
                </ApiParameter>
                <ApiParameter Name="Mask" Type="string?">
                    Custom mask pattern (when Preset is Custom).
                </ApiParameter>
                <ApiParameter Name="PlaceholderChar" Type="char" Default="_">
                    Character for unfilled positions.
                </ApiParameter>
                <ApiParameter Name="ShowMask" Type="bool" Default="true">
                    Show mask when empty.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool">
                    Disables the input.
                </ApiParameter>
            </ApiReference>
        </div>

        <div class="border rounded-lg p-6 space-y-4">
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Mask Characters</h3>
                <div class="space-y-2 text-sm">
                    <p><strong>9:</strong> Digit (0-9)</p>
                    <p><strong>A:</strong> Letter (a-z, A-Z)</p>
                    <p><strong>*:</strong> Alphanumeric (letter or digit)</p>
                    <p><strong>Any other character:</strong> Literal (displayed as-is)</p>
                </div>
            </div>
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Properties</h3>
                <div class="space-y-2 text-sm">
                    <p><strong>MaskedValue:</strong> <code class="bg-muted px-1 py-0.5 rounded">string</code> - The formatted value with mask</p>
                    <p><strong>UnmaskedValue:</strong> <code class="bg-muted px-1 py-0.5 rounded">string</code> - The raw value without formatting</p>
                </div>
            </div>
        </div>
    </section>
</div>

@code {
    private string _phone = "";
    private string _ssn = "";
    private string _creditCard = "";
    private string _date = "";
    private string _time = "";
    private string _time24 = "";
    private string _zipCode = "";
    private string _ein = "";
    private string _custom = "";
    private string _plate = "";
    private string _hiddenMask = "";
    private string _customPlaceholder = "";
    private string _prefilled = "5551234567";

    private BbMaskedInput? _phoneRef;
    private MaskedFormModel maskedFormModel = new();
    private string? maskedFormMessage;

    private void HandleMaskedFormSubmit()
    {
        maskedFormMessage = $"Form submitted! Phone: {maskedFormModel.Phone}";
    }

    private void ResetMaskedForm()
    {
        maskedFormModel = new();
        maskedFormMessage = null;
    }

    private class MaskedFormModel
    {
        [Required(ErrorMessage = "Phone number is required.")]
        [MinLength(10, ErrorMessage = "Please enter a complete phone number.")]
        public string? Phone { get; set; }
    }
}
