@page "/components/checkbox"
@using System.ComponentModel.DataAnnotations

<PageTitle>Checkbox Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Checkbox Component</h1>
        <p class="text-xl text-muted-foreground">
            A checkbox control that allows users to toggle between checked and unchecked states.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <!-- Basic Usage -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Usage</h2>
            <p class="text-sm text-muted-foreground">
                Simple checkbox with label using two-way binding.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="basicChecked" Id="basic-checkbox" />
                <label for="basic-checkbox" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Accept terms and conditions
                </label>
            </div>
            <p class="text-sm text-muted-foreground">
                Current state: @(basicChecked ? "Checked ✓" : "Unchecked")
            </p>
        </div>
        <CodeBlock Source="Components/Checkbox/basic.txt" />
    </div>

    <!-- Multiple Checkboxes -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Multiple Options</h2>
            <p class="text-sm text-muted-foreground">
                Group of checkboxes for multiple selections.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="option1" Id="option1" />
                <label for="option1" class="text-sm font-medium leading-none">
                    Email notifications
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="option2" Id="option2" />
                <label for="option2" class="text-sm font-medium leading-none">
                    SMS notifications
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="option3" Id="option3" />
                <label for="option3" class="text-sm font-medium leading-none">
                    Push notifications
                </label>
            </div>
            <p class="text-sm text-muted-foreground">
                Selected: @string.Join(", ", GetSelectedOptions())
            </p>
        </div>
        <CodeBlock Source="Components/Checkbox/multiple-options.txt" />
    </div>

    <!-- Indeterminate (Select All) -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Indeterminate</h2>
            <p class="text-sm text-muted-foreground">
                A parent checkbox that reflects the aggregate state of its children.
                When some (but not all) items are selected, the parent shows an indeterminate dash.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <BbCheckbox Checked="@_selectAllChecked"
                          CheckedChanged="HandleSelectAllChanged"
                          Indeterminate="@_selectAllIndeterminate"
                          Id="select-all" />
                <label for="select-all" class="text-sm font-semibold leading-none">
                    Select all
                </label>
            </div>
            <div class="ml-6 space-y-3">
                <div class="flex items-center space-x-2">
                    <BbCheckbox Checked="@_itemRead"
                              CheckedChanged="@(v => { _itemRead = v; UpdateSelectAll(); })"
                              Id="item-read" />
                    <label for="item-read" class="text-sm font-medium leading-none">
                        Read
                    </label>
                </div>
                <div class="flex items-center space-x-2">
                    <BbCheckbox Checked="@_itemWrite"
                              CheckedChanged="@(v => { _itemWrite = v; UpdateSelectAll(); })"
                              Id="item-write" />
                    <label for="item-write" class="text-sm font-medium leading-none">
                        Write
                    </label>
                </div>
                <div class="flex items-center space-x-2">
                    <BbCheckbox Checked="@_itemExecute"
                              CheckedChanged="@(v => { _itemExecute = v; UpdateSelectAll(); })"
                              Id="item-execute" />
                    <label for="item-execute" class="text-sm font-medium leading-none">
                        Execute
                    </label>
                </div>
            </div>
        </div>
        <CodeBlock Source="Components/Checkbox/indeterminate.txt" />
    </div>

    <!-- Disabled State -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled State</h2>
            <p class="text-sm text-muted-foreground">
                Checkboxes that cannot be interacted with.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <BbCheckbox Disabled="true" Checked="false" Id="disabled-unchecked" />
                <label for="disabled-unchecked" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Disabled (unchecked)
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <BbCheckbox Disabled="true" Checked="true" Id="disabled-checked" />
                <label for="disabled-checked" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Disabled (checked)
                </label>
            </div>
        </div>
        <CodeBlock Source="Components/Checkbox/disabled.txt" />
    </div>

    <!-- Form Validation -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                Checkbox integrated with Blazor's EditForm and validation.
            </p>
        </div>
        <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit" class="space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-3">
                <div class="flex items-center space-x-2">
                    <BbCheckbox @bind-Checked="formModel.AcceptTerms" Id="terms" />
                    <label for="terms" class="text-sm font-medium leading-none">
                        I accept the terms and conditions
                    </label>
                </div>
                <ValidationMessage For="@(() => formModel.AcceptTerms)" class="text-sm text-destructive" />
            </div>

            <div class="space-y-3">
                <div class="flex items-center space-x-2">
                    <BbCheckbox @bind-Checked="formModel.Subscribe" Id="subscribe" />
                    <label for="subscribe" class="text-sm font-medium leading-none">
                        Subscribe to newsletter (optional)
                    </label>
                </div>
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(formMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@formMessage</p>
                </div>
            }
        </EditForm>
        <CodeBlock Source="Components/Checkbox/form-validation.txt" />
    </div>

    <!-- Interactive Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Interactive</h2>
            <p class="text-sm text-muted-foreground">
                Checkbox with custom change handler.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="interactiveChecked" Id="interactive" />
                <label for="interactive" class="text-sm font-medium leading-none">
                    Toggle feature flag
                </label>
            </div>
            @if (interactiveChecked)
            {
                <div class="p-4 bg-primary/10 rounded-lg border border-primary">
                    <p class="text-sm">✓ Feature is enabled! Last toggled at @lastToggleTime</p>
                </div>
            }
            else
            {
                <div class="p-4 bg-muted rounded-lg">
                    <p class="text-sm text-muted-foreground">Feature is disabled</p>
                </div>
            }
        </div>
        <CodeBlock Source="Components/Checkbox/interactive.txt" />
    </div>

    <!-- Checkbox Card -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Checkbox Card</h2>
            <p class="text-sm text-muted-foreground">
                Style a container based on checkbox state using the CSS <code class="text-xs bg-muted px-1 py-0.5 rounded">has-[data-state]</code> selector. No conditional C# classes needed.
            </p>
        </div>
        <div class="space-y-3">
            <label
                for="card-1"
                class="flex items-center space-x-3 rounded-lg border border-input p-4 cursor-pointer transition-colors has-[[data-state=checked]]:border-primary has-[[data-state=checked]]:bg-primary/5">
                <BbCheckbox @bind-Checked="cardChecked1" Id="card-1" />
                <div class="flex-1">
                    <div class="text-sm font-medium leading-none">
                        Accept terms and conditions
                    </div>
                </div>
            </label>
            <label
                for="card-2"
                class="flex items-start space-x-3 rounded-lg border border-input p-4 cursor-pointer transition-colors has-[[data-state=checked]]:border-primary has-[[data-state=checked]]:bg-primary/5">
                <div class="mt-0.5">
                    <BbCheckbox @bind-Checked="cardChecked2" Id="card-2" />
                </div>
                <div class="flex-1">
                    <div class="text-sm font-medium leading-none">
                        Enable notifications
                    </div>
                    <p class="text-sm text-muted-foreground mt-1.5">
                        You can enable or disable notifications at any time.
                    </p>
                </div>
            </label>
        </div>
        <CodeBlock Source="Components/Checkbox/checkbox-card.txt" />
    </div>

    <!-- Custom Styling -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Styling</h2>
            <p class="text-sm text-muted-foreground">
                Checkboxes with additional CSS classes.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="styled1" Class="border-2" Id="styled1" />
                <label for="styled1" class="text-sm font-medium leading-none">
                    Thicker border
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <BbCheckbox @bind-Checked="styled2" Class="shadow-md" Id="styled2" />
                <label for="styled2" class="text-sm font-medium leading-none">
                    With shadow
                </label>
            </div>
        </div>
        <CodeBlock Source="Components/Checkbox/custom-styling.txt" />
    </div>

    <!-- Accessibility Notes -->
    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>
                Disabled checkboxes are not focusable (tabindex="-1")
            </AccessibilityItem>
            <AccessibilityItem>
                ARIA attributes set correctly (<code class="text-xs bg-muted px-1 py-0.5 rounded">role="checkbox"</code>, <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-checked</code>, <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-disabled</code>)
            </AccessibilityItem>
            <AccessibilityItem>
                Focus ring appears on keyboard focus (focus-visible:ring-2)
            </AccessibilityItem>
            <AccessibilityItem>
                Color contrast designed for readability
            </AccessibilityItem>
            <AccessibilityItem>
                Semantic label association using htmlFor attribute
            </AccessibilityItem>
            <AccessibilityItem>
                Uses role="checkbox" and aria-checked for assistive technology context
            </AccessibilityItem>
        </AriaAttributes>
        <KeyboardNavigation>
            <KeyboardShortcutItem Description="Focus checkboxes in sequence">
                <BbKbd>Tab</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Toggle focused checkbox">
                <BbKbd>Space</BbKbd>
            </KeyboardShortcutItem>
        </KeyboardNavigation>
    </AccessibilityList>

</div>

@code {
    // Basic checkbox
    private bool basicChecked = false;

    // Multiple options
    private bool option1 = true;
    private bool option2 = false;
    private bool option3 = true;

    // Indeterminate (Select All)
    private bool _selectAllChecked;
    private bool _selectAllIndeterminate;
    private bool _itemRead = true;
    private bool _itemWrite;
    private bool _itemExecute;

    protected override void OnInitialized() => UpdateSelectAll();

    private void HandleSelectAllChanged(bool value)
    {
        _selectAllChecked = value;
        _selectAllIndeterminate = false;
        _itemRead = value;
        _itemWrite = value;
        _itemExecute = value;
    }

    private void UpdateSelectAll()
    {
        var all = _itemRead && _itemWrite && _itemExecute;
        var none = !_itemRead && !_itemWrite && !_itemExecute;
        _selectAllChecked = all;
        _selectAllIndeterminate = !all && !none;
    }

    // Interactive
    private bool _interactiveChecked = false;
    private bool interactiveChecked
    {
        get => _interactiveChecked;
        set
        {
            _interactiveChecked = value;
            if (value)
            {
                lastToggleTime = DateTime.Now.ToString("HH:mm:ss");
            }
        }
    }
    private string lastToggleTime = "";

    // Checkbox card
    private bool cardChecked1 = false;
    private bool cardChecked2 = true;

    // Custom styling
    private bool styled1 = false;
    private bool styled2 = false;

    // Form validation
    private FormModel formModel = new();
    private string formMessage = "";

    private List<string> GetSelectedOptions()
    {
        var selected = new List<string>();
        if (option1) selected.Add("Email");
        if (option2) selected.Add("SMS");
        if (option3) selected.Add("Push");
        return selected.Count > 0 ? selected : new List<string> { "None" };
    }

    private void HandleValidSubmit()
    {
        formMessage = $"Form submitted successfully at {DateTime.Now:HH:mm:ss}. " +
                     $"Terms accepted: {formModel.AcceptTerms}, " +
                     $"Newsletter: {formModel.Subscribe}";
    }

    private void ResetForm()
    {
        formModel = new FormModel();
        formMessage = "";
    }

    public class FormModel
    {
        [Required(ErrorMessage = "You must accept the terms and conditions")]
        [Range(typeof(bool), "true", "true", ErrorMessage = "You must accept the terms and conditions")]
        public bool AcceptTerms { get; set; }

        public bool Subscribe { get; set; }
    }
}
