@page "/components/checkbox"
@using System.ComponentModel.DataAnnotations

<PageTitle>Checkbox Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Checkbox Component</h1>
        <p class="text-xl text-muted-foreground">
            A checkbox control that allows users to toggle between checked and unchecked states.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <!-- Basic Usage -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Usage</h2>
            <p class="text-sm text-muted-foreground">
                Simple checkbox with label using two-way binding.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="basicChecked" Id="basic-checkbox" />
                <label for="basic-checkbox" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Accept terms and conditions
                </label>
            </div>
            <p class="text-sm text-muted-foreground">
                Current state: @(basicChecked ? "Checked ✓" : "Unchecked")
            </p>
        </div>
    </div>

    <!-- Multiple Checkboxes -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Multiple Options</h2>
            <p class="text-sm text-muted-foreground">
                Group of checkboxes for multiple selections.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="option1" Id="option1" />
                <label for="option1" class="text-sm font-medium leading-none">
                    Email notifications
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="option2" Id="option2" />
                <label for="option2" class="text-sm font-medium leading-none">
                    SMS notifications
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="option3" Id="option3" />
                <label for="option3" class="text-sm font-medium leading-none">
                    Push notifications
                </label>
            </div>
            <p class="text-sm text-muted-foreground">
                Selected: @string.Join(", ", GetSelectedOptions())
            </p>
        </div>
    </div>

    <!-- Indeterminate (Select All) -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Indeterminate</h2>
            <p class="text-sm text-muted-foreground">
                A parent checkbox that reflects the aggregate state of its children.
                When some (but not all) items are selected, the parent shows an indeterminate dash.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <Checkbox Checked="@_selectAllChecked"
                          CheckedChanged="HandleSelectAllChanged"
                          Indeterminate="@_selectAllIndeterminate"
                          Id="select-all" />
                <label for="select-all" class="text-sm font-semibold leading-none">
                    Select all
                </label>
            </div>
            <div class="ml-6 space-y-3">
                <div class="flex items-center space-x-2">
                    <Checkbox Checked="@_itemRead"
                              CheckedChanged="@(v => { _itemRead = v; UpdateSelectAll(); })"
                              Id="item-read" />
                    <label for="item-read" class="text-sm font-medium leading-none">
                        Read
                    </label>
                </div>
                <div class="flex items-center space-x-2">
                    <Checkbox Checked="@_itemWrite"
                              CheckedChanged="@(v => { _itemWrite = v; UpdateSelectAll(); })"
                              Id="item-write" />
                    <label for="item-write" class="text-sm font-medium leading-none">
                        Write
                    </label>
                </div>
                <div class="flex items-center space-x-2">
                    <Checkbox Checked="@_itemExecute"
                              CheckedChanged="@(v => { _itemExecute = v; UpdateSelectAll(); })"
                              Id="item-execute" />
                    <label for="item-execute" class="text-sm font-medium leading-none">
                        Execute
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Disabled State -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled State</h2>
            <p class="text-sm text-muted-foreground">
                Checkboxes that cannot be interacted with.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <Checkbox Disabled="true" Checked="false" Id="disabled-unchecked" />
                <label for="disabled-unchecked" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Disabled (unchecked)
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <Checkbox Disabled="true" Checked="true" Id="disabled-checked" />
                <label for="disabled-checked" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                    Disabled (checked)
                </label>
            </div>
        </div>
    </div>

    <!-- Form Validation -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                Checkbox integrated with Blazor's EditForm and validation.
            </p>
        </div>
        <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit" class="space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-3">
                <div class="flex items-center space-x-2">
                    <Checkbox @bind-Checked="formModel.AcceptTerms" Id="terms" />
                    <label for="terms" class="text-sm font-medium leading-none">
                        I accept the terms and conditions
                    </label>
                </div>
                <ValidationMessage For="@(() => formModel.AcceptTerms)" class="text-sm text-destructive" />
            </div>

            <div class="space-y-3">
                <div class="flex items-center space-x-2">
                    <Checkbox @bind-Checked="formModel.Subscribe" Id="subscribe" />
                    <label for="subscribe" class="text-sm font-medium leading-none">
                        Subscribe to newsletter (optional)
                    </label>
                </div>
            </div>

            <div class="flex gap-4">
                <Button Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</Button>
                <Button Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetForm">Reset</Button>
            </div>

            @if (!string.IsNullOrEmpty(formMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@formMessage</p>
                </div>
            }
        </EditForm>
    </div>

    <!-- Interactive Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Interactive</h2>
            <p class="text-sm text-muted-foreground">
                Checkbox with custom change handler.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="interactiveChecked" Id="interactive" />
                <label for="interactive" class="text-sm font-medium leading-none">
                    Toggle feature flag
                </label>
            </div>
            @if (interactiveChecked)
            {
                <div class="p-4 bg-primary/10 rounded-lg border border-primary">
                    <p class="text-sm">✓ Feature is enabled! Last toggled at @lastToggleTime</p>
                </div>
            }
            else
            {
                <div class="p-4 bg-muted rounded-lg">
                    <p class="text-sm text-muted-foreground">Feature is disabled</p>
                </div>
            }
        </div>
    </div>

    <!-- Highlighted Container -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Container Background</h2>
            <p class="text-sm text-muted-foreground">
                Checkbox within a highlighted container (selected state). Click anywhere in the container to toggle.
            </p>
        </div>
        <div class="space-y-3">
            <div
                @onclick="@(() => basicUnchecked = !basicUnchecked)"
                class="@($"flex items-center space-x-3 rounded-lg border p-4 cursor-pointer transition-colors {(basicUnchecked ? "border-primary bg-primary/5" : "border-input")}")">
                <div @onclick:stopPropagation>
                    <Checkbox @bind-Checked="basicUnchecked" Id="basic-unchecked" />
                </div>
                <div class="flex-1">
                    <div class="text-sm font-medium leading-none">
                        Accept terms and conditions
                    </div>
                </div>
            </div>
            <div
                @onclick="@(() => highlightedChecked = !highlightedChecked)"
                class="@($"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer transition-colors {(highlightedChecked ? "border-primary bg-primary/5" : "border-input")}")">
                <div @onclick:stopPropagation class="mt-0.5">
                    <Checkbox @bind-Checked="highlightedChecked" Id="highlighted-checked" />
                </div>
                <div class="flex-1">
                    <div class="text-sm font-medium leading-none">
                        Enable notifications
                    </div>
                    <p class="text-sm text-muted-foreground mt-1.5">
                        You can enable or disable notifications at any time.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Styling -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Styling</h2>
            <p class="text-sm text-muted-foreground">
                Checkboxes with additional CSS classes.
            </p>
        </div>
        <div class="space-y-3">
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="styled1" Class="border-2" Id="styled1" />
                <label for="styled1" class="text-sm font-medium leading-none">
                    Thicker border
                </label>
            </div>
            <div class="flex items-center space-x-2">
                <Checkbox @bind-Checked="styled2" Class="shadow-md" Id="styled2" />
                <label for="styled2" class="text-sm font-medium leading-none">
                    With shadow
                </label>
            </div>
        </div>
    </div>

    <!-- Accessibility Notes -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Accessibility</h2>
            <p class="text-sm text-muted-foreground">
                Keyboard navigation and screen reader support.
            </p>
        </div>
        <div class="space-y-2 text-sm">
            <p>✓ Tab key focuses checkboxes in sequence</p>
            <p>✓ Space key toggles focused checkbox</p>
            <p>✓ Disabled checkboxes are not focusable (tabindex="-1")</p>
            <p>✓ ARIA attributes set correctly (role="checkbox", aria-checked, aria-disabled)</p>
            <p>✓ Focus ring appears on keyboard focus (focus-visible:ring-2)</p>
            <p>✓ Color contrast meets WCAG 2.1 AA standards</p>
            <p>✓ Semantic label association using htmlFor attribute</p>
            <p>✓ Screen readers announce checkbox state correctly</p>
        </div>
    </div>

    <!-- Browser Compatibility -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Browser Compatibility</h2>
            <p class="text-sm text-muted-foreground">
                Tested and verified across modern browsers.
            </p>
        </div>
        <div class="space-y-2 text-sm">
            <p>✓ Chrome 120+ (compatible)</p>
            <p>✓ Firefox 120+ (compatible)</p>
            <p>✓ Edge 120+ (compatible)</p>
            <p>✓ Safari 17+ (compatible)</p>
        </div>
    </div>
</div>

@code {
    // Basic checkbox
    private bool basicChecked = false;

    // Multiple options
    private bool option1 = true;
    private bool option2 = false;
    private bool option3 = true;

    // Indeterminate (Select All)
    private bool _selectAllChecked;
    private bool _selectAllIndeterminate;
    private bool _itemRead = true;
    private bool _itemWrite;
    private bool _itemExecute;

    protected override void OnInitialized() => UpdateSelectAll();

    private void HandleSelectAllChanged(bool value)
    {
        _selectAllChecked = value;
        _selectAllIndeterminate = false;
        _itemRead = value;
        _itemWrite = value;
        _itemExecute = value;
    }

    private void UpdateSelectAll()
    {
        var all = _itemRead && _itemWrite && _itemExecute;
        var none = !_itemRead && !_itemWrite && !_itemExecute;
        _selectAllChecked = all;
        _selectAllIndeterminate = !all && !none;
    }

    // Interactive
    private bool _interactiveChecked = false;
    private bool interactiveChecked
    {
        get => _interactiveChecked;
        set
        {
            _interactiveChecked = value;
            if (value)
            {
                lastToggleTime = DateTime.Now.ToString("HH:mm:ss");
            }
        }
    }
    private string lastToggleTime = "";

    // Highlighted container example
    private bool basicUnchecked = false;
    private bool highlightedChecked = true;

    // Custom styling
    private bool styled1 = false;
    private bool styled2 = false;

    // Form validation
    private FormModel formModel = new();
    private string formMessage = "";

    private List<string> GetSelectedOptions()
    {
        var selected = new List<string>();
        if (option1) selected.Add("Email");
        if (option2) selected.Add("SMS");
        if (option3) selected.Add("Push");
        return selected.Count > 0 ? selected : new List<string> { "None" };
    }

    private void HandleValidSubmit()
    {
        formMessage = $"Form submitted successfully at {DateTime.Now:HH:mm:ss}. " +
                     $"Terms accepted: {formModel.AcceptTerms}, " +
                     $"Newsletter: {formModel.Subscribe}";
    }

    private void ResetForm()
    {
        formModel = new FormModel();
        formMessage = "";
    }

    public class FormModel
    {
        [Required(ErrorMessage = "You must accept the terms and conditions")]
        [Range(typeof(bool), "true", "true", ErrorMessage = "You must accept the terms and conditions")]
        public bool AcceptTerms { get; set; }

        public bool Subscribe { get; set; }
    }
}
