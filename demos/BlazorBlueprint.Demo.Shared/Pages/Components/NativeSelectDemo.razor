@page "/components/native-select"
@using System.ComponentModel.DataAnnotations

<PageTitle>Native Select Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">Native Select Component</h1>
            <p class="text-xl text-muted-foreground">
                A styled wrapper around the browser's native select element.
            </p>
        </div>
    </div>

    <!-- Basic Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Example</h2>
            <p class="text-sm text-muted-foreground">
                A simple native select with options.
            </p>
        </div>
        <div class="w-[280px]">
            <BbNativeSelect TValue="string" @bind-Value="_selectedFruit" Placeholder="Select a fruit">
                <option value="apple">Apple</option>
                <option value="banana">Banana</option>
                <option value="orange">Orange</option>
                <option value="grape">Grape</option>
            </BbNativeSelect>
        </div>
        <p class="text-sm text-muted-foreground">Selected: @(_selectedFruit ?? "none")</p>
        <CodeBlock Source="Components/NativeSelect/basic.txt" />
    </div>

    <!-- With Placeholder -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Placeholder</h2>
            <p class="text-sm text-muted-foreground">
                Select with a placeholder option.
            </p>
        </div>
        <div class="w-[280px]">
            <BbNativeSelect TValue="string" @bind-Value="_selectedCountry" Placeholder="Choose your country">
                <option value="us">United States</option>
                <option value="uk">United Kingdom</option>
                <option value="ca">Canada</option>
                <option value="au">Australia</option>
                <option value="de">Germany</option>
                <option value="fr">France</option>
            </BbNativeSelect>
        </div>
        <CodeBlock Source="Components/NativeSelect/with-placeholder.txt" />
    </div>

    <!-- Sizes -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Sizes</h2>
            <p class="text-sm text-muted-foreground">
                Native select comes in small, default, and large sizes.
            </p>
        </div>
        <div class="flex flex-col gap-4 w-[280px]">
            <BbNativeSelect TValue="string" Size="NativeSelectSize.Small" Placeholder="Small">
                <option value="1">Option 1</option>
                <option value="2">Option 2</option>
            </BbNativeSelect>
            <BbNativeSelect TValue="string" Size="NativeSelectSize.Default" Placeholder="Default">
                <option value="1">Option 1</option>
                <option value="2">Option 2</option>
            </BbNativeSelect>
            <BbNativeSelect TValue="string" Size="NativeSelectSize.Large" Placeholder="Large">
                <option value="1">Option 1</option>
                <option value="2">Option 2</option>
            </BbNativeSelect>
        </div>
        <CodeBlock Source="Components/NativeSelect/sizes.txt" />
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                A disabled native select.
            </p>
        </div>
        <div class="w-[280px]">
            <BbNativeSelect TValue="string" Disabled="true" Placeholder="Disabled select">
                <option value="1">Option 1</option>
                <option value="2">Option 2</option>
            </BbNativeSelect>
        </div>
        <CodeBlock Source="Components/NativeSelect/disabled.txt" />
    </div>

    <!-- With Option Groups -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Option Groups</h2>
            <p class="text-sm text-muted-foreground">
                Native select supports option groups.
            </p>
        </div>
        <div class="w-[280px]">
            <BbNativeSelect TValue="string" @bind-Value="_selectedCar" Placeholder="Select a car">
                <optgroup label="Swedish Cars">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                </optgroup>
                <optgroup label="German Cars">
                    <option value="mercedes">Mercedes</option>
                    <option value="audi">Audi</option>
                    <option value="bmw">BMW</option>
                </optgroup>
                <optgroup label="Japanese Cars">
                    <option value="toyota">Toyota</option>
                    <option value="honda">Honda</option>
                </optgroup>
            </BbNativeSelect>
        </div>
        <CodeBlock Source="Components/NativeSelect/option-groups.txt" />
    </div>

    <!-- Numeric Values -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Numeric Values</h2>
            <p class="text-sm text-muted-foreground">
                Native select with numeric values.
            </p>
        </div>
        <div class="w-[280px]">
            <BbNativeSelect TValue="int" @bind-Value="_selectedNumber" Placeholder="Select a number">
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five</option>
            </BbNativeSelect>
        </div>
        <p class="text-sm text-muted-foreground">Selected number: @_selectedNumber</p>
        <CodeBlock Source="Components/NativeSelect/numeric-values.txt" />
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                NativeSelect integrates with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="nativeSelectFormModel" OnValidSubmit="HandleNativeSelectFormSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Country</label>
                <BbNativeSelect TValue="string" @bind-Value="nativeSelectFormModel.Country" Placeholder="Select a country">
                    <option value="us">United States</option>
                    <option value="uk">United Kingdom</option>
                    <option value="ca">Canada</option>
                    <option value="au">Australia</option>
                    <option value="de">Germany</option>
                    <option value="fr">France</option>
                </BbNativeSelect>
                <ValidationMessage For="@(() => nativeSelectFormModel.Country)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <BbButton Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</BbButton>
                <BbButton Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetNativeSelectForm">Reset</BbButton>
            </div>

            @if (!string.IsNullOrEmpty(nativeSelectFormMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@nativeSelectFormMessage</p>
                </div>
            }
        </EditForm>
        <CodeBlock Source="Components/NativeSelect/form-validation.txt" />
    </div>

    <!-- Accessibility -->
    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>
                Renders a native <code>&lt;select&gt;</code> element, inheriting built-in browser accessibility features.
            </AccessibilityItem>
            <AccessibilityItem>
                The disabled attribute is applied directly to the native select, preventing interaction and signaling the disabled state to assistive technologies.
            </AccessibilityItem>
            <AccessibilityItem>
                When used inside an EditForm, validation errors automatically apply <code>aria-invalid</code> styling to indicate invalid state.
            </AccessibilityItem>
            <AccessibilityItem>
                The placeholder option uses <code>disabled</code> and <code>selected</code> attributes to display prompt text without allowing it as a valid selection.
            </AccessibilityItem>
        </AriaAttributes>
        <KeyboardNavigation>
            <KeyboardShortcutItem Description="Open the select dropdown">
                <BbKbd>Space</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Navigate between options">
                <BbKbd>Arrow Keys</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Select an option and close">
                <BbKbd>Enter</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Close without selecting">
                <BbKbd>Escape</BbKbd>
            </KeyboardShortcutItem>
        </KeyboardNavigation>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="NativeSelect&lt;TValue&gt;">
                <ApiParameter Name="TValue" Type="type parameter">
                    The type of the selected value (e.g., string, int).
                </ApiParameter>
                <ApiParameter Name="Value" Type="TValue?">
                    The currently selected value.
                </ApiParameter>
                <ApiParameter Name="ValueChanged" Type="EventCallback&lt;TValue?&gt;">
                    Event callback invoked when the selected value changes.
                </ApiParameter>
                <ApiParameter Name="ValueExpression" Type="Expression&lt;Func&lt;TValue?&gt;&gt;?">
                    An expression that identifies the bound value. Used for form validation integration with EditContext.
                </ApiParameter>
                <ApiParameter Name="Name" Type="string?">
                    The HTML name attribute for the select element. When inside an EditForm and not explicitly set, derived automatically from the ValueExpression.
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string?">
                    Placeholder text shown as a disabled option when no value is selected.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the select is disabled.
                </ApiParameter>
                <ApiParameter Name="Size" Type="NativeSelectSize" Default="Default">
                    Size variant for the select. Options: Small, Default, Large.
                </ApiParameter>
                <ApiParameter Name="Class" Type="string?">
                    Additional CSS classes to apply to the select element.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?">
                    The option and optgroup elements to display inside the select.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private string? _selectedFruit;
    private string? _selectedCountry;
    private string? _selectedCar;
    private int _selectedNumber;
    private NativeSelectFormModel nativeSelectFormModel = new();
    private string? nativeSelectFormMessage;

    private void HandleNativeSelectFormSubmit()
    {
        nativeSelectFormMessage = $"Form submitted! Country: {nativeSelectFormModel.Country}";
    }

    private void ResetNativeSelectForm()
    {
        nativeSelectFormModel = new();
        nativeSelectFormMessage = null;
    }

    private class NativeSelectFormModel
    {
        [Required(ErrorMessage = "Please select a country.")]
        public string? Country { get; set; }
    }
}
