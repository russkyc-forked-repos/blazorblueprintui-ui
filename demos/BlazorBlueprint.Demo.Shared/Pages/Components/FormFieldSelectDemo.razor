@page "/components/form-field-select"
@using System.ComponentModel.DataAnnotations

<PageTitle>FormFieldSelect Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">FormFieldSelect</h1>
            <p class="text-xl text-muted-foreground">
                A form field wrapper for Select with built-in label, helper text, error messages, and a simplified API.
            </p>
        </div>
    </div>

    <!-- Which form component? -->
    <div class="rounded-lg border border-dashed bg-muted/30 p-6 space-y-3">
        <h2 class="text-lg font-semibold">Which form component?</h2>
        <div class="space-y-2 text-sm text-muted-foreground">
            <p><strong>Text input</strong> (string, int, date, etc.)? &rarr; <a href="/components/form-field-input" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldInput&lt;T&gt;</a></p>
            <p><strong>Checkbox</strong>? &rarr; <a href="/components/form-field-checkbox" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldCheckbox</a></p>
            <p><strong>Switch</strong>? &rarr; <a href="/components/form-field-switch" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldSwitch</a></p>
            <p><strong>Radio group</strong>? &rarr; <a href="/components/form-field-radio-group" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldRadioGroup</a></p>
            <p><strong>Select dropdown</strong>? &rarr; <strong>FormFieldSelect</strong> (this page)</p>
            <p><strong>Searchable select</strong>? &rarr; <a href="/components/form-field-combobox" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldCombobox</a></p>
            <p><strong>Multi-select</strong>? &rarr; <a href="/components/form-field-multi-select" class="text-primary underline underline-offset-4 hover:text-primary/80">FormFieldMultiSelect</a></p>
        </div>
    </div>

    <!-- Data-Binding Mode -->
    <div class="space-y-4">
        <div class="space-y-2">
            <div class="flex items-center gap-2">
                <h2 class="text-2xl font-semibold">Data-Binding Mode</h2>
                <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary ring-1 ring-inset ring-primary/20">v3</span>
            </div>
            <p class="text-sm text-muted-foreground">
                Pass an <code class="text-xs bg-muted px-1 py-0.5 rounded">Options</code> collection of
                <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption&lt;TValue&gt;</code> pairs to auto-generate
                SelectItem children. Use <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption.FromValue</code> when value and label are the same.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldSelect TValue="string"
                             @bind-Value="_fruitDataBound"
                             Label="Favorite fruit"
                             Placeholder="Select a fruit..."
                             HelperText="Pick one from the list."
                             Options="@_fruitOptions" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Selected:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_fruitDataBound) ? "(none)" : _fruitDataBound)</p>
        </div>

        <CodeBlock Source="Components/FormFieldSelect/data-binding.txt" />
    </div>

    <!-- Value/Label Pairs -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Value/Label Pairs</h2>
            <p class="text-sm text-muted-foreground">
                When the bound value differs from the display text, each
                <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption</code> maps a value to its label.
                Useful for binding to IDs (string, int, Guid) while displaying names.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldSelect TValue="string"
                             @bind-Value="_selectedUserId"
                             Label="Team member"
                             Placeholder="Select a member..."
                             HelperText="Value binds to the user ID, not the name."
                             Options="@_userOptions" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Bound value (user ID):</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_selectedUserId) ? "(none)" : _selectedUserId)</p>
        </div>

        <CodeBlock Source="Components/FormFieldSelect/value-label-pairs.txt" />
    </div>

    <!-- Basic Example (Compositional) -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Compositional Mode</h2>
            <p class="text-sm text-muted-foreground">
                Provide SelectItem children for full control over item rendering &mdash;
                useful for rich content like icons, avatars, or custom layouts.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldSelect TValue="string"
                             @bind-Value="_fruit"
                             Label="Favorite fruit"
                             Placeholder="Select a fruit..."
                             HelperText="Pick one from the list.">
                <BbSelectItem Value="@("apple")" Text="Apple">Apple</BbSelectItem>
                <BbSelectItem Value="@("banana")" Text="Banana">Banana</BbSelectItem>
                <BbSelectItem Value="@("cherry")" Text="Cherry">Cherry</BbSelectItem>
                <BbSelectItem Value="@("grape")" Text="Grape">Grape</BbSelectItem>
            </BbFormFieldSelect>
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Selected:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_fruit) ? "(none)" : _fruit)</p>
        </div>

        <CodeBlock Source="Components/FormFieldSelect/compositional.txt" />
    </div>

    <!-- With Flag Icons -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Flag Icons</h2>
            <p class="text-sm text-muted-foreground">
                For rich trigger display (showing the flag after selection), use the compositional
                <code class="text-xs bg-muted px-1 py-0.5 rounded">Select</code> with
                <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectValue</code> ChildContent.
                The <code class="text-xs bg-muted px-1 py-0.5 rounded">@@context</code> variable provides the display text.
            </p>
        </div>
        <div class="max-w-md">
            <BbSelect TValue="string" @bind-Value="_country" Class="w-full">
                <BbSelectTrigger>
                    <BbSelectValue Placeholder="Select a country...">
                        <span class="flex items-center gap-2">@GetCountryFlag(_country) @context</span>
                    </BbSelectValue>
                </BbSelectTrigger>
                <BbSelectContent>
                    <BbSelectItem Value="@("us")" Text="United States">
                        <div class="flex items-center gap-2">
                            <span class="text-base">&#x1F1FA;&#x1F1F8;</span>
                            <span>United States</span>
                        </div>
                    </BbSelectItem>
                    <BbSelectItem Value="@("ca")" Text="Canada">
                        <div class="flex items-center gap-2">
                            <span class="text-base">&#x1F1E8;&#x1F1E6;</span>
                            <span>Canada</span>
                        </div>
                    </BbSelectItem>
                    <BbSelectItem Value="@("gb")" Text="United Kingdom">
                        <div class="flex items-center gap-2">
                            <span class="text-base">&#x1F1EC;&#x1F1E7;</span>
                            <span>United Kingdom</span>
                        </div>
                    </BbSelectItem>
                    <BbSelectItem Value="@("de")" Text="Germany">
                        <div class="flex items-center gap-2">
                            <span class="text-base">&#x1F1E9;&#x1F1EA;</span>
                            <span>Germany</span>
                        </div>
                    </BbSelectItem>
                    <BbSelectItem Value="@("fr")" Text="France">
                        <div class="flex items-center gap-2">
                            <span class="text-base">&#x1F1EB;&#x1F1F7;</span>
                            <span>France</span>
                        </div>
                    </BbSelectItem>
                </BbSelectContent>
            </BbSelect>
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Selected:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_country) ? "(none)" : _country)</p>
        </div>

        <CodeBlock Source="Components/FormFieldSelect/flag-icons.txt" />
    </div>

    <!-- With Avatars -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Avatars</h2>
            <p class="text-sm text-muted-foreground">
                Combine Avatar components with SelectItem to create a user or team member picker.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldSelect TValue="string"
                             @bind-Value="_assignee"
                             Label="Assign to"
                             Placeholder="Select a team member...">
                <BbSelectItem Value="@("alice")" Text="Alice Martin">
                    <div class="flex items-center gap-2">
                        <BbAvatar Size="AvatarSize.Small" Class="h-6 w-6 text-[10px]">
                            <BbAvatarFallback>AM</BbAvatarFallback>
                        </BbAvatar>
                        <div class="flex flex-col">
                            <span class="text-sm">Alice Martin</span>
                            <span class="text-xs text-muted-foreground">Engineering</span>
                        </div>
                    </div>
                </BbSelectItem>
                <BbSelectItem Value="@("bob")" Text="Bob Chen">
                    <div class="flex items-center gap-2">
                        <BbAvatar Size="AvatarSize.Small" Class="h-6 w-6 text-[10px]">
                            <BbAvatarFallback>BC</BbAvatarFallback>
                        </BbAvatar>
                        <div class="flex flex-col">
                            <span class="text-sm">Bob Chen</span>
                            <span class="text-xs text-muted-foreground">Design</span>
                        </div>
                    </div>
                </BbSelectItem>
                <BbSelectItem Value="@("carol")" Text="Carol Davis">
                    <div class="flex items-center gap-2">
                        <BbAvatar Size="AvatarSize.Small" Class="h-6 w-6 text-[10px]">
                            <BbAvatarFallback>CD</BbAvatarFallback>
                        </BbAvatar>
                        <div class="flex flex-col">
                            <span class="text-sm">Carol Davis</span>
                            <span class="text-xs text-muted-foreground">Product</span>
                        </div>
                    </div>
                </BbSelectItem>
                <BbSelectItem Value="@("dan")" Text="Dan Wilson">
                    <div class="flex items-center gap-2">
                        <BbAvatar Size="AvatarSize.Small" Class="h-6 w-6 text-[10px]">
                            <BbAvatarFallback>DW</BbAvatarFallback>
                        </BbAvatar>
                        <div class="flex flex-col">
                            <span class="text-sm">Dan Wilson</span>
                            <span class="text-xs text-muted-foreground">Engineering</span>
                        </div>
                    </div>
                </BbSelectItem>
            </BbFormFieldSelect>
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Assigned to:</p>
            <p class="text-sm font-mono">@(string.IsNullOrEmpty(_assignee) ? "(none)" : _assignee)</p>
        </div>

        <CodeBlock Source="Components/FormFieldSelect/avatars.txt" />
    </div>

    <!-- Non-String Value Types -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Non-String Value Types</h2>
            <p class="text-sm text-muted-foreground">
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">Options</code> with
                <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectOption&lt;TValue&gt;</code> to bind
                non-string values like <code class="text-xs bg-muted px-1 py-0.5 rounded">int?</code>.
                The display text is derived from the option's <code class="text-xs bg-muted px-1 py-0.5 rounded">Text</code> property automatically.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldSelect TValue="int?"
                             @bind-Value="_priorityLevel"
                             Label="Priority"
                             Placeholder="Select priority..."
                             Options="_priorityOptions" />
        </div>
        <div class="rounded-lg border p-4 bg-muted/50">
            <p class="text-sm font-medium mb-1">Selected value:</p>
            <p class="text-sm font-mono">@(_priorityLevel?.ToString() ?? "(none)")</p>
        </div>

        <CodeBlock Source="Components/FormFieldSelect/non-string-types.txt" />
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                A disabled select form field.
            </p>
        </div>
        <div class="max-w-md">
            <BbFormFieldSelect TValue="string"
                             Value="@("usd")"
                             Label="Currency"
                             Placeholder="Select..."
                             HelperText="Locked to your region."
                             Options="_currencyOptions"
                             Disabled="true" />
        </div>

        <CodeBlock Source="Components/FormFieldSelect/disabled.txt" />
    </div>

    <!-- EditForm Integration -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">EditForm Integration</h2>
            <p class="text-sm text-muted-foreground">
                Validation errors display automatically inside an EditForm.
                Try submitting without selecting a country.
            </p>
        </div>
        <div class="max-w-md">
            <EditForm Model="_formModel" OnValidSubmit="HandleFormSubmit">
                <DataAnnotationsValidator />
                <div class="space-y-4">
                    <BbFormFieldSelect TValue="string"
                                     @bind-Value="_formModel.Country"
                                     Label="Country"
                                     Placeholder="Select a country..."
                                     Options="_countryOptions" />
                    <BbButton Type="ButtonType.Submit">Submit</BbButton>
                </div>
            </EditForm>
            @if (_formSubmitted)
            {
                <div class="mt-4 rounded-lg border border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800 p-4">
                    <p class="text-sm font-medium text-green-800 dark:text-green-200">
                        Submitted: @_formModel.Country
                    </p>
                </div>
            }
        </div>

        <CodeBlock Source="Components/FormFieldSelect/editform.txt" />
    </div>

    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>Automatically associates label with input via generated ID</AccessibilityItem>
            <AccessibilityItem>Description linked via aria-describedby</AccessibilityItem>
            <AccessibilityItem>Validation errors displayed with aria-invalid</AccessibilityItem>
        </AriaAttributes>
    </AccessibilityList>

    <!-- API Reference -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component properties and parameters.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="FormFieldSelect&lt;TValue&gt;">
                <ApiParameter Name="Label" Type="string?" Default="null">
                    The label text displayed above the select.
                </ApiParameter>
                <ApiParameter Name="HelperText" Type="string?" Default="null">
                    Helper text displayed below the select. Hidden during error state.
                </ApiParameter>
                <ApiParameter Name="ErrorText" Type="string?" Default="null">
                    Manual error text override. When the field is invalid and this is set, replaces auto-generated messages.
                </ApiParameter>
                <ApiParameter Name="Orientation" Type="FieldOrientation" Default="Vertical">
                    Layout orientation of the field.
                </ApiParameter>
                <ApiParameter Name="Options" Type="IEnumerable&lt;SelectOption&lt;TValue&gt;&gt;?" Default="null">
                    Collection of value/label pairs to display. When provided, SelectItem children are auto-generated. Takes priority over ChildContent.
                </ApiParameter>
                <ApiParameter Name="Value" Type="TValue?" Default="null">
                    The currently selected value. Use @@bind-Value for two-way binding.
                </ApiParameter>
                <ApiParameter Name="ValueChanged" Type="EventCallback&lt;TValue?&gt;">
                    Callback invoked when the selected value changes.
                </ApiParameter>
                <ApiParameter Name="Placeholder" Type="string?" Default="null">
                    Placeholder text displayed when no value is selected.
                </ApiParameter>
                <ApiParameter Name="DisplayTextSelector" Type="Func&lt;TValue, string&gt;?" Default="null">
                    Function to derive display text from the selected value. Auto-derived from Options when provided.
                </ApiParameter>
                <ApiParameter Name="Disabled" Type="bool" Default="false">
                    Whether the select is disabled.
                </ApiParameter>
                <ApiParameter Name="InputClass" Type="string?" Default="null">
                    Additional CSS classes applied to the inner Select element.
                </ApiParameter>
                <ApiParameter Name="Class" Type="string?" Default="null">
                    Additional CSS classes applied to the outer Field container.
                </ApiParameter>
                <ApiParameter Name="AriaLabel" Type="string?" Default="null">
                    ARIA label for the control.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment?" Default="null">
                    Content containing SelectItem components. Ignored when Options is provided.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private string? _fruit;
    private string? _fruitDataBound;
    private string? _country;
    private string? _assignee;
    private int? _priorityLevel;
    private bool _formSubmitted;
    private SelectFormModel _formModel = new();

    private string? _selectedUserId;

    private static readonly string[] Fruits = ["Apple", "Banana", "Cherry", "Grape"];
    private readonly SelectOption<string>[] _fruitOptions = Fruits.Select(SelectOption.FromValue).ToArray();

    private readonly SelectOption<string>[] _userOptions =
    [
        new("u001", "Alice Martin"),
        new("u002", "Bob Chen"),
        new("u003", "Carol Davis"),
        new("u004", "Dan Wilson")
    ];

    private readonly SelectOption<int?>[] _priorityOptions =
    [
        new(1, "Low"),
        new(2, "Medium"),
        new(3, "High")
    ];

    private readonly SelectOption<string>[] _countryOptions =
    [
        new("us", "United States"),
        new("ca", "Canada"),
        new("gb", "United Kingdom"),
        new("de", "Germany"),
        new("fr", "France")
    ];

    private readonly SelectOption<string>[] _currencyOptions =
    [
        new("usd", "USD ($)"),
        new("eur", "EUR")
    ];

    private static string GetCountryFlag(string? country) => country switch
    {
        "us" => "ðŸ‡ºðŸ‡¸",
        "ca" => "ðŸ‡¨ðŸ‡¦",
        "gb" => "ðŸ‡¬ðŸ‡§",
        "de" => "ðŸ‡©ðŸ‡ª",
        "fr" => "ðŸ‡«ðŸ‡·",
        _ => ""
    };

    private void HandleFormSubmit()
    {
        _formSubmitted = true;
    }

    private class SelectFormModel
    {
        [Required(ErrorMessage = "Please select a country.")]
        public string? Country { get; set; }
    }
}
