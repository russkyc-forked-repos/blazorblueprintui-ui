@page "/components/dropdown-menu"
@using BlazorUI.Primitives.Services
@using BlazorUI.Components.DropdownMenu
@using BlazorUI.Components.Kbd
@inject IKeyboardShortcutService KeyboardShortcuts
@implements IAsyncDisposable

<PageTitle>Dropdown Menu Component - BlazorUI</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Dropdown Menu Component</h1>
        <p class="text-xl text-muted-foreground">
            Displays a menu of actions or options triggered by a button.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <!-- Basic Dropdown -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Basic Dropdown Menu</h2>
        <p class="text-sm text-muted-foreground">
            A simple dropdown menu with items.
        </p>

        <div class="flex items-start gap-2">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    Open Menu
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                    <DropdownMenuItem OnClick="@(() => HandleBasicAction("Profile"))">Profile</DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleBasicAction("Settings"))">Settings</DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleBasicAction("Billing"))">Billing</DropdownMenuItem>
                </DropdownMenuContent>
            </DropdownMenu>
            @if (!string.IsNullOrEmpty(basicAction))
            {
                <p class="text-sm">Last action: <strong>@basicAction</strong></p>
            }
        </div>
    </section>

    <!-- With Labels and Separators -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">With Labels and Separators</h2>
        <p class="text-sm text-muted-foreground">
            Organize menu items with labels and visual separators.
        </p>

        <div class="flex items-start gap-2">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    My Account
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                    <DropdownMenuLabel>My Account</DropdownMenuLabel>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem OnClick="@(() => HandleLabelsAction("Profile"))">Profile</DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleLabelsAction("Billing"))">Billing</DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleLabelsAction("Settings"))">Settings</DropdownMenuItem>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem OnClick="@(() => HandleLabelsAction("Logout"))">Logout</DropdownMenuItem>
                </DropdownMenuContent>
            </DropdownMenu>
            @if (!string.IsNullOrEmpty(labelsAction))
            {
                <p class="text-sm">Last action: <strong>@labelsAction</strong></p>
            }
        </div>
    </section>

    <!-- With Groups -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Grouped Items</h2>
        <p class="text-sm text-muted-foreground">
            Group related menu items together.
        </p>

        <div class="flex items-start gap-2">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    Actions
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                    <DropdownMenuLabel>File Operations</DropdownMenuLabel>
                    <DropdownMenuGroup>
                        <DropdownMenuItem OnClick="@(() => HandleGroupsAction("New File"))">New File</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleGroupsAction("Open"))">Open</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleGroupsAction("Save"))">Save</DropdownMenuItem>
                    </DropdownMenuGroup>
                    <DropdownMenuSeparator />
                    <DropdownMenuLabel>Edit Operations</DropdownMenuLabel>
                    <DropdownMenuGroup>
                        <DropdownMenuItem OnClick="@(() => HandleGroupsAction("Cut"))">Cut</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleGroupsAction("Copy"))">Copy</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleGroupsAction("Paste"))">Paste</DropdownMenuItem>
                    </DropdownMenuGroup>
                </DropdownMenuContent>
            </DropdownMenu>
            @if (!string.IsNullOrEmpty(groupsAction))
            {
                <p class="text-sm">Last action: <strong>@groupsAction</strong></p>
            }
        </div>
    </section>

    <!-- With Keyboard Shortcuts (Functional) -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Functional Keyboard Shortcuts</h2>
        <p class="text-sm text-muted-foreground">
            Keyboard shortcuts that actually work! Press the shortcut keys anywhere on this page
            (even when the menu is closed) to trigger the action.
        </p>

        <div class="flex items-start gap-4">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    File Menu
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                    <DropdownMenuItem OnClick="@(() => HandleShortcutsAction("New File"))">
                        New File
                        <DropdownMenuShortcut>Ctrl+Shift+N</DropdownMenuShortcut>
                    </DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleShortcutsAction("Open"))">
                        Open
                        <DropdownMenuShortcut>Ctrl+O</DropdownMenuShortcut>
                    </DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleShortcutsAction("Save"))">
                        Save
                        <DropdownMenuShortcut>Ctrl+S</DropdownMenuShortcut>
                    </DropdownMenuItem>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem OnClick="@(() => HandleShortcutsAction("Save As"))">
                        Save As...
                        <DropdownMenuShortcut>Ctrl+Shift+S</DropdownMenuShortcut>
                    </DropdownMenuItem>
                </DropdownMenuContent>
            </DropdownMenu>

            @if (!string.IsNullOrEmpty(shortcutsAction))
            {
                <div class="flex items-center gap-2 p-3 bg-primary/10 text-primary rounded-md animate-pulse">
                    <LucideIcon Name="check-circle" Size="16" />
                    <span>Shortcut triggered: <strong>@shortcutsAction</strong></span>
                </div>
            }
        </div>

        <div class="mt-4 p-4 bg-muted rounded-lg">
            <p class="font-medium mb-3">Try these shortcuts (even with the menu closed):</p>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div class="flex items-center gap-2">
                    <Kbd Keys="Ctrl+Shift+N" /> <span class="text-muted-foreground">New File</span>
                </div>
                <div class="flex items-center gap-2">
                    <Kbd Keys="Ctrl+O" /> <span class="text-muted-foreground">Open</span>
                </div>
                <div class="flex items-center gap-2">
                    <Kbd Keys="Ctrl+S" /> <span class="text-muted-foreground">Save</span>
                </div>
                <div class="flex items-center gap-2">
                    <Kbd Keys="Ctrl+Shift+S" /> <span class="text-muted-foreground">Save As</span>
                </div>
            </div>
        </div>

        <div class="bg-muted p-4 rounded-md">
            <p class="text-sm font-medium mb-2">Usage with KeyboardShortcutService:</p>
            <pre class="text-sm overflow-x-auto"><code>@@inject IKeyboardShortcutService KeyboardShortcuts
@@implements IAsyncDisposable

@@code {
    private IDisposable? _shortcutNew;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _shortcutNew = await KeyboardShortcuts.RegisterAsync(
                "Ctrl+Shift+N", HandleNewFile);
        }
    }

    private Task HandleNewFile()
    {
        // Handle the shortcut action
        return Task.CompletedTask;
    }

    public ValueTask DisposeAsync()
    {
        _shortcutNew?.Dispose();
        return ValueTask.CompletedTask;
    }
}</code></pre>
        </div>
    </section>

    <!-- Alignment Options -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Alignment Options</h2>
        <p class="text-sm text-muted-foreground">
            Control how the dropdown aligns relative to its trigger (Start, Center, End). Test with small icon buttons to see alignment clearly.
        </p>

        <div class="flex flex-wrap gap-4 items-start">
            <div class="flex flex-col gap-2 items-start">
                <DropdownMenu>
                    <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10" aria-label="Start aligned menu">
                        <LucideIcon Name="menu" Size="16" />
                    </DropdownMenuTrigger>
                    <DropdownMenuContent Align="@PopoverAlign.Start">
                        <DropdownMenuLabel>Start Alignment</DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("start", "Item 1"))">Item 1</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("start", "Item 2"))">Item 2</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("start", "Item 3"))">Item 3</DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
                @if (GetMenuAction("start") != null)
                {
                    <p class="text-sm">Start: <strong>@GetMenuAction("start")</strong></p>
                }
            </div>

            <div class="flex flex-col gap-2 items-start">
                <DropdownMenu>
                    <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10" aria-label="Center aligned menu">
                        <LucideIcon Name="menu" Size="16" />
                    </DropdownMenuTrigger>
                    <DropdownMenuContent Align="@PopoverAlign.Center">
                        <DropdownMenuLabel>Center Alignment</DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("center", "Item 1"))">Item 1</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("center", "Item 2"))">Item 2</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("center", "Item 3"))">Item 3</DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
                @if (GetMenuAction("center") != null)
                {
                    <p class="text-sm">Center: <strong>@GetMenuAction("center")</strong></p>
                }
            </div>

            <div class="flex flex-col gap-2 items-start">
                <DropdownMenu>
                    <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10" aria-label="End aligned menu">
                        <LucideIcon Name="menu" Size="16" />
                    </DropdownMenuTrigger>
                    <DropdownMenuContent Align="@PopoverAlign.End">
                        <DropdownMenuLabel>End Alignment</DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("end", "Item 1"))">Item 1</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("end", "Item 2"))">Item 2</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("end", "Item 3"))">Item 3</DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
                @if (GetMenuAction("end") != null)
                {
                    <p class="text-sm">End: <strong>@GetMenuAction("end")</strong></p>
                }
            </div>
        </div>
    </section>

    <!-- Disabled Items -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Disabled Items</h2>
        <p class="text-sm text-muted-foreground">
            Menu items can be disabled to prevent interaction.
        </p>

        <div class="flex items-start gap-2">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    Edit Menu
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                    <DropdownMenuItem OnClick="@(() => HandleDisabledAction("Cut"))">Cut</DropdownMenuItem>
                    <DropdownMenuItem OnClick="@(() => HandleDisabledAction("Copy"))">Copy</DropdownMenuItem>
                    <DropdownMenuItem Disabled="true" OnClick="@(() => HandleDisabledAction("Paste"))">Paste (Disabled)</DropdownMenuItem>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem OnClick="@(() => HandleDisabledAction("Select All"))">Select All</DropdownMenuItem>
                    <DropdownMenuItem Disabled="true" OnClick="@(() => HandleDisabledAction("Delete"))">Delete (Disabled)</DropdownMenuItem>
                </DropdownMenuContent>
            </DropdownMenu>
            @if (!string.IsNullOrEmpty(disabledAction))
            {
                <p class="text-sm">Last action: <strong>@disabledAction</strong></p>
            }
        </div>
    </section>

    <!-- Checkbox Items -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Checkbox Items</h2>
        <p class="text-sm text-muted-foreground">
            Toggle menu items that maintain checked state. The menu stays open when toggling checkboxes.
        </p>

        <div class="flex items-start gap-4">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                    View Options
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                    <DropdownMenuLabel>Appearance</DropdownMenuLabel>
                    <DropdownMenuSeparator />
                    <DropdownMenuCheckboxItem @bind-Checked="showStatusBar">
                        Status Bar
                    </DropdownMenuCheckboxItem>
                    <DropdownMenuCheckboxItem @bind-Checked="showActivityBar">
                        Activity Bar
                    </DropdownMenuCheckboxItem>
                    <DropdownMenuCheckboxItem @bind-Checked="showPanel">
                        Panel
                    </DropdownMenuCheckboxItem>
                    <DropdownMenuSeparator />
                    <DropdownMenuCheckboxItem @bind-Checked="fullScreen">
                        Full Screen
                    </DropdownMenuCheckboxItem>
                    <DropdownMenuCheckboxItem Disabled="true" Checked="false">
                        Word Wrap (Disabled)
                    </DropdownMenuCheckboxItem>
                </DropdownMenuContent>
            </DropdownMenu>

            <div class="text-sm space-y-1">
                <p>Status Bar: <strong>@(showStatusBar ? "Visible" : "Hidden")</strong></p>
                <p>Activity Bar: <strong>@(showActivityBar ? "Visible" : "Hidden")</strong></p>
                <p>Panel: <strong>@(showPanel ? "Visible" : "Hidden")</strong></p>
                <p>Full Screen: <strong>@(fullScreen ? "On" : "Off")</strong></p>
            </div>
        </div>
    </section>

    <!-- AsChild Pattern -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">AsChild Pattern</h2>
        <p class="text-sm text-muted-foreground">
            Use AsChild to compose triggers with your own styled Button components.
        </p>

        <div class="grid md:grid-cols-2 gap-6">
            <!-- Without AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">Without AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    DropdownMenuTrigger renders its own button with inline classes.
                </p>
                <DropdownMenu>
                    <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Open Menu
                    </DropdownMenuTrigger>
                    <DropdownMenuContent>
                        <DropdownMenuItem>Profile</DropdownMenuItem>
                        <DropdownMenuItem>Settings</DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
            </div>

            <!-- With AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">With AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    Button component receives trigger behavior via TriggerContext.
                </p>
                <DropdownMenu>
                    <DropdownMenuTrigger AsChild>
                        <Button Variant="ButtonVariant.Outline">
                            Actions
                            <LucideIcon Name="chevron-down" Size="16" />
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent>
                        <DropdownMenuLabel>Actions</DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem>
                            <LucideIcon Name="pencil" Size="16" />
                            Edit
                        </DropdownMenuItem>
                        <DropdownMenuItem>
                            <LucideIcon Name="copy" Size="16" />
                            Duplicate
                        </DropdownMenuItem>
                        <DropdownMenuSeparator />
                        <DropdownMenuItem Class="text-destructive">
                            <LucideIcon Name="trash-2" Size="16" />
                            Delete
                        </DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
            </div>
        </div>

        <div class="bg-muted p-4 rounded-md mt-4">
            <p class="text-sm font-medium mb-2">Code Example:</p>
            <pre class="text-sm overflow-x-auto"><code>&lt;DropdownMenu&gt;
    &lt;DropdownMenuTrigger AsChild&gt;
        &lt;Button Variant="ButtonVariant.Outline"&gt;
            Actions
            &lt;LucideIcon Name="chevron-down" Size="16" /&gt;
        &lt;/Button&gt;
    &lt;/DropdownMenuTrigger&gt;
    &lt;DropdownMenuContent&gt;
        &lt;DropdownMenuItem&gt;Edit&lt;/DropdownMenuItem&gt;
        &lt;DropdownMenuItem&gt;Delete&lt;/DropdownMenuItem&gt;
    &lt;/DropdownMenuContent&gt;
&lt;/DropdownMenu&gt;</code></pre>
        </div>
    </section>

    <!-- Complex Example -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Complex Example</h2>
        <p class="text-sm text-muted-foreground">
            Combining all features: labels, separators, groups, shortcuts, and disabled items.
        </p>

        <div class="flex items-start gap-2">
            <DropdownMenu>
                <DropdownMenuTrigger Class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                    Complete Menu
                </DropdownMenuTrigger>
                <DropdownMenuContent Class="w-56">
                    <DropdownMenuLabel>My Account</DropdownMenuLabel>
                    <DropdownMenuSeparator />
                    <DropdownMenuGroup>
                        <DropdownMenuItem OnClick="@(() => HandleComplexAction("Profile"))">
                            Profile
                            <DropdownMenuShortcut>⇧⌘P</DropdownMenuShortcut>
                        </DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleComplexAction("Billing"))">
                            Billing
                            <DropdownMenuShortcut>⌘B</DropdownMenuShortcut>
                        </DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleComplexAction("Settings"))">
                            Settings
                            <DropdownMenuShortcut>⌘S</DropdownMenuShortcut>
                        </DropdownMenuItem>
                        <DropdownMenuItem Disabled="true" OnClick="@(() => HandleComplexAction("Keyboard shortcuts"))">
                            Keyboard shortcuts
                            <DropdownMenuShortcut>⌘K</DropdownMenuShortcut>
                        </DropdownMenuItem>
                    </DropdownMenuGroup>
                    <DropdownMenuSeparator />
                    <DropdownMenuGroup>
                        <DropdownMenuItem OnClick="@(() => HandleComplexAction("Team"))">Team</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleComplexAction("Invite users"))">
                            Invite users
                            <DropdownMenuShortcut>⌘I</DropdownMenuShortcut>
                        </DropdownMenuItem>
                    </DropdownMenuGroup>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem OnClick="@(() => HandleComplexAction("GitHub"))">GitHub</DropdownMenuItem>
                    <DropdownMenuItem Disabled="true" OnClick="@(() => HandleComplexAction("Support"))">Support</DropdownMenuItem>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem OnClick="@(() => HandleComplexAction("Log out"))">
                        Log out
                        <DropdownMenuShortcut>⇧⌘Q</DropdownMenuShortcut>
                    </DropdownMenuItem>
                </DropdownMenuContent>
            </DropdownMenu>
            @if (!string.IsNullOrEmpty(complexAction))
            {
                <p class="text-sm">Last action: <strong>@complexAction</strong></p>
            }
        </div>
    </section>
</div>

@code {
    // Independent state for each menu section
    private string? basicAction;
    private string? labelsAction;
    private string? groupsAction;
    private string? shortcutsAction;
    private string? disabledAction;
    private string? complexAction;
    private Dictionary<string, string?> menuActions = new();

    // Checkbox items state
    private bool showStatusBar = true;
    private bool showActivityBar = true;
    private bool showPanel = false;
    private bool fullScreen = false;

    // Keyboard shortcut registrations
    private IDisposable? _shortcutNew;
    private IDisposable? _shortcutOpen;
    private IDisposable? _shortcutSave;
    private IDisposable? _shortcutSaveAs;
    private CancellationTokenSource? _clearCts;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Register keyboard shortcuts
            _shortcutNew = await KeyboardShortcuts.RegisterAsync("Ctrl+Shift+N", () => HandleShortcutAsync("New File"));
            _shortcutOpen = await KeyboardShortcuts.RegisterAsync("Ctrl+O", () => HandleShortcutAsync("Open"));
            _shortcutSave = await KeyboardShortcuts.RegisterAsync("Ctrl+S", () => HandleShortcutAsync("Save"));
            _shortcutSaveAs = await KeyboardShortcuts.RegisterAsync("Ctrl+Shift+S", () => HandleShortcutAsync("Save As"));
        }
    }

    private async Task HandleShortcutAsync(string action)
    {
        shortcutsAction = action;
        await InvokeAsync(StateHasChanged);

        // Cancel any previous clear timer
        _clearCts?.Cancel();
        _clearCts = new CancellationTokenSource();

        // Clear after 2 seconds
        try
        {
            await Task.Delay(2000, _clearCts.Token);
            shortcutsAction = null;
            await InvokeAsync(StateHasChanged);
        }
        catch (TaskCanceledException)
        {
            // Timer was cancelled, ignore
        }
    }

    // Individual handlers for each section
    private void HandleBasicAction(string action) => basicAction = action;
    private void HandleLabelsAction(string action) => labelsAction = action;
    private void HandleGroupsAction(string action) => groupsAction = action;
    private void HandleShortcutsAction(string action) => _ = HandleShortcutAsync(action);
    private void HandleDisabledAction(string action) => disabledAction = action;
    private void HandleComplexAction(string action) => complexAction = action;

    // Alignment section uses dictionary approach
    private void HandleMenuAction(string menuName, string action)
    {
        menuActions[menuName] = action;
    }

    private string? GetMenuAction(string menuName)
    {
        return menuActions.TryGetValue(menuName, out var action) ? action : null;
    }

    public ValueTask DisposeAsync()
    {
        _clearCts?.Cancel();
        _clearCts?.Dispose();
        _shortcutNew?.Dispose();
        _shortcutOpen?.Dispose();
        _shortcutSave?.Dispose();
        _shortcutSaveAs?.Dispose();
        return ValueTask.CompletedTask;
    }
}
