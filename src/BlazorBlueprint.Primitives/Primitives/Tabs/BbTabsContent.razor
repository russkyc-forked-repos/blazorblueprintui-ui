@namespace BlazorBlueprint.Primitives.Tabs
@implements IDisposable

@* TabsContent primitive - content panel for a tab *@
@if (_isActive || ForceMount)
{
    <div id="@_contentId"
         role="tabpanel"
         aria-labelledby="@_triggerId"
         tabindex="0"
         hidden="@(!_isActive)"
         @attributes="AdditionalAttributes">
        @ChildContent
    </div>
}

@code {
    private string _contentId => Context.GetContentId(Value);
    private string _triggerId => Context.GetTriggerId(Value);
    private bool _isActive => Context.IsTabActive(Value);

    /// <summary>
    /// Cascading parameter to receive the tabs context.
    /// </summary>
    [CascadingParameter]
    public TabsContext Context { get; set; } = null!;

    /// <summary>
    /// The value that identifies this tab content panel.
    /// Must match the Value of the corresponding TabsTrigger.
    /// </summary>
    [Parameter, EditorRequired]
    public string Value { get; set; } = string.Empty;

    /// <summary>
    /// The child content to render when this tab is active.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Additional attributes to apply to the tab content panel element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    /// <summary>
    /// Whether to force mount the content even when inactive.
    /// When false (default), content is unmounted when not active.
    /// When true, content remains mounted but hidden.
    /// </summary>
    [Parameter]
    public bool ForceMount { get; set; } = false;

    protected override void OnInitialized()
    {
        if (Context == null)
        {
            throw new InvalidOperationException("TabsContent must be used within a Tabs component.");
        }

        // Subscribe to context changes to update active state
        Context.OnStateChanged += StateHasChanged;
    }

    public void Dispose()
    {
        Context.OnStateChanged -= StateHasChanged;
    }
}
