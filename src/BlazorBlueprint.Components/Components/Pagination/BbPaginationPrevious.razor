@namespace BlazorBlueprint.Components
@using BlazorBlueprint.Icons.Lucide.Components

<BbPaginationLink Href="@Href"
                Size="@EffectiveSize"
                Class="@CssClass"
                Disabled="@IsDisabled"
                OnClick="HandleClick">
    <LucideIcon Name="chevron-left" Class="h-4 w-4" />
    @if (ShowText)
    {
        <span>@Text</span>
    }
    else
    {
        <span class="sr-only">@Text</span>
    }
</BbPaginationLink>

@code {
    [CascadingParameter]
    private PaginationContext? Context { get; set; }

    [Parameter]
    public string? Href { get; set; }

    /// <summary>
    /// Explicitly disable the button. When null, automatically determined from pagination state.
    /// </summary>
    [Parameter]
    public bool? Disabled { get; set; }

    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Custom click handler. When using pagination state, navigation is automatic.
    /// </summary>
    [Parameter]
    public EventCallback OnClick { get; set; }

    /// <summary>
    /// Whether to show the text label. Default: true
    /// </summary>
    [Parameter]
    public bool ShowText { get; set; } = true;

    /// <summary>
    /// Custom text for the button. Default: "Previous"
    /// </summary>
    [Parameter]
    public string Text { get; set; } = "Previous";

    /// <summary>
    /// Size of the pagination link. Default: PaginationLinkSize.Default
    /// </summary>
    [Parameter]
    public PaginationLinkSize Size { get; set; } = PaginationLinkSize.Default;

    private bool IsDisabled => Disabled ?? (Context?.State != null && !Context.State.CanGoPrevious);

    private PaginationLinkSize EffectiveSize => ShowText ? Size : PaginationLinkSize.Icon;

    private async Task HandleClick()
    {
        if (Context?.State != null)
        {
            Context.State.PreviousPage();
            if (Context.OnPageChanged != null)
                await Context.OnPageChanged(Context.State.CurrentPage);
        }

        if (OnClick.HasDelegate)
            await OnClick.InvokeAsync();
    }

    private string CssClass => ClassNames.cn(
        ShowText ? "gap-1 pl-2.5" : "h-8 w-8",
        Class
    );
}
