@typeparam TValue
@namespace BlazorBlueprint.Components

@* Styled SelectItem wrapper around SelectItem primitive *@
<BlazorBlueprint.Primitives.Select.BbSelectItem TValue="TValue"
                                           Value="Value"
                                           Text="@GetDisplayText()"
                                           Disabled="Disabled"
                                           class="@CssClass">
    @if (IsSelected)
    {
        <span class="absolute inset-y-0 right-0 flex items-center pr-3">
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </span>
    }
    <span class="@(IsSelected ? "pr-6" : "")">
        @if (ChildContent is not null)
        {
            @ChildContent
        }
        else
        {
            @GetDisplayText()
        }
    </span>
</BlazorBlueprint.Primitives.Select.BbSelectItem>

@code {
    [CascadingParameter]
    private BlazorBlueprint.Primitives.Select.SelectContext<TValue>? _context { get; set; }

    /// <summary>
    /// Gets or sets the value of this item.
    /// </summary>
    [Parameter, EditorRequired]
    public TValue Value { get; set; } = default!;

    /// <summary>
    /// Gets or sets the display text for this item.
    /// If not provided, will use ChildContent text or Value.ToString().
    /// </summary>
    [Parameter]
    public string? Text { get; set; }

    /// <summary>
    /// Gets or sets additional CSS classes to apply to the item.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Gets or sets the content to be rendered as the item's display text.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Gets or sets whether this item is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Gets whether this item is currently selected.
    /// </summary>
    private bool IsSelected
    {
        get
        {
            if (_context == null) return false;
            return EqualityComparer<TValue?>.Default.Equals(_context.Value, Value);
        }
    }

    /// <summary>
    /// Gets the computed CSS classes for the item.
    /// </summary>
    private string CssClass => ClassNames.cn(
        "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 px-2 text-sm",
        "outline-none transition-colors",
        "data-[focused=true]:bg-accent data-[focused=true]:text-accent-foreground",
        "data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",
        ClassNames.when(IsSelected, "bg-accent/50 text-accent-foreground"),
        Class
    );

    /// <summary>
    /// Gets the display text for this item.
    /// Uses Text parameter if provided, otherwise falls back to Value.ToString().
    /// </summary>
    private string? GetDisplayText()
    {
        return Text ?? Value?.ToString();
    }
}
