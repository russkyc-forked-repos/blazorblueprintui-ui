@namespace BlazorBlueprint.Components.Select
@implements IDisposable

@if (!string.IsNullOrWhiteSpace(GetSelectedText()))
{
    @GetSelectedText()
}
else
{
    <span class="text-muted-foreground">@Placeholder</span>
}

@code {
    [CascadingParameter]
    private dynamic? SelectContext { get; set; }

    /// <summary>
    /// Gets or sets the placeholder text to display when no value is selected.
    /// </summary>
    [Parameter]
    public string? Placeholder { get; set; }

    private bool _subscribed;
    private readonly Action _handleStateChanged;

    public SelectValue()
    {
        _handleStateChanged = () => InvokeAsync(StateHasChanged);
    }

    protected override void OnParametersSet()
    {
        if (!_subscribed && SelectContext != null)
        {
            SelectContext!.OnStateChanged += _handleStateChanged;
            _subscribed = true;
        }
    }

    private string? GetSelectedText() => SelectContext?.DisplayText;

    public void Dispose()
    {
        if (_subscribed && SelectContext != null)
        {
            SelectContext!.OnStateChanged -= _handleStateChanged;
        }
    }
}
