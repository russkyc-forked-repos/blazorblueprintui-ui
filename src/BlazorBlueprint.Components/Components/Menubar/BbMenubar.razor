@namespace BlazorBlueprint.Components

<div role="menubar" class="@CssClass">
    <CascadingValue Value="this" IsFixed="false">
        @ChildContent
    </CascadingValue>
</div>

@code {
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Additional CSS classes to apply to all <see cref="BbMenubarTrigger"/> components within this menubar.
    /// </summary>
    [Parameter]
    public string? TriggerClass { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    internal string? ActiveMenu { get; private set; }

    private List<BbMenubarMenu> _menus = new();

    internal void RegisterMenu(BbMenubarMenu menu)
    {
        if (!_menus.Contains(menu))
        {
            _menus.Add(menu);
        }
    }

    internal void UnregisterMenu(BbMenubarMenu menu)
    {
        _menus.Remove(menu);
    }

    internal List<BbMenubarMenu> GetMenus() => _menus;

    internal void SetActiveMenu(string? menuId)
    {
        ActiveMenu = menuId;
        StateHasChanged();
    }

    internal void NavigateToNextMenu()
    {
        if (_menus.Count == 0 || ActiveMenu == null) return;

        var currentIndex = _menus.FindIndex(m => m.MenuId == ActiveMenu);
        if (currentIndex == -1) return;

        var nextIndex = (currentIndex + 1) % _menus.Count;
        _menus[nextIndex].Open();
    }

    internal void NavigateToPreviousMenu()
    {
        if (_menus.Count == 0 || ActiveMenu == null) return;

        var currentIndex = _menus.FindIndex(m => m.MenuId == ActiveMenu);
        if (currentIndex == -1) return;

        var prevIndex = currentIndex == 0 ? _menus.Count - 1 : currentIndex - 1;
        _menus[prevIndex].Open();
    }

    private string CssClass => ClassNames.cn(
        "relative z-50 flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
        Class
    );
}
