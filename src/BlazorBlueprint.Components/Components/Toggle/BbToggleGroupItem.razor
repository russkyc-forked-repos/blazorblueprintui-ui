@namespace BlazorBlueprint.Components
@typeparam TValue

<button type="button"
        aria-pressed="@IsPressed"
        data-state="@(IsPressed ? "on" : "off")"
        disabled="@(Disabled || Context?.Disabled == true)"
        class="@CssClass"
        @onclick="HandleClick">
    @ChildContent
</button>

@code {
    [CascadingParameter]
    public BbToggleGroup<TValue>? Context { get; set; }

    [Parameter]
    public TValue? Value { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private bool IsPressed => Context?.IsItemPressed(Value) == true;
    private ToggleVariant Variant => Context?.Variant ?? ToggleVariant.Default;
    private ToggleSize Size => Context?.Size ?? ToggleSize.Default;

    private async Task HandleClick()
    {
        if (Context != null && !Disabled && Context.Disabled != true)
        {
            await Context.ToggleItem(Value);
        }
    }

    private string VariantClasses => Variant switch
    {
        ToggleVariant.Default => "bg-transparent",
        ToggleVariant.Outline => "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
        _ => "bg-transparent"
    };

    private string SizeClasses => Size switch
    {
        ToggleSize.Small => "h-9 px-2.5",
        ToggleSize.Default => "h-10 px-3",
        ToggleSize.Large => "h-11 px-5",
        _ => "h-10 px-3"
    };

    private string CssClass => ClassNames.cn(
        "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors",
        "hover:bg-muted hover:text-muted-foreground",
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        "disabled:pointer-events-none disabled:opacity-50",
        "data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
        VariantClasses,
        SizeClasses,
        Class
    );
}
