@namespace BlazorBlueprint.Components

<button type="button"
        aria-pressed="@IsPressed"
        data-state="@(IsPressed ? "on" : "off")"
        disabled="@Disabled"
        class="@CssClass"
        @onclick="HandleClick"
        @attributes="AdditionalAttributes">
    @ChildContent
</button>

@code {
    [Parameter]
    public bool Pressed { get; set; }

    [Parameter]
    public EventCallback<bool> PressedChanged { get; set; }

    [Parameter]
    public bool DefaultPressed { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public ToggleVariant Variant { get; set; } = ToggleVariant.Default;

    [Parameter]
    public ToggleSize Size { get; set; } = ToggleSize.Default;

    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private bool _internalPressed;
    private bool IsControlled => PressedChanged.HasDelegate;
    private bool IsPressed => IsControlled ? Pressed : _internalPressed;

    protected override void OnInitialized()
    {
        _internalPressed = DefaultPressed;
    }

    private async Task HandleClick()
    {
        if (Disabled) return;

        var newValue = !IsPressed;

        if (IsControlled)
        {
            await PressedChanged.InvokeAsync(newValue);
        }
        else
        {
            _internalPressed = newValue;
        }
    }

    private string VariantClasses => Variant switch
    {
        ToggleVariant.Default => "bg-transparent",
        ToggleVariant.Outline => "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
        _ => "bg-transparent"
    };

    private string SizeClasses => Size switch
    {
        ToggleSize.Small => "h-9 px-2.5",
        ToggleSize.Default => "h-10 px-3",
        ToggleSize.Large => "h-11 px-5",
        _ => "h-10 px-3"
    };

    private string CssClass => ClassNames.cn(
        "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors",
        "hover:bg-muted hover:text-muted-foreground",
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
        "disabled:pointer-events-none disabled:opacity-50",
        "data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
        VariantClasses,
        SizeClasses,
        Class
    );
}
