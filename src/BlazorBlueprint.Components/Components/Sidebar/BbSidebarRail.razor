@namespace BlazorBlueprint.Components

@*
    SidebarRail component that appears on hover to toggle the sidebar.
    Provides a visual affordance for expanding/collapsing the sidebar.
*@

<button type="button" class="@GetClasses()" data-sidebar="rail" tabindex="-1" title="Toggle Sidebar" @onclick="HandleClick" @attributes="AdditionalAttributes">
    <span class="sr-only">Toggle Sidebar</span>
</button>

@code {
    [CascadingParameter]
    private SidebarContext? Context { get; set; }

    /// <summary>
    /// Click handler for custom behavior.
    /// </summary>
    [Parameter]
    public EventCallback<MouseEventArgs> OnClick { get; set; }

    /// <summary>
    /// Additional CSS classes.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Additional attributes.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private async Task HandleClick(MouseEventArgs e)
    {
        Context?.ToggleSidebar();

        if (OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync(e);
        }
    }

    private string GetClasses()
    {
        return ClassNames.cn(
            "absolute inset-y-0 z-20 flex w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0",
            "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
            "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
            "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
            "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
            "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
            Class
        );
    }
}
