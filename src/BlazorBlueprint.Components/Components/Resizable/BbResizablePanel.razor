@namespace BlazorBlueprint.Components

<div class="@CssClass" style="@Style">
    @ChildContent
</div>

@code {
    [CascadingParameter]
    private BbResizablePanelGroup? Group { get; set; }

    /// <summary>
    /// The content of the panel.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// The default size as a percentage (0-100).
    /// </summary>
    [Parameter]
    public double DefaultSize { get; set; } = 50;

    /// <summary>
    /// The minimum size as a percentage (0-100).
    /// </summary>
    [Parameter]
    public double MinSize { get; set; } = 10;

    /// <summary>
    /// The maximum size as a percentage (0-100).
    /// </summary>
    [Parameter]
    public double MaxSize { get; set; } = 100;

    /// <summary>
    /// Whether the panel can be collapsed.
    /// </summary>
    [Parameter]
    public bool Collapsible { get; set; }

    /// <summary>
    /// Additional CSS classes to apply.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    private int _panelIndex = -1;

    private bool IsHorizontal => Group?.GetDirection() == ResizableDirection.Horizontal;

    private double CurrentSize
    {
        get
        {
            if (Group != null && _panelIndex >= 0)
            {
                return Group.GetPanelSize(_panelIndex);
            }
            return DefaultSize;
        }
    }

    protected override void OnInitialized()
    {
        if (Group != null)
        {
            _panelIndex = Group.RegisterPanel(DefaultSize, MinSize, MaxSize);
        }
    }

    private string Style
    {
        get
        {
            var size = CurrentSize;
            return IsHorizontal
                ? $"flex: 1 0 {size:F2}%; min-width: {MinSize}%; max-width: {MaxSize}%; overflow: auto;"
                : $"flex: 1 0 {size:F2}%; min-height: {MinSize}%; max-height: {MaxSize}%; overflow: auto;";
        }
    }

    private string CssClass => ClassNames.cn(
        "relative",
        Class
    );
}
