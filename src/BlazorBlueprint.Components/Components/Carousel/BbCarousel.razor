@namespace BlazorBlueprint.Components

<div class="@CssClass" role="region" aria-roledescription="carousel">
    <CascadingValue Value="this" IsFixed="false">
        @ChildContent
    </CascadingValue>
</div>

@code {
    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public CarouselOrientation Orientation { get; set; } = CarouselOrientation.Horizontal;

    [Parameter]
    public bool Loop { get; set; }

    internal int CurrentIndex { get; private set; }
    internal int ItemCount { get; private set; }

    internal void RegisterItem()
    {
        ItemCount++;
        StateHasChanged();
    }

    internal void UnregisterItem()
    {
        ItemCount--;
        if (CurrentIndex >= ItemCount && ItemCount > 0)
        {
            CurrentIndex = ItemCount - 1;
        }
        StateHasChanged();
    }

    internal void GoTo(int index)
    {
        if (index < 0)
        {
            CurrentIndex = Loop ? ItemCount - 1 : 0;
        }
        else if (index >= ItemCount)
        {
            CurrentIndex = Loop ? 0 : ItemCount - 1;
        }
        else
        {
            CurrentIndex = index;
        }
        StateHasChanged();
    }

    internal void Previous()
    {
        GoTo(CurrentIndex - 1);
    }

    internal void Next()
    {
        GoTo(CurrentIndex + 1);
    }

    internal bool CanGoPrevious => Loop || CurrentIndex > 0;
    internal bool CanGoNext => Loop || CurrentIndex < ItemCount - 1;

    private string CssClass => ClassNames.cn(
        "relative",
        Class
    );
}
