@namespace BlazorBlueprint.Components
@using BlazorBlueprint.Icons.Lucide.Components

@*
    Markdown Editor component with toolbar and preview functionality.
    Inspired by GitHub's comment editor design.
*@

<div class="@ContainerCssClass" data-slot="markdown-editor">
    <BbTabs DefaultValue="write" OnValueChange="HandleTabChange">
        @* Header with tabs and toolbar *@
        <div class="flex flex-wrap items-center justify-between gap-2 px-3 py-2 border-b border-input bg-muted/40">
            @* Write/Preview tabs - GitHub style boxed tabs *@
            <div class="inline-flex items-center rounded-md border border-input bg-muted/60 p-0.5">
                <BbTabsTrigger Value="write"
                             Class="@GetTabClass("write")"
                             Disabled="@Disabled">Write</BbTabsTrigger>
                <BbTabsTrigger Value="preview"
                             Class="@GetTabClass("preview")"
                             Disabled="@Disabled">Preview</BbTabsTrigger>
            </div>

            @* Toolbar - only visible in Write mode *@
            @if (_activeTab == "write")
            {
                <div class="flex items-center gap-1 ml-auto">
                    @* Heading dropdown *@
                    <BbDropdownMenu>
                        <BbDropdownMenuTrigger AsChild>
                            <BbButton Variant="ButtonVariant.Ghost"
                                    Size="ButtonSize.IconSmall"
                                    AriaLabel="Select heading level"
                                    Disabled="@Disabled"
                                    Class="h-7 w-7">
                                <LucideIcon Name="pilcrow" Size="14" />
                            </BbButton>
                        </BbDropdownMenuTrigger>
                        <BbDropdownMenuContent Align="PopoverAlign.Start" Class="w-40">
                            <BbDropdownMenuLabel>Text Style</BbDropdownMenuLabel>
                            <BbDropdownMenuSeparator />
                            <BbDropdownMenuItem OnClick="@(() => ApplyHeading(0))">
                                <LucideIcon Name="pilcrow" Size="14" Class="mr-2" />
                                Normal
                            </BbDropdownMenuItem>
                            <BbDropdownMenuItem OnClick="@(() => ApplyHeading(1))">
                                <LucideIcon Name="heading-1" Size="14" Class="mr-2" />
                                Heading 1
                            </BbDropdownMenuItem>
                            <BbDropdownMenuItem OnClick="@(() => ApplyHeading(2))">
                                <LucideIcon Name="heading-2" Size="14" Class="mr-2" />
                                Heading 2
                            </BbDropdownMenuItem>
                            <BbDropdownMenuItem OnClick="@(() => ApplyHeading(3))">
                                <LucideIcon Name="heading-3" Size="14" Class="mr-2" />
                                Heading 3
                            </BbDropdownMenuItem>
                        </BbDropdownMenuContent>
                    </BbDropdownMenu>

                    @* Text formatting buttons *@
                    <BbButtonGroup>
                        <BbButton Variant="ButtonVariant.Ghost"
                                Size="ButtonSize.IconSmall"
                                AriaLabel="Bold (Ctrl+B)"
                                OnClick="ApplyBold"
                                Disabled="@Disabled"
                                Class="h-7 w-7">
                            <LucideIcon Name="bold" Size="14" />
                        </BbButton>
                        <BbButton Variant="ButtonVariant.Ghost"
                                Size="ButtonSize.IconSmall"
                                AriaLabel="Italic (Ctrl+I)"
                                OnClick="ApplyItalic"
                                Disabled="@Disabled"
                                Class="h-7 w-7">
                            <LucideIcon Name="italic" Size="14" />
                        </BbButton>
                        <BbButton Variant="ButtonVariant.Ghost"
                                Size="ButtonSize.IconSmall"
                                AriaLabel="Underline (Ctrl+U)"
                                OnClick="ApplyUnderline"
                                Disabled="@Disabled"
                                Class="h-7 w-7">
                            <LucideIcon Name="underline" Size="14" />
                        </BbButton>
                    </BbButtonGroup>

                    <BbButtonGroupSeparator />

                    @* List formatting buttons *@
                    <BbButtonGroup>
                        <BbButton Variant="ButtonVariant.Ghost"
                                Size="ButtonSize.IconSmall"
                                AriaLabel="Bullet list"
                                OnClick="ApplyBulletList"
                                Disabled="@Disabled"
                                Class="h-7 w-7">
                            <LucideIcon Name="list" Size="14" />
                        </BbButton>
                        <BbButton Variant="ButtonVariant.Ghost"
                                Size="ButtonSize.IconSmall"
                                AriaLabel="Numbered list"
                                OnClick="ApplyNumberedList"
                                Disabled="@Disabled"
                                Class="h-7 w-7">
                            <LucideIcon Name="list-ordered" Size="14" />
                        </BbButton>
                    </BbButtonGroup>
                </div>
            }
        </div>

        @* Content area *@
        <BbTabsContent Value="write" Class="mt-0">
            <textarea @ref="_textareaRef"
                      id="@Id"
                      class="@TextareaCssClass"
                      style="@MinHeightStyle"
                      value="@Value"
                      placeholder="@Placeholder"
                      disabled="@Disabled"
                      aria-label="@AriaLabel"
                      aria-describedby="@AriaDescribedBy"
                      aria-invalid="@(AriaInvalid?.ToString().ToLower())"
                      @oninput="HandleInput"
                      @onkeydown="HandleKeyDown"
                      @onkeydown:preventDefault="_shouldPreventKeydown"></textarea>
        </BbTabsContent>

        <BbTabsContent Value="preview" Class="mt-0">
            <div class="@PreviewCssClass" style="@MinHeightStyle">
                @((MarkupString)RenderedHtml)
            </div>
        </BbTabsContent>
    </BbTabs>
</div>
