@namespace BlazorBlueprint.Components
@using BlazorBlueprint.Icons.Lucide.Components
@*
    Styled DialogContent component with shadcn/ui classes.
    Includes overlay, dialog box, and close button.
*@

<BlazorBlueprint.Primitives.Dialog.BbDialogPortal Container="@Container">
    <BlazorBlueprint.Primitives.Dialog.BbDialogOverlay  class="fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:animate-overlay-fade-in data-[state=closed]:animate-overlay-fade-out" />

    <BlazorBlueprint.Primitives.Dialog.BbDialogContent
        class="@GetClassNames()"
        CloseOnEscape="@CloseOnEscape"
        TrapFocus="@TrapFocus"
        LockScroll="@LockScroll"
        OnEscapeKeyDown="@OnEscapeKeyDown"
        @attributes="AdditionalAttributes">
        @ChildContent

        @if (ShowClose)
        {
            <BlazorBlueprint.Primitives.Dialog.BbDialogClose class="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
                <LucideIcon Name="x" Class="h-4 w-4" />
                <span class="sr-only">Close</span>
            </BlazorBlueprint.Primitives.Dialog.BbDialogClose>
        }
    </BlazorBlueprint.Primitives.Dialog.BbDialogContent>
</BlazorBlueprint.Primitives.Dialog.BbDialogPortal>

@code {
    /// <summary>
    /// The content to render inside the dialog.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Additional CSS classes to apply to the dialog content.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Additional attributes to apply to the dialog content.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    /// <summary>
    /// Whether to show the close button (X icon).
    /// Default is true.
    /// </summary>
    [Parameter]
    public bool ShowClose { get; set; } = true;

    /// <summary>
    /// Render the dialog inline within a container instead of portaling to document body.
    /// When set, the dialog overlay and content stay in the DOM tree, allowing containment
    /// by a parent element with CSS containment (e.g. transform: translateZ(0)).
    /// When null (default), renders into document body via portal.
    /// </summary>
    [Parameter]
    public string? Container { get; set; }

    /// <summary>
    /// Whether pressing Escape should close the dialog.
    /// Default is true.
    /// </summary>
    [Parameter]
    public bool CloseOnEscape { get; set; } = true;

    /// <summary>
    /// Whether to trap focus within the dialog.
    /// Default is true for modal dialogs.
    /// </summary>
    [Parameter]
    public bool TrapFocus { get; set; } = true;

    /// <summary>
    /// Whether to lock body scroll when dialog is open.
    /// Default is true for modal dialogs.
    /// </summary>
    [Parameter]
    public bool LockScroll { get; set; } = true;

    /// <summary>
    /// Event callback invoked when Escape key is pressed.
    /// </summary>
    [Parameter]
    public EventCallback<KeyboardEventArgs> OnEscapeKeyDown { get; set; }

    /// <summary>
    /// Gets the computed CSS classes for the dialog content.
    /// Uses the cn() utility for intelligent class merging and Tailwind conflict resolution.
    /// </summary>
    private string GetClassNames() => ClassNames.cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%]",
        "gap-4 border bg-background p-6 shadow-lg duration-200",
        "data-[state=open]:animate-in data-[state=closed]:animate-out",
        "data-[state=open]:animate-dialog-zoom-in data-[state=closed]:animate-dialog-zoom-out",
        "sm:rounded-lg",
        Class
    );
}
